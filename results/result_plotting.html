<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.220">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Meteo Imputation – result_plotting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Meteo Imputation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../lib" rel="" target="">
 <span class="menu-text">Library Docs</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#plotting-for-results" id="toc-plotting-for-results" class="nav-link active" data-scroll-target="#plotting-for-results">Plotting for results</a>
  <ul class="collapse">
  <li><a href="#comparison-imputation-methods" id="toc-comparison-imputation-methods" class="nav-link" data-scroll-target="#comparison-imputation-methods">Comparison Imputation methods</a>
  <ul class="collapse">
  <li><a href="#main-plot" id="toc-main-plot" class="nav-link" data-scroll-target="#main-plot">Main plot</a></li>
  <li><a href="#table" id="toc-table" class="nav-link" data-scroll-target="#table">Table</a></li>
  <li><a href="#timeseries" id="toc-timeseries" class="nav-link" data-scroll-target="#timeseries">Timeseries</a></li>
  </ul></li>
  <li><a href="#kalman-filter-analysis" id="toc-kalman-filter-analysis" class="nav-link" data-scroll-target="#kalman-filter-analysis">Kalman Filter analysis</a>
  <ul class="collapse">
  <li><a href="#gap-len" id="toc-gap-len" class="nav-link" data-scroll-target="#gap-len">Gap len</a></li>
  <li><a href="#control" id="toc-control" class="nav-link" data-scroll-target="#control">Control</a></li>
  <li><a href="#gap-in-other-variables" id="toc-gap-in-other-variables" class="nav-link" data-scroll-target="#gap-in-other-variables">Gap in Other variables</a></li>
  <li><a href="#generic-vs-specialized" id="toc-generic-vs-specialized" class="nav-link" data-scroll-target="#generic-vs-specialized">Generic vs Specialized</a></li>
  </ul></li>
  <li><a href="#fluxnet" id="toc-fluxnet" class="nav-link" data-scroll-target="#fluxnet">Fluxnet</a>
  <ul class="collapse">
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">Correlation</a></li>
  <li><a href="#gap-distribution" id="toc-gap-distribution" class="nav-link" data-scroll-target="#gap-distribution">Gap distribution</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">



<section id="plotting-for-results" class="level1">
<h1>Plotting for results</h1>
<p>This notebook produces all results plots. It generates some gap in the data, fill with a method (filter, MDS …), compute metrics and then makes all relevant plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> meteo_imp.kalman.results <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> meteo_imp.data <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> meteo_imp.utils <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyprojroot <span class="im">import</span> here</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> SVG, Image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> vl_convert <span class="im">as</span> vlc</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyprojroot <span class="im">import</span> here</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>base_path_img <span class="op">=</span> here(<span class="st">"manuscript/Master Thesis - Meteorological time series imputation using Kalman filters - Simone Massaro/images/"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>base_path_tbl <span class="op">=</span> here(<span class="st">"manuscript/Master Thesis - Meteorological time series imputation using Kalman filters - Simone Massaro/tables/"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_plot(plot, path):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    png_data <span class="op">=</span> vlc.vegalite_to_png(vl_spec<span class="op">=</span>plot.to_json(), scale<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(base_path_img <span class="op">/</span> (path <span class="op">+</span> <span class="st">".png"</span>), <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        f.write(png_data)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_plot(path): <span class="cf">return</span> Image(filename<span class="op">=</span>base_path_img <span class="op">/</span> (path <span class="op">+</span> <span class="st">".png"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>reset_seed()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n_rep <span class="op">=</span> <span class="dv">500</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>hai <span class="op">=</span> pd.read_parquet(hai_big_path).reindex(columns<span class="op">=</span>var_type.categories)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>hai_era <span class="op">=</span> pd.read_parquet(hai_era_big_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="comparison-imputation-methods" class="level2">
<h2 class="anchored" data-anchor-id="comparison-imputation-methods">Comparison Imputation methods</h2>
<section id="main-plot" class="level3">
<h3 class="anchored" data-anchor-id="main-plot">Main plot</h3>
<p>The gap is a only in the variable that is gap-filled</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>hai.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Index(['TA', 'SW_IN', 'LW_IN', 'VPD', 'WS', 'PA', 'P', 'SWC', 'TS'], dtype='object')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> here(<span class="st">"analysis/results/trained_14feb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> l_model(x): <span class="cf">return</span> torch.load(base_path <span class="op">/</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>models_var <span class="op">=</span> [</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'TA'</span>,    <span class="st">'model'</span>: l_model(<span class="st">"TA_specialized_gap_12-336_v2.pickle.pickle"</span>)},</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'SW_IN'</span>, <span class="st">'model'</span>: l_model(<span class="st">"SW_IN_specialized_gap_12-336_v2.pickle.pickle"</span>)},</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'LW_IN'</span>, <span class="st">'model'</span>: l_model(<span class="st">"LW_IN_specialized_gap_12-336_v1.pickle"</span>)},</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'VPD'</span>,   <span class="st">'model'</span>: l_model(<span class="st">"VPD_specialized_gap_12-336_v1.pickle"</span>)},</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'WS'</span>,    <span class="st">'model'</span>: l_model(<span class="st">"WS_specialized_gap_12-336_v3.pickle"</span>)},</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'PA'</span>,    <span class="st">'model'</span>: l_model(<span class="st">"PA_specialized_gap_12-336_v3.pickle"</span>)},</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'P'</span>,     <span class="st">'model'</span>: l_model(<span class="st">"P_specialized_gap_12-336_v1.pickle"</span>)},</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'TS'</span>,    <span class="st">'model'</span>: l_model(<span class="st">"TS_specialized_gap_12-336_v3.pickle"</span>)},</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'var'</span>: <span class="st">'SWC'</span>,   <span class="st">'model'</span>: l_model(<span class="st">"SWC_specialized_gap_12-336_v3_4.pickle"</span>)},</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>models_var <span class="op">=</span> pd.DataFrame.from_records(models_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(cache_dir <span class="op">/</span> <span class="st">"the_results"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_the_results(n_rep<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    comp_Av <span class="op">=</span> ImpComparison(models <span class="op">=</span> models_var, df <span class="op">=</span> hai, control <span class="op">=</span> hai_era, block_len <span class="op">=</span> <span class="dv">446</span>, time_series<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    results_Av <span class="op">=</span> comp_Av.compare(gap_len <span class="op">=</span> [<span class="dv">12</span>,<span class="dv">24</span>, <span class="dv">48</span>, <span class="dv">336</span>], var<span class="op">=</span><span class="bu">list</span>(hai.columns), n_rep<span class="op">=</span>n_rep) </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_Av</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>results_Av <span class="op">=</span> get_the_results(n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a1472cdfc594451c97a04048a4e31b10","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>alt.data_transformers.disable_max_rows() <span class="co"># it is safe to do so as the plots are rendered using vl-convert and then showed as images</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>DataTransformerRegistry.enable('default')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> the_plot(results_Av)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"the_plot"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"the_plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="result_plotting_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> the_plot_stand(results_Av)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"the_plot_stand"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"the_plot_stand"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="result_plotting_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> the_plot_stand2(results_Av)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"the_plot_stand2"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"the_plot_stand2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="result_plotting_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> the_plot_stand3(results_Av)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"the_plot_stand3"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"the_plot_stand3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table" class="level3">
<h3 class="anchored" data-anchor-id="table">Table</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> the_table(results_Av)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>the_table_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"the_table.tex"</span>, label<span class="op">=</span><span class="st">"the_table"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                caption<span class="op">=</span><span class="st">"RMSE Comparison imputation methods. The best method for each gap length is highligthed in bold"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th colspan="2" data-halign="left">KalmanFilter</th>
<th colspan="2" data-halign="left">ERA</th>
<th colspan="2" data-halign="left">MDS</th>
</tr>
<tr class="odd">
<th></th>
<th>RMSE</th>
<th>mean</th>
<th>std</th>
<th>mean</th>
<th>std</th>
<th>mean</th>
<th>std</th>
</tr>
<tr class="header">
<th>Variable</th>
<th>Gap [$h$]</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="4" data-valign="top">TA</th>
<th>6.0</th>
<td>0.489414</td>
<td>0.286708</td>
<td>1.346910</td>
<td>0.997843</td>
<td>2.712546</td>
<td>1.896914</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.717705</td>
<td>0.450045</td>
<td>1.471695</td>
<td>0.900611</td>
<td>2.942435</td>
<td>1.748131</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.846503</td>
<td>0.424666</td>
<td>1.529614</td>
<td>0.800256</td>
<td>3.012819</td>
<td>1.611311</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>1.074202</td>
<td>0.465658</td>
<td>1.754334</td>
<td>0.643160</td>
<td>3.780087</td>
<td>1.315472</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">SW_IN</th>
<th>6.0</th>
<td>44.406835</td>
<td>41.185820</td>
<td>49.333113</td>
<td>66.241975</td>
<td>63.536627</td>
<td>85.401585</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>49.386211</td>
<td>34.587600</td>
<td>54.207691</td>
<td>49.769296</td>
<td>69.427115</td>
<td>68.936352</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>57.888189</td>
<td>29.905625</td>
<td>65.950367</td>
<td>40.930505</td>
<td>86.770917</td>
<td>59.603564</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>62.929765</td>
<td>25.382879</td>
<td>70.224393</td>
<td>34.883199</td>
<td>107.384249</td>
<td>53.606111</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">LW_IN</th>
<th>6.0</th>
<td>10.933181</td>
<td>8.117911</td>
<td>13.804628</td>
<td>12.987987</td>
<td>26.680077</td>
<td>15.022366</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>12.976946</td>
<td>8.420187</td>
<td>14.766929</td>
<td>12.584725</td>
<td>28.085478</td>
<td>13.457335</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>14.311389</td>
<td>8.301348</td>
<td>14.093052</td>
<td>12.227900</td>
<td>29.614461</td>
<td>12.416763</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>16.982041</td>
<td>6.724037</td>
<td>16.365697</td>
<td>11.129569</td>
<td>32.954558</td>
<td>8.833972</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">VPD</th>
<th>6.0</th>
<td>0.579836</td>
<td>0.454156</td>
<td>1.296787</td>
<td>1.547397</td>
<td>2.083592</td>
<td>2.149288</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.830825</td>
<td>0.620231</td>
<td>1.265213</td>
<td>1.288794</td>
<td>2.136626</td>
<td>2.095549</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.957941</td>
<td>0.616140</td>
<td>1.247527</td>
<td>1.032319</td>
<td>1.912472</td>
<td>1.605013</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>1.282954</td>
<td>0.735500</td>
<td>1.662069</td>
<td>1.127314</td>
<td>2.661345</td>
<td>1.965431</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">WS</th>
<th>6.0</th>
<td>0.604378</td>
<td>0.309739</td>
<td>0.912428</td>
<td>0.508295</td>
<td>1.136367</td>
<td>0.783146</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.701851</td>
<td>0.335770</td>
<td>0.956550</td>
<td>0.524247</td>
<td>1.261203</td>
<td>0.796744</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.786750</td>
<td>0.333186</td>
<td>0.949427</td>
<td>0.446912</td>
<td>1.275665</td>
<td>0.608630</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.946239</td>
<td>0.337541</td>
<td>1.088887</td>
<td>0.348541</td>
<td>1.494891</td>
<td>0.615371</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">PA</th>
<th>6.0</th>
<td>0.048172</td>
<td>0.039004</td>
<td>0.074856</td>
<td>0.061726</td>
<td>0.530665</td>
<td>0.441476</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.054868</td>
<td>0.044319</td>
<td>0.077328</td>
<td>0.058476</td>
<td>0.563603</td>
<td>0.427426</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.061694</td>
<td>0.040415</td>
<td>0.079021</td>
<td>0.051491</td>
<td>0.556899</td>
<td>0.404451</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.067441</td>
<td>0.047825</td>
<td>0.083628</td>
<td>0.053654</td>
<td>0.773143</td>
<td>0.384029</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">P</th>
<th>6.0</th>
<td>0.111547</td>
<td>0.253684</td>
<td>0.113173</td>
<td>0.315504</td>
<td>0.117710</td>
<td>0.305539</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.134660</td>
<td>0.248484</td>
<td>0.138729</td>
<td>0.297227</td>
<td>0.130442</td>
<td>0.281377</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.156399</td>
<td>0.242352</td>
<td>0.165750</td>
<td>0.288432</td>
<td>0.158641</td>
<td>0.265257</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.195263</td>
<td>0.175225</td>
<td>0.222682</td>
<td>0.201782</td>
<td>0.214975</td>
<td>0.197499</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">SWC</th>
<th>6.0</th>
<td>0.509564</td>
<td>0.363343</td>
<td>NaN</td>
<td>NaN</td>
<td>1.313730</td>
<td>1.556829</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.610184</td>
<td>0.439400</td>
<td>NaN</td>
<td>NaN</td>
<td>1.278001</td>
<td>1.323011</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.755764</td>
<td>0.582507</td>
<td>NaN</td>
<td>NaN</td>
<td>1.355740</td>
<td>1.472185</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>1.592585</td>
<td>1.258741</td>
<td>NaN</td>
<td>NaN</td>
<td>1.947605</td>
<td>1.488284</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">TS</th>
<th>6.0</th>
<td>0.372636</td>
<td>0.333516</td>
<td>NaN</td>
<td>NaN</td>
<td>0.954469</td>
<td>0.889126</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.611555</td>
<td>0.645607</td>
<td>NaN</td>
<td>NaN</td>
<td>1.002555</td>
<td>0.876784</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.916664</td>
<td>0.733149</td>
<td>NaN</td>
<td>NaN</td>
<td>1.078373</td>
<td>0.856964</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>1.401425</td>
<td>0.800632</td>
<td>NaN</td>
<td>NaN</td>
<td>1.440008</td>
<td>0.764040</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> the_table(results_Av, <span class="st">'rmse_stand'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>the_table_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"the_table_stand.tex"</span>, stand <span class="op">=</span> <span class="va">True</span>, label<span class="op">=</span><span class="st">"the_table_stand"</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                caption <span class="op">=</span> <span class="st">"Comparison of imputation methods using Standardized RMSE. The best method for each gap length is highligthed in bold"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th colspan="2" data-halign="left">KalmanFilter</th>
<th colspan="2" data-halign="left">ERA</th>
<th colspan="2" data-halign="left">MDS</th>
</tr>
<tr class="odd">
<th></th>
<th>RMSE</th>
<th>mean</th>
<th>std</th>
<th>mean</th>
<th>std</th>
<th>mean</th>
<th>std</th>
</tr>
<tr class="header">
<th>Variable</th>
<th>Gap [$h$]</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th rowspan="4" data-valign="top">TA</th>
<th>6.0</th>
<td>0.061759</td>
<td>0.036179</td>
<td>0.169965</td>
<td>0.125917</td>
<td>0.342294</td>
<td>0.239370</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.090567</td>
<td>0.056791</td>
<td>0.185712</td>
<td>0.113647</td>
<td>0.371303</td>
<td>0.220595</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.106819</td>
<td>0.053588</td>
<td>0.193021</td>
<td>0.100984</td>
<td>0.380185</td>
<td>0.203330</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.135553</td>
<td>0.058761</td>
<td>0.221378</td>
<td>0.081160</td>
<td>0.477006</td>
<td>0.165998</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">SW_IN</th>
<th>6.0</th>
<td>0.217678</td>
<td>0.201889</td>
<td>0.241826</td>
<td>0.324711</td>
<td>0.311450</td>
<td>0.418630</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.242086</td>
<td>0.169545</td>
<td>0.265721</td>
<td>0.243964</td>
<td>0.340325</td>
<td>0.337919</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.283762</td>
<td>0.146594</td>
<td>0.323282</td>
<td>0.200637</td>
<td>0.425342</td>
<td>0.292171</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.308475</td>
<td>0.124424</td>
<td>0.344233</td>
<td>0.170994</td>
<td>0.526387</td>
<td>0.262772</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">LW_IN</th>
<th>6.0</th>
<td>0.260588</td>
<td>0.193487</td>
<td>0.329028</td>
<td>0.309564</td>
<td>0.635910</td>
<td>0.358053</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.309301</td>
<td>0.200692</td>
<td>0.351964</td>
<td>0.299952</td>
<td>0.669407</td>
<td>0.320751</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.341107</td>
<td>0.197860</td>
<td>0.335903</td>
<td>0.291448</td>
<td>0.705850</td>
<td>0.295949</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.404761</td>
<td>0.160265</td>
<td>0.390071</td>
<td>0.265269</td>
<td>0.785460</td>
<td>0.210555</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">VPD</th>
<th>6.0</th>
<td>0.132734</td>
<td>0.103964</td>
<td>0.296855</td>
<td>0.354224</td>
<td>0.476967</td>
<td>0.492006</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.190189</td>
<td>0.141981</td>
<td>0.289627</td>
<td>0.295025</td>
<td>0.489108</td>
<td>0.479704</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.219288</td>
<td>0.141044</td>
<td>0.285579</td>
<td>0.236314</td>
<td>0.437795</td>
<td>0.367413</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.293689</td>
<td>0.168368</td>
<td>0.380474</td>
<td>0.258060</td>
<td>0.609224</td>
<td>0.449918</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">WS</th>
<th>6.0</th>
<td>0.371828</td>
<td>0.190559</td>
<td>0.561347</td>
<td>0.312715</td>
<td>0.699120</td>
<td>0.481810</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.431795</td>
<td>0.206574</td>
<td>0.588492</td>
<td>0.322529</td>
<td>0.775922</td>
<td>0.490176</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.484027</td>
<td>0.204984</td>
<td>0.584110</td>
<td>0.274951</td>
<td>0.784819</td>
<td>0.374443</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.582148</td>
<td>0.207663</td>
<td>0.669909</td>
<td>0.214431</td>
<td>0.919692</td>
<td>0.378591</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">PA</th>
<th>6.0</th>
<td>0.056331</td>
<td>0.045611</td>
<td>0.087534</td>
<td>0.072180</td>
<td>0.620545</td>
<td>0.516250</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.064161</td>
<td>0.051826</td>
<td>0.090425</td>
<td>0.068381</td>
<td>0.659061</td>
<td>0.499820</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.072144</td>
<td>0.047260</td>
<td>0.092405</td>
<td>0.060212</td>
<td>0.651223</td>
<td>0.472953</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.078864</td>
<td>0.055925</td>
<td>0.097793</td>
<td>0.062741</td>
<td>0.904092</td>
<td>0.449073</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">P</th>
<th>6.0</th>
<td>0.397991</td>
<td>0.905123</td>
<td>0.403790</td>
<td>1.125691</td>
<td>0.419979</td>
<td>1.090136</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.480457</td>
<td>0.886571</td>
<td>0.494974</td>
<td>1.060481</td>
<td>0.465404</td>
<td>1.003928</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.558019</td>
<td>0.864691</td>
<td>0.591382</td>
<td>1.029100</td>
<td>0.566018</td>
<td>0.946414</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.696682</td>
<td>0.625189</td>
<td>0.794512</td>
<td>0.719941</td>
<td>0.767011</td>
<td>0.704660</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">SWC</th>
<th>6.0</th>
<td>0.057170</td>
<td>0.040765</td>
<td>NaN</td>
<td>NaN</td>
<td>0.147393</td>
<td>0.174667</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.068459</td>
<td>0.049298</td>
<td>NaN</td>
<td>NaN</td>
<td>0.143384</td>
<td>0.148434</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.084792</td>
<td>0.065354</td>
<td>NaN</td>
<td>NaN</td>
<td>0.152106</td>
<td>0.165171</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.178679</td>
<td>0.141223</td>
<td>NaN</td>
<td>NaN</td>
<td>0.218510</td>
<td>0.166977</td>
</tr>
<tr class="odd">
<th rowspan="4" data-valign="top">TS</th>
<th>6.0</th>
<td>0.065853</td>
<td>0.058939</td>
<td>NaN</td>
<td>NaN</td>
<td>0.168674</td>
<td>0.157127</td>
</tr>
<tr class="even">
<th>12.0</th>
<td>0.108074</td>
<td>0.114092</td>
<td>NaN</td>
<td>NaN</td>
<td>0.177172</td>
<td>0.154946</td>
</tr>
<tr class="odd">
<th>24.0</th>
<td>0.161994</td>
<td>0.129563</td>
<td>NaN</td>
<td>NaN</td>
<td>0.190571</td>
<td>0.151443</td>
</tr>
<tr class="even">
<th>168.0</th>
<td>0.247661</td>
<td>0.141488</td>
<td>NaN</td>
<td>NaN</td>
<td>0.254479</td>
<td>0.135022</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="timeseries" class="level3">
<h3 class="anchored" data-anchor-id="timeseries">Timeseries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(cache_dir <span class="op">/</span> <span class="st">"the_results_ts"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_the_results_ts():</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    comp_Av <span class="op">=</span> ImpComparison(models <span class="op">=</span> models_var, df <span class="op">=</span> hai, control <span class="op">=</span> hai_era, block_len <span class="op">=</span> <span class="dv">446</span>, time_series<span class="op">=</span><span class="va">True</span>, rmse<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    results_Av <span class="op">=</span> comp_Av.compare(gap_len <span class="op">=</span> [<span class="dv">12</span>,<span class="dv">24</span>, <span class="dv">336</span>], var<span class="op">=</span><span class="bu">list</span>(hai.columns), n_rep<span class="op">=</span><span class="dv">4</span>) </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_Av</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># results_ts = get_the_results_ts()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ts = plot_timeseries(results_ts.query("var in ['TA', 'SW_IN', 'LW_IN', 'VPD', 'WS']"), idx_rep=0)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># save_plot(ts, "timeseries_1")</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"timeseries_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="result_plotting_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %time ts = plot_timeseries(results_ts.query("var in ['PA', 'P', 'TS', 'SWC']"), idx_rep=0)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %time save_plot(ts, "timeseries_2")</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>show_plot(<span class="st">"timeseries_2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>results_ts.idx_rep.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @cache_disk(cache_dir / "ts_plot")</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_additional_ts():</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx <span class="kw">in</span> tqdm(results_ts.idx_rep.unique()):</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span>: <span class="cf">continue</span> <span class="co"># skip first plot as is done above</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        ts1 <span class="op">=</span> plot_timeseries(results_ts.query(<span class="st">"var in ['TA', 'SW_IN', 'LW_IN', 'VPD', 'WS']"</span>), idx_rep<span class="op">=</span>idx)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        save_plot(ts1, <span class="ss">f"timeseries_1_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        ts2 <span class="op">=</span> plot_timeseries(results_ts.query(<span class="st">"var in ['PA', 'P', 'TS', 'SWC']"</span>), idx_rep<span class="op">=</span>idx)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        save_plot(ts2, <span class="ss">f"timeseries_2_</span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span>)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_additional_ts()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="kalman-filter-analysis" class="level2">
<h2 class="anchored" data-anchor-id="kalman-filter-analysis">Kalman Filter analysis</h2>
<section id="gap-len" class="level3">
<h3 class="anchored" data-anchor-id="gap-len">Gap len</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(<span class="st">"gap_len"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_g_len(n_rep<span class="op">=</span>n_rep):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> KalmanImpComparison(models_var, hai, hai_era, block_len<span class="op">=</span><span class="dv">48</span><span class="op">*</span><span class="dv">7</span><span class="op">+</span><span class="dv">100</span>).compare(gap_len <span class="op">=</span> [<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">24</span>,<span class="dv">48</span>,<span class="dv">48</span><span class="op">*</span><span class="dv">2</span>, <span class="dv">48</span><span class="op">*</span><span class="dv">3</span>, <span class="dv">48</span><span class="op">*</span><span class="dv">7</span>], var<span class="op">=</span><span class="bu">list</span>(hai.columns), n_rep<span class="op">=</span>n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>gap_len <span class="op">=</span> get_g_len(n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5dfc22866cf74b3cba25b82464d63566","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> plot_gap_len(gap_len, hai, hai_era)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"gap_len"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-d34f77e73b8c419c87bbbd3627e5a7fc"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d34f77e73b8c419c87bbbd3627e5a7fc") {
      outputDiv = document.getElementById("altair-viz-d34f77e73b8c419c87bbbd3627e5a7fc");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}, "legend": {"orient": "bottom"}}, "vconcat": [{"hconcat": [{"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE TA [\u00b0C]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE TA [\u00b0C]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 1.8708585984196093}}}], "height": 150, "title": "TA", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE SW_IN [W m-2]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE SW_IN [W m-2]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 76.32033545126399}}}], "data": {"name": "data-2ec5c4f3b71dfac3e14b1e6be25c1ec0"}, "height": 150, "title": "SW_IN", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE LW_IN [W m-2]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE LW_IN [W m-2]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 20.204069784984792}}}], "data": {"name": "data-3f2583a1b59cbb1a16089bd6506d4ad9"}, "height": 150, "title": "LW_IN", "width": 200}], "data": {"name": "data-a610c6e0f9037a18a4abbffdb5b7a99f"}}, {"hconcat": [{"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE VPD [hPa]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE VPD [hPa]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 2.0213771447538154}}}], "height": 150, "title": "VPD", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE WS [m s-1]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE WS [m s-1]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 1.2079493085091668}}}], "data": {"name": "data-a6efa43b6ecc6af260d1679ccad61c91"}, "height": 150, "title": "WS", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE PA [hPa]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE PA [hPa]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 0.10478101525377641}}}], "data": {"name": "data-d4e0bc082972cab86f4cef921f2f3724"}, "height": 150, "title": "PA", "width": 200}], "data": {"name": "data-0b56767797d21795956d347cb71d0ffe"}}, {"hconcat": [{"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE P [mm]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE P [mm]", "type": "quantitative"}, "y2": {"field": "Q3"}}}, {"mark": {"type": "rule", "strokeDash": [2, 4]}, "encoding": {"y": {"datum": 0.29305836320561346}}}], "height": 150, "title": "P", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE SWC [%]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE SWC [%]", "type": "quantitative"}, "y2": {"field": "Q3"}}}], "data": {"name": "data-b4478ed1e46c9942fea2a8ab136217a4"}, "height": 150, "title": "SWC", "width": 200}, {"layer": [{"mark": "line", "encoding": {"color": {"field": "var", "scale": {"domain": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "SWC", "TS", "P"], "range": ["#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"]}, "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"axis": {"labelAngle": 0}, "field": "gap_len", "title": "gap_len [h]", "type": "quantitative"}, "y": {"field": "median", "title": "RMSE TS [\u00b0C]", "type": "quantitative"}}}, {"mark": "errorband", "encoding": {"color": {"field": "var", "sort": ["TA", "SW_IN", "LW_IN", "VPD", "WS", "PA", "P", "SWC", "TS"], "type": "ordinal"}, "x": {"field": "gap_len", "type": "quantitative"}, "y": {"field": "Q1", "title": "RMSE TS [\u00b0C]", "type": "quantitative"}, "y2": {"field": "Q3"}}}], "data": {"name": "data-a966d1a156a8e6bd9965b3a96a44b1ca"}, "height": 150, "title": "TS", "width": 200}], "data": {"name": "data-5f93be1a851329d2d67c2f3aa55be08d"}}], "resolve": {"scale": {"xOffset": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-a610c6e0f9037a18a4abbffdb5b7a99f": [{"var": "TA", "gap_len": 12.0, "median": 0.6451874244156406, "Q1": 0.4545097209059213, "Q3": 0.8997396454893679, "min": 0.17023243415841394, "max": 2.8956113257125318, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 72.0, "median": 0.8983029192994034, "Q1": 0.7086677975867871, "Q3": 1.1543760121695, "min": 0.3675606485965737, "max": 5.863185980303428, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 48.0, "median": 0.8674516176111547, "Q1": 0.6249295632284256, "Q3": 1.1569488032853812, "min": 0.3277379480638622, "max": 6.690721182212841, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 168.0, "median": 0.930269815429269, "Q1": 0.7821297450495318, "Q3": 1.1969006433852238, "min": 0.4517497721203587, "max": 4.636266559846758, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 3.0, "median": 0.3199842787396934, "Q1": 0.21075609780331375, "Q3": 0.4529052679030623, "min": 0.06666322159435904, "max": 1.3413916150947607, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 24.0, "median": 0.7711393941550546, "Q1": 0.5266074804586034, "Q3": 1.1056349252864852, "min": 0.21994983888893238, "max": 5.428126873238023, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 1.0, "median": 0.18646542709756503, "Q1": 0.10668096790633916, "Q3": 0.3504748828575879, "min": 0.0035563311408775364, "max": 1.3319081543875377, "era_rmse": 1.8708585984196093}, {"var": "TA", "gap_len": 6.0, "median": 0.46337888101679203, "Q1": 0.3177203423666509, "Q3": 0.6450331043967823, "min": 0.09822841208361008, "max": 2.789359888577627, "era_rmse": 1.8708585984196093}], "data-2ec5c4f3b71dfac3e14b1e6be25c1ec0": [{"var": "SW_IN", "gap_len": 72.0, "median": 56.711376062086934, "Q1": 36.04565874035435, "Q3": 79.05445573958423, "min": 15.199937291248203, "max": 146.64087445012902, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 12.0, "median": 37.88833778603986, "Q1": 26.186150788732814, "Q3": 64.64211431167438, "min": 9.070885415061108, "max": 236.44056350761235, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 1.0, "median": 12.513145555693944, "Q1": 5.504548582461179, "Q3": 26.386840196604627, "min": 0.3351464751771737, "max": 300.12413901849555, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 24.0, "median": 50.792186125241, "Q1": 34.77839871880886, "Q3": 77.99090873626434, "min": 10.465980469272049, "max": 174.25563229376982, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 48.0, "median": 54.9964103549772, "Q1": 36.125746440486054, "Q3": 75.40874508837754, "min": 13.709921543163695, "max": 143.9214874877496, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 3.0, "median": 25.52678175534132, "Q1": 13.651093523710683, "Q3": 50.71086839226049, "min": 2.6442429736446393, "max": 281.13438819425664, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 168.0, "median": 56.97606246187564, "Q1": 38.93217324427058, "Q3": 80.01443657999025, "min": 20.4215634530741, "max": 121.37724952021227, "era_rmse": 76.32033545126399}, {"var": "SW_IN", "gap_len": 6.0, "median": 29.006789177762684, "Q1": 17.399744778478187, "Q3": 58.89195933998963, "min": 3.9993372687725515, "max": 291.65769829507735, "era_rmse": 76.32033545126399}], "data-3f2583a1b59cbb1a16089bd6506d4ad9": [{"var": "LW_IN", "gap_len": 48.0, "median": 15.800686161103418, "Q1": 9.15831172717969, "Q3": 21.620845033340526, "min": 3.6574297677525576, "max": 60.08167614329456, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 12.0, "median": 12.41118636836784, "Q1": 6.943938916246323, "Q3": 19.10582428856474, "min": 1.6506030889117236, "max": 73.71391333731368, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 6.0, "median": 9.531753621362903, "Q1": 4.956130754353428, "Q3": 17.139219485375005, "min": 1.5568914905083107, "max": 40.381644673812495, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 3.0, "median": 6.0890068940567375, "Q1": 3.194956451154386, "Q3": 10.390454156090188, "min": 0.4257220678942461, "max": 53.67194218908541, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 72.0, "median": 16.953359803306903, "Q1": 9.34451913202838, "Q3": 21.25215563477596, "min": 3.5236096783348945, "max": 40.02812049713582, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 24.0, "median": 14.433356561779528, "Q1": 8.45615408125689, "Q3": 21.38095017472619, "min": 2.0678655140841604, "max": 59.500680479355715, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 168.0, "median": 18.112128181758507, "Q1": 10.107881408646337, "Q3": 21.86213749294222, "min": 4.66466833040424, "max": 49.24920081881161, "era_rmse": 20.204069784984792}, {"var": "LW_IN", "gap_len": 1.0, "median": 3.263941382433087, "Q1": 1.4124887744282995, "Q3": 8.019020851402857, "min": 0.016668206910369104, "max": 38.35261989152817, "era_rmse": 20.204069784984792}], "data-0b56767797d21795956d347cb71d0ffe": [{"var": "VPD", "gap_len": 48.0, "median": 0.9292288708317081, "Q1": 0.6815649077682079, "Q3": 1.3111838039372148, "min": 0.2734979411817652, "max": 6.932544824383358, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 6.0, "median": 0.4933382222633519, "Q1": 0.3291626051335676, "Q3": 0.7489005907099319, "min": 0.09176084143687475, "max": 3.7096583098729785, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 24.0, "median": 0.8625025538552813, "Q1": 0.61802945999871, "Q3": 1.354202174822537, "min": 0.14914921005644877, "max": 4.2481274662642585, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 3.0, "median": 0.3467416489137799, "Q1": 0.21537990033893398, "Q3": 0.5049470772965499, "min": 0.052764355561691824, "max": 2.987474967070483, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 1.0, "median": 0.20685303345310246, "Q1": 0.10566451827855593, "Q3": 0.36878708180822856, "min": 0.000984127196162486, "max": 2.661243924391444, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 72.0, "median": 1.0021616346942606, "Q1": 0.7354250297254435, "Q3": 1.4554454166286401, "min": 0.3874859079743897, "max": 5.075072847180036, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 12.0, "median": 0.6306356894163663, "Q1": 0.4371335877937592, "Q3": 0.983182189652907, "min": 0.15911636190359238, "max": 4.553053790487561, "era_rmse": 2.0213771447538154}, {"var": "VPD", "gap_len": 168.0, "median": 1.036598906981298, "Q1": 0.8025904937500062, "Q3": 1.4585367318112419, "min": 0.40413359334078, "max": 5.138541181286804, "era_rmse": 2.0213771447538154}], "data-a6efa43b6ecc6af260d1679ccad61c91": [{"var": "WS", "gap_len": 3.0, "median": 0.4276270373111051, "Q1": 0.2972160363507806, "Q3": 0.5883758990238148, "min": 0.02652418269270529, "max": 2.4769233271192985, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 48.0, "median": 0.761547928866241, "Q1": 0.6477810272030158, "Q3": 0.9344334340809278, "min": 0.23048322996218149, "max": 2.4156835138596575, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 72.0, "median": 0.8415652713079578, "Q1": 0.6970346715116656, "Q3": 1.0579372867433907, "min": 0.28576225178074516, "max": 2.371089063148655, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 12.0, "median": 0.6316511390689934, "Q1": 0.5054055704220398, "Q3": 0.8656062609913304, "min": 0.09310336657931076, "max": 2.446281794196259, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 6.0, "median": 0.5034425238768485, "Q1": 0.3560746454991915, "Q3": 0.735312685675902, "min": 0.03573661880862524, "max": 2.6495668945530215, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 24.0, "median": 0.7109696855120375, "Q1": 0.5432534126913338, "Q3": 0.9209455000433894, "min": 0.18032386080348606, "max": 2.2575616667772853, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 1.0, "median": 0.2792030380091788, "Q1": 0.16594615478528502, "Q3": 0.4342149706206724, "min": 0.011461475890401472, "max": 2.005726732234763, "era_rmse": 1.2079493085091668}, {"var": "WS", "gap_len": 168.0, "median": 0.848540117051747, "Q1": 0.7408240330472718, "Q3": 1.0203801342922043, "min": 0.35346426763397554, "max": 2.4105978369873857, "era_rmse": 1.2079493085091668}], "data-d4e0bc082972cab86f4cef921f2f3724": [{"var": "PA", "gap_len": 168.0, "median": 0.06069909514037285, "Q1": 0.049847276366308944, "Q3": 0.07410326849247692, "min": 0.029282055881946135, "max": 0.7000637481432187, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 24.0, "median": 0.05022659042663924, "Q1": 0.03866830069857116, "Q3": 0.06781547689772609, "min": 0.019938706683369722, "max": 0.5937294556949563, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 72.0, "median": 0.059344045496117354, "Q1": 0.04598863487441771, "Q3": 0.07464004468895931, "min": 0.023021456557472474, "max": 0.8917099483468178, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 48.0, "median": 0.057316123109868694, "Q1": 0.04391489389608686, "Q3": 0.07341913980640488, "min": 0.0272986836864442, "max": 0.6303542501753223, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 1.0, "median": 0.017981516188468168, "Q1": 0.010011804274726676, "Q3": 0.03109901452126873, "min": 0.0003967477345305908, "max": 0.200606491603531, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 12.0, "median": 0.04552499310525802, "Q1": 0.03252032083187478, "Q3": 0.06685316070875212, "min": 0.010266343583000598, "max": 0.21496709452310953, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 6.0, "median": 0.03661778204946631, "Q1": 0.02639633445737691, "Q3": 0.052615639094942414, "min": 0.0073261575785758225, "max": 0.4026929590389263, "era_rmse": 0.10478101525377641}, {"var": "PA", "gap_len": 3.0, "median": 0.030308028594853542, "Q1": 0.017889411754770376, "Q3": 0.04506112550318123, "min": 0.0007247932799043834, "max": 0.3489716650366981, "era_rmse": 0.10478101525377641}], "data-5f93be1a851329d2d67c2f3aa55be08d": [{"var": "P", "gap_len": 3.0, "median": 0.04126244774740223, "Q1": 0.02543708485645416, "Q3": 0.08445876811976652, "min": 0.0018329925543883047, "max": 1.5329242852829206, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 168.0, "median": 0.13827921362002565, "Q1": 0.08884747635648711, "Q3": 0.21260633843966992, "min": 0.02965802223052039, "max": 1.121986315246851, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 24.0, "median": 0.08150339140072649, "Q1": 0.05059450933171217, "Q3": 0.1710759158779779, "min": 0.014886740572679285, "max": 2.031645052708505, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 1.0, "median": 0.025437609800739166, "Q1": 0.011790188562026413, "Q3": 0.05601653653863997, "min": 0.000664143649625552, "max": 1.661329207150632, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 12.0, "median": 0.06744549074125142, "Q1": 0.04451142474414902, "Q3": 0.14036346754197498, "min": 0.014662545722140534, "max": 2.0394614599553074, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 48.0, "median": 0.09523393526162752, "Q1": 0.060497584132765306, "Q3": 0.20056584335538083, "min": 0.02346421658863882, "max": 1.5908537154801585, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 6.0, "median": 0.05284795641785457, "Q1": 0.032231246454160006, "Q3": 0.09985357021919535, "min": 0.010305207879582343, "max": 2.905301858225579, "era_rmse": 0.29305836320561346}, {"var": "P", "gap_len": 72.0, "median": 0.12242637028217658, "Q1": 0.06248736644192666, "Q3": 0.24035358429664863, "min": 0.023730175706761933, "max": 1.075962475727055, "era_rmse": 0.29305836320561346}], "data-b4478ed1e46c9942fea2a8ab136217a4": [{"var": "SWC", "gap_len": 48.0, "median": 0.6860995061010421, "Q1": 0.5259725768903538, "Q3": 1.112101167281425, "min": 0.18395556549067005, "max": 4.398664474356972, "era_rmse": null}, {"var": "SWC", "gap_len": 3.0, "median": 0.3024816445451021, "Q1": 0.19134407690042277, "Q3": 0.4929334416426136, "min": 0.041205969414559, "max": 2.8177500870814924, "era_rmse": null}, {"var": "SWC", "gap_len": 1.0, "median": 0.20866189913768793, "Q1": 0.11728901836733259, "Q3": 0.35828394794053253, "min": 0.0048289544372941305, "max": 1.2596776301638288, "era_rmse": null}, {"var": "SWC", "gap_len": 24.0, "median": 0.5545585162659864, "Q1": 0.4144787631913127, "Q3": 0.8156599431091465, "min": 0.1601102812843235, "max": 3.5973875742930246, "era_rmse": null}, {"var": "SWC", "gap_len": 168.0, "median": 1.2402652775880232, "Q1": 0.8606554199967849, "Q3": 1.9273786862270859, "min": 0.38591444695059984, "max": 9.073639818983548, "era_rmse": null}, {"var": "SWC", "gap_len": 12.0, "median": 0.48493629209024186, "Q1": 0.3738971275465361, "Q3": 0.6665995447527042, "min": 0.12222300215328993, "max": 3.529120349892254, "era_rmse": null}, {"var": "SWC", "gap_len": 6.0, "median": 0.41279420694973706, "Q1": 0.2907473057639287, "Q3": 0.5975690338483897, "min": 0.09487613095984326, "max": 2.630986825663863, "era_rmse": null}, {"var": "SWC", "gap_len": 72.0, "median": 0.7654014056918699, "Q1": 0.5441080233322397, "Q3": 1.1975758666447067, "min": 0.31572090063616853, "max": 8.971525082383552, "era_rmse": null}], "data-a966d1a156a8e6bd9965b3a96a44b1ca": [{"var": "TS", "gap_len": 6.0, "median": 0.3034613323381031, "Q1": 0.2068867087257194, "Q3": 0.4619891314542776, "min": 0.04012082088214932, "max": 4.030870403332165, "era_rmse": null}, {"var": "TS", "gap_len": 1.0, "median": 0.15603689311471328, "Q1": 0.08150993229338181, "Q3": 0.2682753866581225, "min": 0.0073129494082148925, "max": 2.074637673100615, "era_rmse": null}, {"var": "TS", "gap_len": 168.0, "median": 1.2364895526298119, "Q1": 0.9343062519778919, "Q3": 1.6961531150028388, "min": 0.553920829445721, "max": 6.129478257442988, "era_rmse": null}, {"var": "TS", "gap_len": 3.0, "median": 0.24194836098390318, "Q1": 0.15402704568178274, "Q3": 0.3695938291147958, "min": 0.02487348512183009, "max": 1.1736805921909697, "era_rmse": null}, {"var": "TS", "gap_len": 12.0, "median": 0.4403159702495452, "Q1": 0.32647471244142723, "Q3": 0.7202530073797775, "min": 0.07177443466563267, "max": 4.570174885547674, "era_rmse": null}, {"var": "TS", "gap_len": 72.0, "median": 1.0122932865137966, "Q1": 0.8105361369145008, "Q3": 1.4366329052896814, "min": 0.3854413244173969, "max": 6.152535624578451, "era_rmse": null}, {"var": "TS", "gap_len": 24.0, "median": 0.7053284054875409, "Q1": 0.4810709975942961, "Q3": 1.011711956585478, "min": 0.1307414765384736, "max": 9.191291031941054, "era_rmse": null}, {"var": "TS", "gap_len": 48.0, "median": 0.912607180465292, "Q1": 0.6634635083509048, "Q3": 1.263577032220135, "min": 0.1942069815061035, "max": 6.629550921444138, "era_rmse": null}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> table_gap_len(gap_len)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>table_gap_len_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"gap_len.tex"</span>, label<span class="op">=</span><span class="st">"gap_len"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                caption<span class="op">=</span><span class="st">"RMSE Comparison Kalman filter for different gap lengths"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped" data-border="1">
<thead>
<tr class="header">
<th></th>
<th></th>
<th>1</th>
<th>3</th>
<th>6</th>
<th>12</th>
<th>24</th>
<th>48</th>
<th>72</th>
<th>168</th>
</tr>
<tr class="odd">
<th>Variable</th>
<th>RMSE</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th>TA</th>
<th>mean</th>
<td>0.249874</td>
<td>0.369584</td>
<td>0.544200</td>
<td>0.721894</td>
<td>0.911514</td>
<td>0.996244</td>
<td>1.033084</td>
<td>1.062626</td>
</tr>
<tr class="even">
<th>SW_IN</th>
<th>mean</th>
<td>27.218983</td>
<td>39.195194</td>
<td>46.166472</td>
<td>50.616872</td>
<td>57.511795</td>
<td>57.831439</td>
<td>59.806769</td>
<td>60.254291</td>
</tr>
<tr class="odd">
<th>LW_IN</th>
<th>mean</th>
<td>5.760089</td>
<td>8.424112</td>
<td>12.038032</td>
<td>14.447153</td>
<td>16.137752</td>
<td>16.569009</td>
<td>16.380740</td>
<td>17.414271</td>
</tr>
<tr class="even">
<th>VPD</th>
<th>mean</th>
<td>0.283951</td>
<td>0.430531</td>
<td>0.615616</td>
<td>0.826526</td>
<td>1.098688</td>
<td>1.148027</td>
<td>1.219952</td>
<td>1.236631</td>
</tr>
<tr class="odd">
<th>WS</th>
<th>mean</th>
<td>0.349414</td>
<td>0.481933</td>
<td>0.589038</td>
<td>0.705312</td>
<td>0.785513</td>
<td>0.842590</td>
<td>0.919232</td>
<td>0.921488</td>
</tr>
<tr class="even">
<th>PA</th>
<th>mean</th>
<td>0.023761</td>
<td>0.035799</td>
<td>0.047033</td>
<td>0.054201</td>
<td>0.060738</td>
<td>0.069416</td>
<td>0.070363</td>
<td>0.068169</td>
</tr>
<tr class="odd">
<th>P</th>
<th>mean</th>
<td>0.061754</td>
<td>0.086840</td>
<td>0.111877</td>
<td>0.145961</td>
<td>0.171795</td>
<td>0.163256</td>
<td>0.169645</td>
<td>0.187402</td>
</tr>
<tr class="even">
<th>SWC</th>
<th>mean</th>
<td>0.250153</td>
<td>0.388866</td>
<td>0.482214</td>
<td>0.585416</td>
<td>0.718911</td>
<td>0.930457</td>
<td>1.038485</td>
<td>1.533061</td>
</tr>
<tr class="odd">
<th>TS</th>
<th>mean</th>
<td>0.214781</td>
<td>0.291131</td>
<td>0.394747</td>
<td>0.617634</td>
<td>0.899105</td>
<td>1.084576</td>
<td>1.238317</td>
<td>1.458591</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with open(base_path_tbl / "gap_len.tex") as f:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f.readlines())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> meteo_imp.kalman.results <span class="im">import</span> _get_era_rmse, _plot_gap_len</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> prep_df(agg_gap_len(gap_len))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.merge(data, _get_era_rmse(hai, hai_era), on<span class="op">=</span><span class="st">'var'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data.method <span class="op">==</span> <span class="st">'KalmanFilter'</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.astype({<span class="st">'gap_len'</span>: <span class="bu">float</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data.era_rmse <span class="op">=</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data.query(<span class="st">"var == 'SWC'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>_plot_gap_len(data.query(<span class="st">"var == 'SWC'"</span>), <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="control" class="level3">
<h3 class="anchored" data-anchor-id="control">Control</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>models_nc <span class="op">=</span> pd.DataFrame({<span class="st">'model'</span>: [ l_model(<span class="st">"1_gap_varying_336_no_control_v1.pickle"</span>), l_model(<span class="st">"1_gap_varying_12-336_v1.pickle"</span>)],</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'type'</span>:   [ <span class="st">'No Control'</span>,                                       <span class="st">'Use Control'</span>                         ]})                                        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(<span class="st">"use_control"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_control(n_rep<span class="op">=</span>n_rep):</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    kcomp_control <span class="op">=</span> KalmanImpComparison(models_nc, hai, hai_era, block_len<span class="op">=</span><span class="dv">100</span><span class="op">+</span><span class="dv">48</span><span class="op">*</span><span class="dv">7</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    k_results_control <span class="op">=</span> kcomp_control.compare(n_rep <span class="op">=</span>n_rep, gap_len <span class="op">=</span> [<span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">48</span>, <span class="dv">48</span><span class="op">*</span><span class="dv">7</span>], var <span class="op">=</span> <span class="bu">list</span>(hai.columns))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> k_results_control</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>k_results_control <span class="op">=</span> get_control(n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>k_results_control</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> plot_compare(k_results_control, <span class="st">'type'</span>, scale_domain<span class="op">=</span>[<span class="st">"Use Control"</span>, <span class="st">"No Control"</span>])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"use_control"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> table_compare(k_results_control, <span class="st">'type'</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>table_compare_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"control.tex"</span>, label<span class="op">=</span><span class="st">"control"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                caption<span class="op">=</span><span class="st">"Comparison between generic model with control variable (Use Control) and generic model without control variable (No Control). 50 samples for each variable and each gap length. The best result for each for each gap length is highligthed in bold"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gap-in-other-variables" class="level3">
<h3 class="anchored" data-anchor-id="gap-in-other-variables">Gap in Other variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>models_gap_all <span class="op">=</span> models_var.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>models_gap_all.model <span class="op">=</span> l_model(<span class="st">"All_gap_all_30_v1.pickle"</span>) </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>models_gap_all[<span class="st">'Gap'</span>] <span class="op">=</span> <span class="st">'All variables'</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>models_gap_all[<span class="st">'gap_single_var'</span>] <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>models_gap_all <span class="op">=</span> pd.concat([models_gap_all, models_var.assign(Gap <span class="op">=</span> <span class="st">'Only one var'</span>, gap_single_var <span class="op">=</span> <span class="va">True</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(<span class="st">"multi_gap"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_multi_gap(n_rep):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    kcomp_single <span class="op">=</span> KalmanImpComparison(models_gap_all, hai, hai_era, block_len<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kcomp_single.compare(n_rep <span class="op">=</span>n_rep, gap_len <span class="op">=</span> [<span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">30</span>], var <span class="op">=</span> <span class="bu">list</span>(hai.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>k_results_single <span class="op">=</span> get_multi_gap(n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> plot_compare(k_results_single, <span class="st">"Gap"</span>, scale_domain<span class="op">=</span>[<span class="st">"Only one var"</span>, <span class="st">"All variables"</span>])</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"gap_single_var"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> table_compare(k_results_single, <span class="st">'Gap'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>table_compare_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"gap_single_var.tex"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generic-vs-specialized" class="level3">
<h3 class="anchored" data-anchor-id="generic-vs-specialized">Generic vs Specialized</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>models_generic <span class="op">=</span> models_var.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>models_generic.model <span class="op">=</span> l_model(<span class="st">"1_gap_varying_12-336_v1.pickle"</span>) </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>models_generic[<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'Generic'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>models_generic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>models_var[<span class="st">'type'</span>] <span class="op">=</span> <span class="st">'Finetuned one var'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>models_gen_vs_spec <span class="op">=</span> pd.concat([models_generic, models_var])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>models_gen_vs_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(<span class="st">"generic"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_generic(n_rep<span class="op">=</span>n_rep):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    comp_generic <span class="op">=</span> KalmanImpComparison(models_gen_vs_spec, hai, hai_era, block_len<span class="op">=</span><span class="dv">100</span><span class="op">+</span><span class="dv">48</span><span class="op">*</span><span class="dv">7</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> comp_generic.compare(n_rep <span class="op">=</span>n_rep, gap_len <span class="op">=</span> [<span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">48</span>, <span class="dv">48</span><span class="op">*</span><span class="dv">7</span>], var <span class="op">=</span> <span class="bu">list</span>(hai.columns))</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>k_results_generic <span class="op">=</span> get_generic(n_rep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> plot_compare(k_results_generic, <span class="st">'type'</span>, scale_domain<span class="op">=</span>[<span class="st">"Finetuned one var"</span>, <span class="st">"Generic"</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>save_plot(p, <span class="st">"generic"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> table_compare(k_results_generic, <span class="st">'type'</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>table_compare_latex(t, base_path_tbl <span class="op">/</span> <span class="st">"generic.tex"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="fluxnet" class="level2">
<h2 class="anchored" data-anchor-id="fluxnet">Fluxnet</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.vision.data <span class="im">import</span> get_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="correlation" class="level3">
<h3 class="anchored" data-anchor-id="correlation">Correlation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> auto_corr_df(data, nlags<span class="op">=</span><span class="dv">48</span>):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    autocorr <span class="op">=</span> {}</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> data.columns:</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        autocorr[col] <span class="op">=</span> sm.tsa.acf(data[col], nlags<span class="op">=</span>nlags)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(autocorr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>auto_corr <span class="op">=</span> auto_corr_df(hai).T[[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">24</span>,<span class="dv">48</span>]]</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>auto_corr.columns <span class="op">=</span> auto_corr.columns <span class="op">/</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> get_grid(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">8</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(hai.corr(), annot<span class="op">=</span><span class="va">True</span>,     vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>sns.diverging_palette(<span class="dv">20</span>, <span class="dv">220</span>, n<span class="op">=</span><span class="dv">200</span>), ax<span class="op">=</span>axes[<span class="dv">0</span>], square<span class="op">=</span><span class="va">True</span>, cbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(auto_corr, annot<span class="op">=</span><span class="va">True</span>,     vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>sns.diverging_palette(<span class="dv">20</span>, <span class="dv">220</span>, n<span class="op">=</span><span class="dv">200</span>), square<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"Variable"</span>, xlabel<span class="op">=</span><span class="st">"Shift [h]"</span>, title<span class="op">=</span><span class="st">"Temporal Autocorrelation"</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">"Variable"</span>, ylabel<span class="op">=</span><span class="st">"Variable"</span>, title<span class="op">=</span><span class="st">"Correlation"</span>)<span class="op">;</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.savefig(base_path_img <span class="op">/</span> <span class="st">"correlation.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gap-distribution" class="level3">
<h3 class="anchored" data-anchor-id="gap-distribution">Gap distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>out_dir <span class="op">=</span> here(<span class="st">"../fluxnet/gap_stat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>site_info <span class="op">=</span> pl.read_parquet(out_dir <span class="op">/</span> <span class="st">"../site_info.parquet"</span>).select([</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"start"</span>).cast(pl.Utf8).<span class="bu">str</span>.strptime(pl.Datetime, <span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">%H%M"</span>),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"end"</span>).cast(pl.Utf8).<span class="bu">str</span>.strptime(pl.Datetime, <span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">%H%M"</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"site"</span>).cast(pl.Categorical).sort()</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> duration_n_obs(duration):</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"converts a duration into a n of fluxnet observations"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(<span class="bu">int</span>(duration.total_seconds() <span class="op">/</span> (<span class="dv">30</span> <span class="op">*</span> <span class="dv">60</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> out_dir.ls()</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>files.sort() <span class="co"># need to sort to match the site_info</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>sites <span class="op">=</span> []</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, path <span class="kw">in</span> <span class="bu">enumerate</span>(files):</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    sites.append(pl.scan_parquet(path).with_columns([</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        pl.lit(site_info[i, <span class="st">"site"</span>]).alias(<span class="st">"site"</span>),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        pl.lit(duration_n_obs(site_info[i, <span class="st">"start"</span>] <span class="op">-</span>  site_info[i, <span class="st">"end"</span>])).alias(<span class="st">"total_obs"</span>),</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"TIMESTAMP_END"</span>).cast(pl.Utf8).<span class="bu">str</span>.strptime(pl.Datetime, <span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">%H%M"</span>).alias(<span class="st">"end"</span>),</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    ]).drop(<span class="st">"TIMESTAMP_END"</span>))</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="op">=</span> pl.concat(sites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_var_dist(var, small<span class="op">=</span><span class="va">False</span>, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>: ax <span class="op">=</span> get_grid(<span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    ta_gaps <span class="op">=</span> gap_stat.<span class="bu">filter</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"variable"</span>) <span class="op">==</span> var)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">filter</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"gap_len"</span>) <span class="op">&lt;</span> <span class="dv">200</span> <span class="cf">if</span> small <span class="cf">else</span> <span class="va">True</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    ).with_column(pl.col(<span class="st">"gap_len"</span>) <span class="op">/</span> (<span class="dv">24</span> <span class="op">*</span><span class="dv">2</span> <span class="op">*</span> <span class="dv">7</span>)).collect().to_pandas().hist(<span class="st">"gap_len"</span>, bins<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>ax)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span> <span class="st">'gaps &lt; 200'</span> <span class="cf">if</span> small <span class="cf">else</span> <span class="st">'all gaps'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> small: ax.set_yscale(<span class="st">'log'</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"gap length (weeks)"</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Log'</span> <span class="cf">if</span> <span class="kw">not</span> small <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss"> n gaps"</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.xscale('log') </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>plot_var_dist(<span class="st">'TA_F_QC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(scale_meteo.domain, <span class="bu">list</span>(sns.color_palette(<span class="st">'Set2'</span>, n_colors<span class="op">=</span><span class="bu">len</span>(hai.columns)).as_hex())))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>qc_map <span class="op">=</span> {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TA'</span>: <span class="st">'TA_F_QC'</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SW_IN'</span>: <span class="st">'SW_IN_F_QC'</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LW_IN'</span>: <span class="st">'LW_IN_F_QC'</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VPD'</span>: <span class="st">'VPD_F_QC'</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WS'</span>: <span class="st">'WS_F_QC'</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PA'</span>: <span class="st">'PA_F_QC'</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'P'</span>: <span class="st">'P_F_QC'</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TS'</span>: <span class="st">'TS_F_MDS_1_QC'</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SWC'</span>: <span class="st">'SWC_F_MDS_1_QC'</span>,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pl_in(col, values):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    expr <span class="op">=</span> <span class="va">False</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val <span class="kw">in</span> values:</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>        expr <span class="op">|=</span> pl.col(col) <span class="op">==</span> val</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> expr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>gap_stat.<span class="bu">filter</span>(pl_in(<span class="st">'variable'</span>, qc_map.values())</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>               ).with_columns([</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    pl.when(pl.col(<span class="st">"gap_len"</span>) <span class="op">&lt;</span> <span class="dv">48</span><span class="op">*</span><span class="dv">7</span>).then(<span class="va">True</span>).otherwise(<span class="va">False</span>).alias(<span class="st">"short"</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    pl.count().alias(<span class="st">"total"</span>),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    pl.count().alias(<span class="st">"total len"</span>),</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>]).groupby(<span class="st">"short"</span>).agg([</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    (pl.col(<span class="st">"gap_len"</span>).count() <span class="op">/</span> pl.col(<span class="st">"total"</span>)).alias(<span class="st">"frac_num"</span>),</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    (pl.col(<span class="st">"gap_len"</span>).<span class="bu">sum</span>() <span class="op">/</span> pl.col(<span class="st">"total len"</span>)).alias(<span class="st">"frac_len"</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>]).collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_var_dist_small(var, ax<span class="op">=</span><span class="va">None</span>, small<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>: ax <span class="op">=</span> get_grid(<span class="dv">1</span>)[<span class="dv">0</span>]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> color_map[var]</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    var_qc <span class="op">=</span> qc_map[var]</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    ta_gaps <span class="op">=</span> gap_stat.<span class="bu">filter</span>(</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">"variable"</span>) <span class="op">==</span> var_qc)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">filter</span>(</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"gap_len"</span>) <span class="op">&lt;</span> (<span class="dv">24</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">*</span><span class="dv">7</span>) <span class="cf">if</span> small <span class="cf">else</span> <span class="va">True</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    ).with_column(pl.col(<span class="st">"gap_len"</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="cf">if</span> small <span class="cf">else</span> <span class="dv">48</span> <span class="op">*</span> <span class="dv">7</span>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>                 ).collect().to_pandas().hist(<span class="st">"gap_len"</span>, bins<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>ax, edgecolor<span class="op">=</span><span class="st">"white"</span>, color<span class="op">=</span>color)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span> <span class="st">'gap length &lt;  1 week'</span> <span class="cf">if</span> small <span class="cf">else</span> <span class="st">'all gaps'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="ss">f"gap length (</span><span class="sc">{</span> <span class="st">'hour'</span> <span class="cf">if</span> small <span class="cf">else</span> <span class="st">'week'</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="ss">f"Log n gaps"</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    ax.set_yscale(<span class="st">'log'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span> <span class="op">=</span> gap_stat.select(pl.col(<span class="st">"variable"</span>).unique()).collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span>.<span class="bu">filter</span>(pl.col(<span class="st">"variable"</span>).<span class="bu">str</span>.contains(<span class="st">"TA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, var <span class="kw">in</span> <span class="bu">zip</span>(get_grid(<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>), sharey<span class="op">=</span><span class="va">False</span>), <span class="bu">list</span>(var_type.categories)):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    plot_var_dist_small(var, ax<span class="op">=</span>ax)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>plt.savefig(base_path_img <span class="op">/</span> <span class="st">"gap_len_dist_small.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, var <span class="kw">in</span> <span class="bu">zip</span>(get_grid(<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>), sharey<span class="op">=</span><span class="va">False</span>), <span class="bu">list</span>(var_type.categories)):</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    plot_var_dist_small(var, ax<span class="op">=</span>ax, small<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>plt.savefig(base_path_img <span class="op">/</span> <span class="st">"gap_len_dist.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>methods colors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sns.color_palette(<span class="st">'Dark2'</span>).as_hex())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>