<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.78">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="need to implement custom data preparation pipeline and loss function">

<title>meteo_imp - Implement Kalman model using FastAI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="meteo_imp - Implement Kalman model using FastAI">
<meta property="og:description" content="need to implement custom data preparation pipeline and loss function">
<meta property="og:site-name" content="meteo_imp">
<meta name="twitter:title" content="meteo_imp - Implement Kalman model using FastAI">
<meta name="twitter:description" content="need to implement custom data preparation pipeline and loss function">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">meteo_imp</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Implement Kalman model using FastAI</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">GPFA Imputation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data_preparation.html" class="sidebar-item-text sidebar-link">Data Preparation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../results.html" class="sidebar-item-text sidebar-link">Results</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../simplegp_imputation.html" class="sidebar-item-text sidebar-link">Simple GP Imputation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gaussian.html" class="sidebar-item-text sidebar-link">Gaussian Distributions Utils</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../utils.html" class="sidebar-item-text sidebar-link">Utils</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Fluxnet</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fluxnet/gap_finder.html" class="sidebar-item-text sidebar-link">Find Gaps in Fluxnet data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Fluxnet/hainich.html" class="sidebar-item-text sidebar-link">Fluxnet Hainich</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">GPFA</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/gpfa.html" class="sidebar-item-text sidebar-link">Gaussian Processes Factor Analysis</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/learner.html" class="sidebar-item-text sidebar-link">GPFA Learner</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../GPFA/imputation.html" class="sidebar-item-text sidebar-link">Imputation time series</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">kalman</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/filter.html" class="sidebar-item-text sidebar-link">Kalman Filter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/test_filter_pykalman.html" class="sidebar-item-text sidebar-link">Compare PyKalman</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/fastai.html" class="sidebar-item-text sidebar-link active">Implement Kalman model using FastAI</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/learner.html" class="sidebar-item-text sidebar-link">Kalman Filter Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/imputation.html" class="sidebar-item-text sidebar-link">Imputation Kalman Model</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old statsmodels - statespace.html" class="sidebar-item-text sidebar-link">[Not Working] StatsModels Kalman filter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old_01_pykalman_models.html" class="sidebar-item-text sidebar-link">[OLD] PyKalman Filter Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../kalman/old_02_pykalman_imputation.html" class="sidebar-item-text sidebar-link">[OLD] Imputation PyKalman Model</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link active" data-scroll-target="#data-preparation">Data Preparation</a>
  <ul class="collapse">
  <li><a href="#blocks" id="toc-blocks" class="nav-link" data-scroll-target="#blocks">1) Blocks</a></li>
  <li><a href="#blockdftransform" id="toc-blockdftransform" class="nav-link" data-scroll-target="#blockdftransform">BlockDfTransform</a></li>
  <li><a href="#gaps" id="toc-gaps" class="nav-link" data-scroll-target="#gaps">2) Gaps</a></li>
  <li><a href="#maskeddf" id="toc-maskeddf" class="nav-link" data-scroll-target="#maskeddf">MaskedDf</a></li>
  <li><a href="#addgaptransform" id="toc-addgaptransform" class="nav-link" data-scroll-target="#addgaptransform">AddGapTransform</a></li>
  <li><a href="#maskeddf.tidy" id="toc-maskeddf.tidy" class="nav-link" data-scroll-target="#maskeddf.tidy">MaskedDf.tidy</a></li>
  <li><a href="#plot_points" id="toc-plot_points" class="nav-link" data-scroll-target="#plot_points">plot_points</a></li>
  <li><a href="#facet_variable" id="toc-facet_variable" class="nav-link" data-scroll-target="#facet_variable">facet_variable</a></li>
  <li><a href="#maskeddf.show" id="toc-maskeddf.show" class="nav-link" data-scroll-target="#maskeddf.show">MaskedDf.show</a></li>
  <li><a href="#to-tensor" id="toc-to-tensor" class="nav-link" data-scroll-target="#to-tensor">3) To Tensor</a></li>
  <li><a href="#maskedtensor" id="toc-maskedtensor" class="nav-link" data-scroll-target="#maskedtensor">MaskedTensor</a></li>
  <li><a href="#maskeddf2tensor" id="toc-maskeddf2tensor" class="nav-link" data-scroll-target="#maskeddf2tensor">MaskedDf2Tensor</a></li>
  <li><a href="#normalize" id="toc-normalize" class="nav-link" data-scroll-target="#normalize">4) Normalize</a></li>
  <li><a href="#normalsparams" id="toc-normalsparams" class="nav-link" data-scroll-target="#normalsparams">NormalsParams</a></li>
  <li><a href="#get_stats" id="toc-get_stats" class="nav-link" data-scroll-target="#get_stats">get_stats</a></li>
  <li><a href="#normalizemasked" id="toc-normalizemasked" class="nav-link" data-scroll-target="#normalizemasked">NormalizeMasked</a></li>
  <li><a href="#to-tuple" id="toc-to-tuple" class="nav-link" data-scroll-target="#to-tuple">5) To Tuple</a></li>
  <li><a href="#to_tuple" id="toc-to_tuple" class="nav-link" data-scroll-target="#to_tuple">to_tuple</a></li>
  <li><a href="#pipeline" id="toc-pipeline" class="nav-link" data-scroll-target="#pipeline">Pipeline</a></li>
  <li><a href="#imp_pipeline" id="toc-imp_pipeline" class="nav-link" data-scroll-target="#imp_pipeline">imp_pipeline</a></li>
  <li><a href="#dataloader" id="toc-dataloader" class="nav-link" data-scroll-target="#dataloader">Dataloader</a></li>
  <li><a href="#make_dataloader" id="toc-make_dataloader" class="nav-link" data-scroll-target="#make_dataloader">make_dataloader</a></li>
  </ul></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a>
  <ul class="collapse">
  <li><a href="#forward-function" id="toc-forward-function" class="nav-link" data-scroll-target="#forward-function">Forward Function</a></li>
  <li><a href="#kalmanfilter.forward" id="toc-kalmanfilter.forward" class="nav-link" data-scroll-target="#kalmanfilter.forward">KalmanFilter.forward</a></li>
  <li><a href="#loss-function" id="toc-loss-function" class="nav-link" data-scroll-target="#loss-function">Loss Function</a></li>
  <li><a href="#kalmanloss" id="toc-kalmanloss" class="nav-link" data-scroll-target="#kalmanloss">KalmanLoss</a></li>
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">Metrics</a></li>
  <li><a href="#to_msk_metric" id="toc-to_msk_metric" class="nav-link" data-scroll-target="#to_msk_metric">to_msk_metric</a></li>
  <li><a href="#callback" id="toc-callback" class="nav-link" data-scroll-target="#callback">Callback</a></li>
  <li><a href="#saveparams" id="toc-saveparams" class="nav-link" data-scroll-target="#saveparams">SaveParams</a></li>
  <li><a href="#saveparams-1" id="toc-saveparams-1" class="nav-link" data-scroll-target="#saveparams-1">SaveParams</a></li>
  <li><a href="#learner" id="toc-learner" class="nav-link" data-scroll-target="#learner">Learner</a></li>
  <li><a href="#float64callback" id="toc-float64callback" class="nav-link" data-scroll-target="#float64callback">Float64Callback</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#normalsdf" id="toc-normalsdf" class="nav-link" data-scroll-target="#normalsdf">NormalsDf</a></li>
  <li><a href="#preds2df" id="toc-preds2df" class="nav-link" data-scroll-target="#preds2df">preds2df</a></li>
  <li><a href="#predict_items" id="toc-predict_items" class="nav-link" data-scroll-target="#predict_items">predict_items</a></li>
  <li><a href="#plot_result" id="toc-plot_result" class="nav-link" data-scroll-target="#plot_result">plot_result</a></li>
  <li><a href="#plot_results" id="toc-plot_results" class="nav-link" data-scroll-target="#plot_results">plot_results</a></li>
  <li><a href="#get_results" id="toc-get_results" class="nav-link" data-scroll-target="#get_results">get_results</a></li>
  <li><a href="#show_results" id="toc-show_results" class="nav-link" data-scroll-target="#show_results">show_results</a></li>
  </ul></li>
  <li><a href="#export" id="toc-export" class="nav-link" data-scroll-target="#export">Export</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mone27/meteo_imp/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Implement Kalman model using FastAI</h1>
</div>

<div>
  <div class="description">
    need to implement custom data preparation pipeline and loss function
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>The aim of the data preparation pipeline is to: - take the original time series and split it into time blocks - for each block generate a random gap (need to figure out the properties of the gap) - split some time blocks for testing</p>
<p>the input of the pipeline is: - a dataframe containing all observations</p>
<p>the input of the model is: - observed data (potentially containing NaN where data is missing) - missing data mask (which is telling where the data is missing) - the data needs to be standardized</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>reset_seed()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.tabular.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastai.data.core <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">@cache_disk</span>(cache_dir <span class="op">/</span> <span class="st">"full_hai"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(dtype<span class="op">=</span>np.float32):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> read_fluxnet_csv(hai_path, <span class="va">None</span>, num_dtype<span class="op">=</span>dtype)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>hai <span class="op">=</span> load_data()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>hai64 <span class="op">=</span> load_data(np.float64)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="blocks" class="level3">
<h3 class="anchored" data-anchor-id="blocks">1) Blocks</h3>
<p>the first step is to transfrom the original dataframe into blocks of a specified <code>block_len</code></p>
<p>two different strategies are possible:</p>
<ul>
<li>contigous blocks</li>
<li>random block in the dataframe</li>
</ul>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L30" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="blockdftransform" class="level3">
<h3 class="anchored" data-anchor-id="blockdftransform">BlockDfTransform</h3>
<blockquote class="blockquote">
<pre><code> BlockDfTransform (df, block_len=200)</code></pre>
</blockquote>
<p>divide timeseries DataFrame into blocks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>blk <span class="op">=</span> BlockDfTransform(hai, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>blk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>BlockDfTransform:
encodes: (int,object) -&gt; encodes
decodes: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>blk(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TA</th>
      <th>SW_IN</th>
      <th>VPD</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01 05:30:00</th>
      <td>-0.23</td>
      <td>0.00</td>
      <td>0.138</td>
    </tr>
    <tr>
      <th>2000-01-01 06:00:00</th>
      <td>-0.23</td>
      <td>0.00</td>
      <td>0.122</td>
    </tr>
    <tr>
      <th>2000-01-01 06:30:00</th>
      <td>-0.22</td>
      <td>0.00</td>
      <td>0.098</td>
    </tr>
    <tr>
      <th>2000-01-01 07:00:00</th>
      <td>-0.24</td>
      <td>0.00</td>
      <td>0.066</td>
    </tr>
    <tr>
      <th>2000-01-01 07:30:00</th>
      <td>-0.23</td>
      <td>0.00</td>
      <td>0.044</td>
    </tr>
    <tr>
      <th>2000-01-01 08:00:00</th>
      <td>-0.22</td>
      <td>0.00</td>
      <td>0.026</td>
    </tr>
    <tr>
      <th>2000-01-01 08:30:00</th>
      <td>-0.19</td>
      <td>0.45</td>
      <td>0.016</td>
    </tr>
    <tr>
      <th>2000-01-01 09:00:00</th>
      <td>-0.14</td>
      <td>3.70</td>
      <td>0.010</td>
    </tr>
    <tr>
      <th>2000-01-01 09:30:00</th>
      <td>-0.03</td>
      <td>7.26</td>
      <td>0.006</td>
    </tr>
    <tr>
      <th>2000-01-01 10:00:00</th>
      <td>0.04</td>
      <td>12.24</td>
      <td>0.006</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">180</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>864.0</code></pre>
</div>
</div>
<p>we are taking a day in the summer so there is an higher values for the variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>blk(<span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TA</th>
      <th>SW_IN</th>
      <th>VPD</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-06-15 16:30:00</th>
      <td>14.65</td>
      <td>468.190002</td>
      <td>6.454</td>
    </tr>
    <tr>
      <th>2000-06-15 17:00:00</th>
      <td>14.22</td>
      <td>224.800003</td>
      <td>5.799</td>
    </tr>
    <tr>
      <th>2000-06-15 17:30:00</th>
      <td>14.11</td>
      <td>195.279999</td>
      <td>6.577</td>
    </tr>
    <tr>
      <th>2000-06-15 18:00:00</th>
      <td>14.23</td>
      <td>244.169998</td>
      <td>6.931</td>
    </tr>
    <tr>
      <th>2000-06-15 18:30:00</th>
      <td>14.40</td>
      <td>253.919998</td>
      <td>7.286</td>
    </tr>
    <tr>
      <th>2000-06-15 19:00:00</th>
      <td>14.09</td>
      <td>177.309998</td>
      <td>7.251</td>
    </tr>
    <tr>
      <th>2000-06-15 19:30:00</th>
      <td>13.71</td>
      <td>97.070000</td>
      <td>6.683</td>
    </tr>
    <tr>
      <th>2000-06-15 20:00:00</th>
      <td>13.08</td>
      <td>39.709999</td>
      <td>5.851</td>
    </tr>
    <tr>
      <th>2000-06-15 20:30:00</th>
      <td>12.41</td>
      <td>10.650000</td>
      <td>5.254</td>
    </tr>
    <tr>
      <th>2000-06-15 21:00:00</th>
      <td>12.27</td>
      <td>0.320000</td>
      <td>5.164</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tfms1 <span class="op">=</span> TfmdLists([<span class="dv">800</span>,<span class="dv">801</span>,<span class="dv">802</span>,<span class="dv">803</span>], [BlockDfTransform(hai, <span class="dv">10</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tfms1[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TA</th>
      <th>SW_IN</th>
      <th>VPD</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-06-15 16:30:00</th>
      <td>14.65</td>
      <td>468.190002</td>
      <td>6.454</td>
    </tr>
    <tr>
      <th>2000-06-15 17:00:00</th>
      <td>14.22</td>
      <td>224.800003</td>
      <td>5.799</td>
    </tr>
    <tr>
      <th>2000-06-15 17:30:00</th>
      <td>14.11</td>
      <td>195.279999</td>
      <td>6.577</td>
    </tr>
    <tr>
      <th>2000-06-15 18:00:00</th>
      <td>14.23</td>
      <td>244.169998</td>
      <td>6.931</td>
    </tr>
    <tr>
      <th>2000-06-15 18:30:00</th>
      <td>14.40</td>
      <td>253.919998</td>
      <td>7.286</td>
    </tr>
    <tr>
      <th>2000-06-15 19:00:00</th>
      <td>14.09</td>
      <td>177.309998</td>
      <td>7.251</td>
    </tr>
    <tr>
      <th>2000-06-15 19:30:00</th>
      <td>13.71</td>
      <td>97.070000</td>
      <td>6.683</td>
    </tr>
    <tr>
      <th>2000-06-15 20:00:00</th>
      <td>13.08</td>
      <td>39.709999</td>
      <td>5.851</td>
    </tr>
    <tr>
      <th>2000-06-15 20:30:00</th>
      <td>12.41</td>
      <td>10.650000</td>
      <td>5.254</td>
    </tr>
    <tr>
      <th>2000-06-15 21:00:00</th>
      <td>12.27</td>
      <td>0.320000</td>
      <td>5.164</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="gaps" class="level3">
<h3 class="anchored" data-anchor-id="gaps">2) Gaps</h3>
<p>adds a mask which includes a random gap</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L47" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="maskeddf" class="level3">
<h3 class="anchored" data-anchor-id="maskeddf">MaskedDf</h3>
<blockquote class="blockquote">
<pre><code> MaskedDf (*args)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _make_random_gap(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    gap_length: <span class="bu">int</span>, <span class="co"># The length of the gap</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    total_length: <span class="bu">int</span>, <span class="co"># The total number of observations</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    gap_start: <span class="bu">int</span> <span class="op">=</span> <span class="va">None</span> <span class="co"># Optional start of gap</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>): <span class="co"># (total_length) array of bools to indicicate if the data is missing or not</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Add a continous gap of ginve length at random position"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(gap_length <span class="op">&gt;=</span> total_length):</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.repeat(<span class="va">True</span>, total_length)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    gap_start <span class="op">=</span> np.random.randint(total_length <span class="op">-</span> gap_length) <span class="cf">if</span> gap_start <span class="kw">is</span> <span class="va">None</span> <span class="cf">else</span> gap_start</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.hstack([</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">False</span>, gap_start),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">True</span>, gap_length),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        np.repeat(<span class="va">False</span>, total_length <span class="op">-</span> (gap_length <span class="op">+</span> gap_start))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L76" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="addgaptransform" class="level3">
<h3 class="anchored" data-anchor-id="addgaptransform">AddGapTransform</h3>
<blockquote class="blockquote">
<pre><code> AddGapTransform (variables, gap_length)</code></pre>
</blockquote>
<p>Adds a random gap to a dataframe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>a_gap <span class="op">=</span> AddGapTransform([<span class="st">'TA'</span>, <span class="st">'VPD'</span>], <span class="dv">5</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>a_gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>AddGapTransform:
encodes: (DataFrame,object) -&gt; encodes
decodes: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>a_gap(blk(<span class="dv">800</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold">Masked Df</p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_33f9d">
  <thead>
    <tr>
      <th id="T_33f9d_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_33f9d_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_33f9d_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_33f9d_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_33f9d_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_33f9d_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_33f9d_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_33f9d_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_33f9d_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_33f9d_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_33f9d_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_33f9d_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_33f9d_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_33f9d_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_33f9d_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_33f9d_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_33f9d_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_33f9d_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_33f9d_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_33f9d_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_33f9d_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_33f9d_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_33f9d_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_33f9d_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_33f9d_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_33f9d_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_33f9d_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_33f9d_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_33f9d_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_33f9d_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_33f9d_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_33f9d_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_33f9d_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_3f494">
  <thead>
    <tr>
      <th id="T_3f494_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_3f494_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_3f494_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_3f494_row0_col0" class="data row0 col0">True</td>
      <td id="T_3f494_row0_col1" class="data row0 col1">True</td>
      <td id="T_3f494_row0_col2" class="data row0 col2">True</td>
    </tr>
    <tr>
      <td id="T_3f494_row1_col0" class="data row1 col0">True</td>
      <td id="T_3f494_row1_col1" class="data row1 col1">True</td>
      <td id="T_3f494_row1_col2" class="data row1 col2">True</td>
    </tr>
    <tr>
      <td id="T_3f494_row2_col0" class="data row2 col0">True</td>
      <td id="T_3f494_row2_col1" class="data row2 col1">True</td>
      <td id="T_3f494_row2_col2" class="data row2 col2">True</td>
    </tr>
    <tr>
      <td id="T_3f494_row3_col0" class="data row3 col0">False</td>
      <td id="T_3f494_row3_col1" class="data row3 col1">True</td>
      <td id="T_3f494_row3_col2" class="data row3 col2">False</td>
    </tr>
    <tr>
      <td id="T_3f494_row4_col0" class="data row4 col0">False</td>
      <td id="T_3f494_row4_col1" class="data row4 col1">True</td>
      <td id="T_3f494_row4_col2" class="data row4 col2">False</td>
    </tr>
    <tr>
      <td id="T_3f494_row5_col0" class="data row5 col0">False</td>
      <td id="T_3f494_row5_col1" class="data row5 col1">True</td>
      <td id="T_3f494_row5_col2" class="data row5 col2">False</td>
    </tr>
    <tr>
      <td id="T_3f494_row6_col0" class="data row6 col0">False</td>
      <td id="T_3f494_row6_col1" class="data row6 col1">True</td>
      <td id="T_3f494_row6_col2" class="data row6 col2">False</td>
    </tr>
    <tr>
      <td id="T_3f494_row7_col0" class="data row7 col0">False</td>
      <td id="T_3f494_row7_col1" class="data row7 col1">True</td>
      <td id="T_3f494_row7_col2" class="data row7 col2">False</td>
    </tr>
    <tr>
      <td id="T_3f494_row8_col0" class="data row8 col0">True</td>
      <td id="T_3f494_row8_col1" class="data row8 col1">True</td>
      <td id="T_3f494_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_3f494_row9_col0" class="data row9 col0">True</td>
      <td id="T_3f494_row9_col1" class="data row9 col1">True</td>
      <td id="T_3f494_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>m_df <span class="op">=</span> a_gap(blk(<span class="dv">800</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>display_as_row({<span class="st">'data'</span>: m_df.data, <span class="st">'mask'</span>: m_df.mask})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold"></p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_164b2">
  <thead>
    <tr>
      <th id="T_164b2_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_164b2_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_164b2_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_164b2_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_164b2_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_164b2_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_164b2_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_164b2_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_164b2_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_164b2_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_164b2_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_164b2_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_164b2_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_164b2_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_164b2_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_164b2_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_164b2_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_164b2_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_164b2_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_164b2_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_164b2_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_164b2_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_164b2_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_164b2_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_164b2_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_164b2_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_164b2_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_164b2_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_164b2_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_164b2_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_164b2_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_164b2_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_164b2_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_e0268">
  <thead>
    <tr>
      <th id="T_e0268_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_e0268_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_e0268_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_e0268_row0_col0" class="data row0 col0">False</td>
      <td id="T_e0268_row0_col1" class="data row0 col1">True</td>
      <td id="T_e0268_row0_col2" class="data row0 col2">False</td>
    </tr>
    <tr>
      <td id="T_e0268_row1_col0" class="data row1 col0">False</td>
      <td id="T_e0268_row1_col1" class="data row1 col1">True</td>
      <td id="T_e0268_row1_col2" class="data row1 col2">False</td>
    </tr>
    <tr>
      <td id="T_e0268_row2_col0" class="data row2 col0">False</td>
      <td id="T_e0268_row2_col1" class="data row2 col1">True</td>
      <td id="T_e0268_row2_col2" class="data row2 col2">False</td>
    </tr>
    <tr>
      <td id="T_e0268_row3_col0" class="data row3 col0">False</td>
      <td id="T_e0268_row3_col1" class="data row3 col1">True</td>
      <td id="T_e0268_row3_col2" class="data row3 col2">False</td>
    </tr>
    <tr>
      <td id="T_e0268_row4_col0" class="data row4 col0">False</td>
      <td id="T_e0268_row4_col1" class="data row4 col1">True</td>
      <td id="T_e0268_row4_col2" class="data row4 col2">False</td>
    </tr>
    <tr>
      <td id="T_e0268_row5_col0" class="data row5 col0">True</td>
      <td id="T_e0268_row5_col1" class="data row5 col1">True</td>
      <td id="T_e0268_row5_col2" class="data row5 col2">True</td>
    </tr>
    <tr>
      <td id="T_e0268_row6_col0" class="data row6 col0">True</td>
      <td id="T_e0268_row6_col1" class="data row6 col1">True</td>
      <td id="T_e0268_row6_col2" class="data row6 col2">True</td>
    </tr>
    <tr>
      <td id="T_e0268_row7_col0" class="data row7 col0">True</td>
      <td id="T_e0268_row7_col1" class="data row7 col1">True</td>
      <td id="T_e0268_row7_col2" class="data row7 col2">True</td>
    </tr>
    <tr>
      <td id="T_e0268_row8_col0" class="data row8 col0">True</td>
      <td id="T_e0268_row8_col1" class="data row8 col1">True</td>
      <td id="T_e0268_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_e0268_row9_col0" class="data row9 col0">True</td>
      <td id="T_e0268_row9_col1" class="data row9 col1">True</td>
      <td id="T_e0268_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tfms2 <span class="op">=</span> TfmdLists([<span class="dv">800</span>,<span class="dv">801</span>,<span class="dv">802</span>,<span class="dv">803</span>], [BlockDfTransform(hai, <span class="dv">10</span>), AddGapTransform([<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>], <span class="dv">2</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold">Masked Df</p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_c3439">
  <thead>
    <tr>
      <th id="T_c3439_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_c3439_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_c3439_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_c3439_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_c3439_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_c3439_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_c3439_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_c3439_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_c3439_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_c3439_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_c3439_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_c3439_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_c3439_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_c3439_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_c3439_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_c3439_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_c3439_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_c3439_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_c3439_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_c3439_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_c3439_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_c3439_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_c3439_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_c3439_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_c3439_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_c3439_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_c3439_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_c3439_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_c3439_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_c3439_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_c3439_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_c3439_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_c3439_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_232d6">
  <thead>
    <tr>
      <th id="T_232d6_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_232d6_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_232d6_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_232d6_row0_col0" class="data row0 col0">True</td>
      <td id="T_232d6_row0_col1" class="data row0 col1">True</td>
      <td id="T_232d6_row0_col2" class="data row0 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row1_col0" class="data row1 col0">True</td>
      <td id="T_232d6_row1_col1" class="data row1 col1">True</td>
      <td id="T_232d6_row1_col2" class="data row1 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row2_col0" class="data row2 col0">True</td>
      <td id="T_232d6_row2_col1" class="data row2 col1">True</td>
      <td id="T_232d6_row2_col2" class="data row2 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row3_col0" class="data row3 col0">True</td>
      <td id="T_232d6_row3_col1" class="data row3 col1">True</td>
      <td id="T_232d6_row3_col2" class="data row3 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row4_col0" class="data row4 col0">True</td>
      <td id="T_232d6_row4_col1" class="data row4 col1">True</td>
      <td id="T_232d6_row4_col2" class="data row4 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row5_col0" class="data row5 col0">True</td>
      <td id="T_232d6_row5_col1" class="data row5 col1">True</td>
      <td id="T_232d6_row5_col2" class="data row5 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row6_col0" class="data row6 col0">True</td>
      <td id="T_232d6_row6_col1" class="data row6 col1">True</td>
      <td id="T_232d6_row6_col2" class="data row6 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row7_col0" class="data row7 col0">False</td>
      <td id="T_232d6_row7_col1" class="data row7 col1">False</td>
      <td id="T_232d6_row7_col2" class="data row7 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row8_col0" class="data row8 col0">False</td>
      <td id="T_232d6_row8_col1" class="data row8 col1">False</td>
      <td id="T_232d6_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_232d6_row9_col0" class="data row9 col0">True</td>
      <td id="T_232d6_row9_col1" class="data row9 col1">True</td>
      <td id="T_232d6_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L92" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="maskeddf.tidy" class="level3">
<h3 class="anchored" data-anchor-id="maskeddf.tidy">MaskedDf.tidy</h3>
<blockquote class="blockquote">
<pre><code> MaskedDf.tidy ()</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>m_df.tidy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>time</th>
      <th>variable</th>
      <th>value</th>
      <th>is_present</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-06-15 16:30:00</td>
      <td>TA</td>
      <td>14.650000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-06-15 17:00:00</td>
      <td>TA</td>
      <td>14.220000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-06-15 17:30:00</td>
      <td>TA</td>
      <td>14.110000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-06-15 18:00:00</td>
      <td>TA</td>
      <td>14.230000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-06-15 18:30:00</td>
      <td>TA</td>
      <td>14.400000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2000-06-15 19:00:00</td>
      <td>TA</td>
      <td>14.090000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2000-06-15 19:30:00</td>
      <td>TA</td>
      <td>13.710000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2000-06-15 20:00:00</td>
      <td>TA</td>
      <td>13.080000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2000-06-15 20:30:00</td>
      <td>TA</td>
      <td>12.410000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2000-06-15 21:00:00</td>
      <td>TA</td>
      <td>12.270000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2000-06-15 16:30:00</td>
      <td>SW_IN</td>
      <td>468.190002</td>
      <td>True</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2000-06-15 17:00:00</td>
      <td>SW_IN</td>
      <td>224.800003</td>
      <td>True</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000-06-15 17:30:00</td>
      <td>SW_IN</td>
      <td>195.279999</td>
      <td>True</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2000-06-15 18:00:00</td>
      <td>SW_IN</td>
      <td>244.169998</td>
      <td>True</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2000-06-15 18:30:00</td>
      <td>SW_IN</td>
      <td>253.919998</td>
      <td>True</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2000-06-15 19:00:00</td>
      <td>SW_IN</td>
      <td>177.309998</td>
      <td>True</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2000-06-15 19:30:00</td>
      <td>SW_IN</td>
      <td>97.070000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2000-06-15 20:00:00</td>
      <td>SW_IN</td>
      <td>39.709999</td>
      <td>True</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2000-06-15 20:30:00</td>
      <td>SW_IN</td>
      <td>10.650000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2000-06-15 21:00:00</td>
      <td>SW_IN</td>
      <td>0.320000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2000-06-15 16:30:00</td>
      <td>VPD</td>
      <td>6.454000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2000-06-15 17:00:00</td>
      <td>VPD</td>
      <td>5.799000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2000-06-15 17:30:00</td>
      <td>VPD</td>
      <td>6.577000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2000-06-15 18:00:00</td>
      <td>VPD</td>
      <td>6.931000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2000-06-15 18:30:00</td>
      <td>VPD</td>
      <td>7.286000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2000-06-15 19:00:00</td>
      <td>VPD</td>
      <td>7.251000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2000-06-15 19:30:00</td>
      <td>VPD</td>
      <td>6.683000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2000-06-15 20:00:00</td>
      <td>VPD</td>
      <td>5.851000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2000-06-15 20:30:00</td>
      <td>VPD</td>
      <td>5.254000</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2000-06-15 21:00:00</td>
      <td>VPD</td>
      <td>5.164000</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="plotting" class="level4">
<h4 class="anchored" data-anchor-id="plotting">Plotting</h4>
<section id="rug" class="level5">
<h5 class="anchored" data-anchor-id="rug">Rug</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot_rug(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-9f7d3216da0f4c4680aebfa8657abd20"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9f7d3216da0f4c4680aebfa8657abd20") {
      outputDiv = document.getElementById("altair-viz-9f7d3216da0f4c4680aebfa8657abd20");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-78793625ad331c69629763c17f6779c5"}, "mark": {"type": "tick", "color": "black"}, "encoding": {"color": {"condition": {"value": "white", "test": "datum.is_present"}, "value": "black"}, "x": {"field": "time", "type": "temporal"}}, "params": [{"name": "param_1", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-78793625ad331c69629763c17f6779c5": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "SW_IN", "value": 468.19000244140625, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "VPD", "value": 6.453999996185303, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> m_df.tidy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.variable<span class="op">==</span><span class="st">"TA"</span>].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'row_number'</span>] <span class="op">=</span> df.reset_index().index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>time</th>
      <th>variable</th>
      <th>value</th>
      <th>is_present</th>
      <th>row_number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-06-15 16:30:00</td>
      <td>TA</td>
      <td>14.65</td>
      <td>False</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-06-15 17:00:00</td>
      <td>TA</td>
      <td>14.22</td>
      <td>False</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-06-15 17:30:00</td>
      <td>TA</td>
      <td>14.11</td>
      <td>False</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-06-15 18:00:00</td>
      <td>TA</td>
      <td>14.23</td>
      <td>False</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-06-15 18:30:00</td>
      <td>TA</td>
      <td>14.40</td>
      <td>False</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2000-06-15 19:00:00</td>
      <td>TA</td>
      <td>14.09</td>
      <td>True</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2000-06-15 19:30:00</td>
      <td>TA</td>
      <td>13.71</td>
      <td>True</td>
      <td>6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2000-06-15 20:00:00</td>
      <td>TA</td>
      <td>13.08</td>
      <td>True</td>
      <td>7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2000-06-15 20:30:00</td>
      <td>TA</td>
      <td>12.41</td>
      <td>True</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2000-06-15 21:00:00</td>
      <td>TA</td>
      <td>12.27</td>
      <td>True</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df[<span class="op">~</span>df.is_present]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>time</th>
      <th>variable</th>
      <th>value</th>
      <th>is_present</th>
      <th>row_number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2000-06-15 16:30:00</td>
      <td>TA</td>
      <td>14.65</td>
      <td>False</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2000-06-15 17:00:00</td>
      <td>TA</td>
      <td>14.22</td>
      <td>False</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2000-06-15 17:30:00</td>
      <td>TA</td>
      <td>14.11</td>
      <td>False</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2000-06-15 18:00:00</td>
      <td>TA</td>
      <td>14.23</td>
      <td>False</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000-06-15 18:30:00</td>
      <td>TA</td>
      <td>14.40</td>
      <td>False</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>idea is to replace the rug with a shaded area</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_missing_area(df, sel <span class="op">=</span> def_selection(), props<span class="op">=</span>{}):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="points" class="level5">
<h5 class="anchored" data-anchor-id="points">Points</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L121" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
</section>
<section id="plot_points" class="level3">
<h3 class="anchored" data-anchor-id="plot_points">plot_points</h3>
<blockquote class="blockquote">
<pre><code> plot_points (df, y='value', y_label='', sel=Selection('selector002',
              SelectionDef({   bind: 'scales',   type: 'interval' })),
              props={})</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plot_points(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-68011eef76054789aed0ff5f206f557f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-68011eef76054789aed0ff5f206f557f") {
      outputDiv = document.getElementById("altair-viz-68011eef76054789aed0ff5f206f557f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-78793625ad331c69629763c17f6779c5"}, "mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-78793625ad331c69629763c17f6779c5": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "SW_IN", "value": 468.19000244140625, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "VPD", "value": 6.453999996185303, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="line" class="level5">
<h5 class="anchored" data-anchor-id="line">Line</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>plot_line(m_df.tidy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-9fb6f96dc3d44eaca1c44eb4781b8931"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-9fb6f96dc3d44eaca1c44eb4781b8931") {
      outputDiv = document.getElementById("altair-viz-9fb6f96dc3d44eaca1c44eb4781b8931");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-78793625ad331c69629763c17f6779c5"}, "mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "params": [{"name": "param_56", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-78793625ad331c69629763c17f6779c5": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "SW_IN", "value": 468.19000244140625, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}, {"time": "2000-06-15T16:30:00", "variable": "VPD", "value": 6.453999996185303, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="errorband" class="level5">
<h5 class="anchored" data-anchor-id="errorband">Errorband</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plot_error(m_df.tidy().assign(std<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-d21d0b3c742f4433b9e5008dd0152624"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d21d0b3c742f4433b9e5008dd0152624") {
      outputDiv = document.getElementById("altair-viz-d21d0b3c742f4433b9e5008dd0152624");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-3e9fa0af9a02d4afccf35c1ba0bd0673"}, "mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "params": [{"name": "param_57", "select": {"type": "interval"}, "bind": "scales"}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-3e9fa0af9a02d4afccf35c1ba0bd0673": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false, "std": 5, "err_low": 4.649999618530273, "err_high": 24.649999618530273}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false, "std": 5, "err_low": 4.220000267028809, "err_high": 24.22000026702881}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false, "std": 5, "err_low": 4.109999656677246, "err_high": 24.109999656677246}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false, "std": 5, "err_low": 4.229999542236328, "err_high": 24.229999542236328}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false, "std": 5, "err_low": 4.399999618530273, "err_high": 24.399999618530273}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true, "std": 5, "err_low": 4.090000152587891, "err_high": 24.09000015258789}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true, "std": 5, "err_low": 3.7100000381469727, "err_high": 23.710000038146973}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true, "std": 5, "err_low": 3.0799999237060547, "err_high": 23.079999923706055}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true, "std": 5, "err_low": 2.4099998474121094, "err_high": 22.40999984741211}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true, "std": 5, "err_low": 2.270000457763672, "err_high": 22.270000457763672}, {"time": "2000-06-15T16:30:00", "variable": "SW_IN", "value": 468.19000244140625, "is_present": true, "std": 5, "err_low": 458.19000244140625, "err_high": 478.19000244140625}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true, "std": 5, "err_low": 214.8000030517578, "err_high": 234.8000030517578}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true, "std": 5, "err_low": 185.27999877929688, "err_high": 205.27999877929688}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": true, "std": 5, "err_low": 234.1699981689453, "err_high": 254.1699981689453}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": true, "std": 5, "err_low": 243.9199981689453, "err_high": 263.9199981689453}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true, "std": 5, "err_low": 167.30999755859375, "err_high": 187.30999755859375}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true, "std": 5, "err_low": 87.06999969482422, "err_high": 107.06999969482422}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true, "std": 5, "err_low": 29.709999084472656, "err_high": 49.709999084472656}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true, "std": 5, "err_low": 0.6499996185302734, "err_high": 20.649999618530273}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true, "std": 5, "err_low": -9.680000007152557, "err_high": 10.319999992847443}, {"time": "2000-06-15T16:30:00", "variable": "VPD", "value": 6.453999996185303, "is_present": false, "std": 5, "err_low": -3.5460000038146973, "err_high": 16.453999996185303}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": false, "std": 5, "err_low": -4.201000213623047, "err_high": 15.798999786376953}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": false, "std": 5, "err_low": -3.422999858856201, "err_high": 16.5770001411438}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": false, "std": 5, "err_low": -3.068999767303467, "err_high": 16.931000232696533}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": false, "std": 5, "err_low": -2.7140002250671387, "err_high": 17.28599977493286}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true, "std": 5, "err_low": -2.749000072479248, "err_high": 17.250999927520752}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true, "std": 5, "err_low": -3.316999912261963, "err_high": 16.683000087738037}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true, "std": 5, "err_low": -4.14900016784668, "err_high": 15.85099983215332}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true, "std": 5, "err_low": -4.745999813079834, "err_high": 15.254000186920166}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true, "std": 5, "err_low": -4.835999965667725, "err_high": 15.164000034332275}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="variable" class="level5">
<h5 class="anchored" data-anchor-id="variable">Variable</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy(), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-84f7936910b24513bedff4867caf9af0"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-84f7936910b24513bedff4867caf9af0") {
      outputDiv = document.getElementById("altair-viz-84f7936910b24513bedff4867caf9af0");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}, "name": "view_39"}], "data": {"name": "data-56120284c98ea45ee642dd5b510147c7"}, "params": [{"name": "param_60", "select": {"type": "interval"}, "bind": "scales", "views": ["view_39"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-56120284c98ea45ee642dd5b510147c7": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plot_variable(m_df.tidy().assign(std<span class="op">=</span><span class="fl">.5</span>), <span class="st">"TA"</span>, title<span class="op">=</span><span class="st">"title TA"</span>, error<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-6c531853709b4e9482cdd21d9180f8f4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-6c531853709b4e9482cdd21d9180f8f4") {
      outputDiv = document.getElementById("altair-viz-6c531853709b4e9482cdd21d9180f8f4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_2"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "", "type": "quantitative"}}}]}], "data": {"name": "data-fd216a9f02cde58db5f8d533d8c02952"}, "params": [{"name": "param_7", "select": {"type": "interval"}, "bind": "scales", "views": ["view_2"]}], "title": "title TA", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-fd216a9f02cde58db5f8d533d8c02952": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false, "std": 0.5, "err_low": 13.649999618530273, "err_high": 15.649999618530273}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false, "std": 0.5, "err_low": 13.220000267028809, "err_high": 15.220000267028809}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false, "std": 0.5, "err_low": 13.109999656677246, "err_high": 15.109999656677246}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false, "std": 0.5, "err_low": 13.229999542236328, "err_high": 15.229999542236328}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false, "std": 0.5, "err_low": 13.399999618530273, "err_high": 15.399999618530273}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true, "std": 0.5, "err_low": 13.09000015258789, "err_high": 15.09000015258789}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true, "std": 0.5, "err_low": 12.710000038146973, "err_high": 14.710000038146973}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true, "std": 0.5, "err_low": 12.079999923706055, "err_high": 14.079999923706055}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true, "std": 0.5, "err_low": 11.40999984741211, "err_high": 13.40999984741211}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true, "std": 0.5, "err_low": 11.270000457763672, "err_high": 13.270000457763672}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="facet" class="level5">
<h5 class="anchored" data-anchor-id="facet">Facet</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L184" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="facet_variable" class="level3">
<h3 class="anchored" data-anchor-id="facet_variable">facet_variable</h3>
<blockquote class="blockquote">
<pre><code> facet_variable (df, n_cols:int=3, bind_interaction:bool=True,
                 error:bool=False, ys:list=['value', 'value'],
                 props:dict|None=None)</code></pre>
</blockquote>
<p>Plot all values of the column <code>variable</code> in different subplots</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td></td>
<td></td>
<td>tidy dataframe</td>
</tr>
<tr class="even">
<td>n_cols</td>
<td>int</td>
<td>3</td>
<td></td>
</tr>
<tr class="odd">
<td>bind_interaction</td>
<td>bool</td>
<td>True</td>
<td>Whether the sub-plots for each variable should be connected for zooming/panning</td>
</tr>
<tr class="even">
<td>error</td>
<td>bool</td>
<td>False</td>
<td>plot error bar</td>
</tr>
<tr class="odd">
<td>ys</td>
<td>list</td>
<td>[value, value]</td>
<td></td>
</tr>
<tr class="even">
<td>props</td>
<td>dict | None</td>
<td>None</td>
<td>additional properties for altair plot (eg. size)</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Chart</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<section id="show" class="level5">
<h5 class="anchored" data-anchor-id="show">Show</h5>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L214" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="maskeddf.show" class="level3">
<h3 class="anchored" data-anchor-id="maskeddf.show">MaskedDf.show</h3>
<blockquote class="blockquote">
<pre><code> MaskedDf.show (ax=None, ctx=None, n_cols:int=3,
                bind_interaction:bool=True, props:dict=None)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ax</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>ctx</td>
<td>NoneType</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>n_cols</td>
<td>int</td>
<td>3</td>
<td></td>
</tr>
<tr class="even">
<td>bind_interaction</td>
<td>bool</td>
<td>True</td>
<td>Whether the sub-plots for each variable should be connected for zooming/panning</td>
</tr>
<tr class="odd">
<td>props</td>
<td>dict</td>
<td>None</td>
<td>additional properties (eg. size) for altair plot</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>Chart</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>m_df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-f387254a405b4292adf71ccc0c4f90e4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-f387254a405b4292adf71ccc0c4f90e4") {
      outputDiv = document.getElementById("altair-viz-f387254a405b4292adf71ccc0c4f90e4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}, "name": "view_40"}], "height": 150, "title": "TA", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}, "name": "view_41"}], "data": {"name": "data-5a1f3fac3d9df47c6d1f6f3a5658ee3a"}, "height": 150, "title": "SW_IN", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}, "name": "view_42"}], "data": {"name": "data-d31baa6ca74e0aff36d178089e8b875a"}, "height": 150, "title": "VPD", "width": 200}]}], "data": {"name": "data-56120284c98ea45ee642dd5b510147c7"}, "params": [{"name": "param_61", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_40", "view_41", "view_42"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-56120284c98ea45ee642dd5b510147c7": [{"time": "2000-06-15T16:30:00", "variable": "TA", "value": 14.649999618530273, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "TA", "value": 14.220000267028809, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "TA", "value": 14.109999656677246, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "TA", "value": 14.229999542236328, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "TA", "value": 14.399999618530273, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "TA", "value": 14.09000015258789, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "TA", "value": 13.710000038146973, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "TA", "value": 12.40999984741211, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "TA", "value": 12.270000457763672, "is_present": true}], "data-5a1f3fac3d9df47c6d1f6f3a5658ee3a": [{"time": "2000-06-15T16:30:00", "variable": "SW_IN", "value": 468.19000244140625, "is_present": true}, {"time": "2000-06-15T17:00:00", "variable": "SW_IN", "value": 224.8000030517578, "is_present": true}, {"time": "2000-06-15T17:30:00", "variable": "SW_IN", "value": 195.27999877929688, "is_present": true}, {"time": "2000-06-15T18:00:00", "variable": "SW_IN", "value": 244.1699981689453, "is_present": true}, {"time": "2000-06-15T18:30:00", "variable": "SW_IN", "value": 253.9199981689453, "is_present": true}, {"time": "2000-06-15T19:00:00", "variable": "SW_IN", "value": 177.30999755859375, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "SW_IN", "value": 97.06999969482422, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "SW_IN", "value": 39.709999084472656, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "SW_IN", "value": 10.649999618530273, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "SW_IN", "value": 0.3199999928474426, "is_present": true}], "data-d31baa6ca74e0aff36d178089e8b875a": [{"time": "2000-06-15T16:30:00", "variable": "VPD", "value": 6.453999996185303, "is_present": false}, {"time": "2000-06-15T17:00:00", "variable": "VPD", "value": 5.798999786376953, "is_present": false}, {"time": "2000-06-15T17:30:00", "variable": "VPD", "value": 6.577000141143799, "is_present": false}, {"time": "2000-06-15T18:00:00", "variable": "VPD", "value": 6.931000232696533, "is_present": false}, {"time": "2000-06-15T18:30:00", "variable": "VPD", "value": 7.285999774932861, "is_present": false}, {"time": "2000-06-15T19:00:00", "variable": "VPD", "value": 7.250999927520752, "is_present": true}, {"time": "2000-06-15T19:30:00", "variable": "VPD", "value": 6.683000087738037, "is_present": true}, {"time": "2000-06-15T20:00:00", "variable": "VPD", "value": 5.85099983215332, "is_present": true}, {"time": "2000-06-15T20:30:00", "variable": "VPD", "value": 5.254000186920166, "is_present": true}, {"time": "2000-06-15T21:00:00", "variable": "VPD", "value": 5.164000034332275, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>a_gap(blk(<span class="dv">799</span>)).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-28dc655236a3408d89ad72abcc1de14e"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-28dc655236a3408d89ad72abcc1de14e") {
      outputDiv = document.getElementById("altair-viz-28dc655236a3408d89ad72abcc1de14e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}, "name": "view_43"}], "height": 150, "title": "TA", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}, "name": "view_44"}], "data": {"name": "data-c927eb5cf250cf0872c3a170980e7a6e"}, "height": 150, "title": "SW_IN", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}, "name": "view_45"}], "data": {"name": "data-2d15c0d997d750a4629fa2ee390a7799"}, "height": 150, "title": "VPD", "width": 200}]}], "data": {"name": "data-7de1e3825a3baffad826ed447ef7400b"}, "params": [{"name": "param_65", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_43", "view_44", "view_45"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-7de1e3825a3baffad826ed447ef7400b": [{"time": "2000-06-15T11:30:00", "variable": "TA", "value": 15.109999656677246, "is_present": true}, {"time": "2000-06-15T12:00:00", "variable": "TA", "value": 13.1899995803833, "is_present": false}, {"time": "2000-06-15T12:30:00", "variable": "TA", "value": 14.430000305175781, "is_present": false}, {"time": "2000-06-15T13:00:00", "variable": "TA", "value": 14.609999656677246, "is_present": false}, {"time": "2000-06-15T13:30:00", "variable": "TA", "value": 13.529999732971191, "is_present": false}, {"time": "2000-06-15T14:00:00", "variable": "TA", "value": 13.430000305175781, "is_present": false}, {"time": "2000-06-15T14:30:00", "variable": "TA", "value": 13.079999923706055, "is_present": true}, {"time": "2000-06-15T15:00:00", "variable": "TA", "value": 13.369999885559082, "is_present": true}, {"time": "2000-06-15T15:30:00", "variable": "TA", "value": 14.319999694824219, "is_present": true}, {"time": "2000-06-15T16:00:00", "variable": "TA", "value": 15.0, "is_present": true}], "data-c927eb5cf250cf0872c3a170980e7a6e": [{"time": "2000-06-15T11:30:00", "variable": "SW_IN", "value": 151.3000030517578, "is_present": true}, {"time": "2000-06-15T12:00:00", "variable": "SW_IN", "value": 697.1300048828125, "is_present": true}, {"time": "2000-06-15T12:30:00", "variable": "SW_IN", "value": 744.6799926757812, "is_present": true}, {"time": "2000-06-15T13:00:00", "variable": "SW_IN", "value": 357.739990234375, "is_present": true}, {"time": "2000-06-15T13:30:00", "variable": "SW_IN", "value": 158.25, "is_present": true}, {"time": "2000-06-15T14:00:00", "variable": "SW_IN", "value": 105.04000091552734, "is_present": true}, {"time": "2000-06-15T14:30:00", "variable": "SW_IN", "value": 142.63999938964844, "is_present": true}, {"time": "2000-06-15T15:00:00", "variable": "SW_IN", "value": 412.42999267578125, "is_present": true}, {"time": "2000-06-15T15:30:00", "variable": "SW_IN", "value": 600.510009765625, "is_present": true}, {"time": "2000-06-15T16:00:00", "variable": "SW_IN", "value": 635.8800048828125, "is_present": true}], "data-2d15c0d997d750a4629fa2ee390a7799": [{"time": "2000-06-15T11:30:00", "variable": "VPD", "value": 2.7709999084472656, "is_present": true}, {"time": "2000-06-15T12:00:00", "variable": "VPD", "value": 1.6490000486373901, "is_present": false}, {"time": "2000-06-15T12:30:00", "variable": "VPD", "value": 2.569999933242798, "is_present": false}, {"time": "2000-06-15T13:00:00", "variable": "VPD", "value": 2.7160000801086426, "is_present": false}, {"time": "2000-06-15T13:30:00", "variable": "VPD", "value": 3.0759999752044678, "is_present": false}, {"time": "2000-06-15T14:00:00", "variable": "VPD", "value": 2.809000015258789, "is_present": false}, {"time": "2000-06-15T14:30:00", "variable": "VPD", "value": 2.359999895095825, "is_present": true}, {"time": "2000-06-15T15:00:00", "variable": "VPD", "value": 4.0370001792907715, "is_present": true}, {"time": "2000-06-15T15:30:00", "variable": "VPD", "value": 5.583000183105469, "is_present": true}, {"time": "2000-06-15T16:00:00", "variable": "VPD", "value": 6.328999996185303, "is_present": true}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> L(<span class="op">*</span>blk(<span class="dv">1</span>).columns).argwhere(<span class="kw">lambda</span> x: x <span class="kw">in</span> [<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.ones_like(blk(<span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">bool</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>gap <span class="op">=</span> _make_random_gap(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([False, False,  True,  True, False, False, False, False, False,
       False])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>np.argwhere(gap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[2],
       [3]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mask[np.argwhere(gap), idx] <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[ True,  True,  True],
       [ True,  True,  True],
       [False, False,  True],
       [False, False,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True],
       [ True,  True,  True]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mask[gap]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[False, False,  True],
       [False, False,  True]])</code></pre>
</div>
</div>
</section>
<section id="to-tensor" class="level3">
<h3 class="anchored" data-anchor-id="to-tensor">3) To Tensor</h3>
<p>this needs to handle both the init with a list of items and when the first item is a sequence of list of items</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L224" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="maskedtensor" class="level3">
<h3 class="anchored" data-anchor-id="maskedtensor">MaskedTensor</h3>
<blockquote class="blockquote">
<pre><code> MaskedTensor (*args)</code></pre>
</blockquote>
<p>All the operations on a read-only sequence.</p>
<p>Concrete subclasses must override <strong>new</strong> or <strong>init</strong>, <strong>getitem</strong>, and <strong>len</strong>.</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L244" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="maskeddf2tensor" class="level3">
<h3 class="anchored" data-anchor-id="maskeddf2tensor">MaskedDf2Tensor</h3>
<blockquote class="blockquote">
<pre><code> MaskedDf2Tensor (enc=None, dec=None, split_idx=None, order=None)</code></pre>
</blockquote>
<p>Delegates (<code>__call__</code>,<code>decode</code>,<code>setup</code>) to (<code>encodes</code>,<code>decodes</code>,<code>setups</code>) if <code>split_idx</code> matches</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>to_t <span class="op">=</span> MaskedDf2Tensor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>to_t.setup(tfms2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>to_t(tfms2[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedTensor(data=tensor([[1.4650e+01, 4.6819e+02, 6.4540e+00],
        [1.4220e+01, 2.2480e+02, 5.7990e+00],
        [1.4110e+01, 1.9528e+02, 6.5770e+00],
        [1.4230e+01, 2.4417e+02, 6.9310e+00],
        [1.4400e+01, 2.5392e+02, 7.2860e+00],
        [1.4090e+01, 1.7731e+02, 7.2510e+00],
        [1.3710e+01, 9.7070e+01, 6.6830e+00],
        [1.3080e+01, 3.9710e+01, 5.8510e+00],
        [1.2410e+01, 1.0650e+01, 5.2540e+00],
        [1.2270e+01, 3.2000e-01, 5.1640e+00]]), mask=tensor([[ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>to_t.decode(to_t(tfms2[<span class="dv">0</span>]))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tfms2[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold">Masked Df</p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_640d4">
  <thead>
    <tr>
      <th id="T_640d4_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_640d4_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_640d4_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_640d4_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_640d4_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_640d4_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_640d4_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_640d4_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_640d4_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_640d4_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_640d4_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_640d4_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_640d4_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_640d4_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_640d4_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_640d4_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_640d4_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_640d4_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_640d4_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_640d4_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_640d4_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_640d4_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_640d4_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_640d4_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_640d4_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_640d4_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_640d4_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_640d4_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_640d4_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_640d4_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_640d4_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_640d4_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_640d4_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_0e668">
  <thead>
    <tr>
      <th id="T_0e668_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_0e668_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_0e668_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_0e668_row0_col0" class="data row0 col0">True</td>
      <td id="T_0e668_row0_col1" class="data row0 col1">True</td>
      <td id="T_0e668_row0_col2" class="data row0 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row1_col0" class="data row1 col0">False</td>
      <td id="T_0e668_row1_col1" class="data row1 col1">False</td>
      <td id="T_0e668_row1_col2" class="data row1 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row2_col0" class="data row2 col0">False</td>
      <td id="T_0e668_row2_col1" class="data row2 col1">False</td>
      <td id="T_0e668_row2_col2" class="data row2 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row3_col0" class="data row3 col0">True</td>
      <td id="T_0e668_row3_col1" class="data row3 col1">True</td>
      <td id="T_0e668_row3_col2" class="data row3 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row4_col0" class="data row4 col0">True</td>
      <td id="T_0e668_row4_col1" class="data row4 col1">True</td>
      <td id="T_0e668_row4_col2" class="data row4 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row5_col0" class="data row5 col0">True</td>
      <td id="T_0e668_row5_col1" class="data row5 col1">True</td>
      <td id="T_0e668_row5_col2" class="data row5 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row6_col0" class="data row6 col0">True</td>
      <td id="T_0e668_row6_col1" class="data row6 col1">True</td>
      <td id="T_0e668_row6_col2" class="data row6 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row7_col0" class="data row7 col0">True</td>
      <td id="T_0e668_row7_col1" class="data row7 col1">True</td>
      <td id="T_0e668_row7_col2" class="data row7 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row8_col0" class="data row8 col0">True</td>
      <td id="T_0e668_row8_col1" class="data row8 col1">True</td>
      <td id="T_0e668_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_0e668_row9_col0" class="data row9 col0">True</td>
      <td id="T_0e668_row9_col1" class="data row9 col1">True</td>
      <td id="T_0e668_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(MaskedDf2Tensor())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedDf2Tensor</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>tfms3 <span class="op">=</span> TfmdLists([<span class="dv">800</span>, <span class="dv">801</span>, <span class="dv">802</span>], [BlockDfTransform(hai, <span class="dv">10</span>), AddGapTransform([<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>], <span class="dv">2</span>), MaskedDf2Tensor()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>tfms3[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedTensor(data=tensor([[1.4650e+01, 4.6819e+02, 6.4540e+00],
        [1.4220e+01, 2.2480e+02, 5.7990e+00],
        [1.4110e+01, 1.9528e+02, 6.5770e+00],
        [1.4230e+01, 2.4417e+02, 6.9310e+00],
        [1.4400e+01, 2.5392e+02, 7.2860e+00],
        [1.4090e+01, 1.7731e+02, 7.2510e+00],
        [1.3710e+01, 9.7070e+01, 6.6830e+00],
        [1.3080e+01, 3.9710e+01, 5.8510e+00],
        [1.2410e+01, 1.0650e+01, 5.2540e+00],
        [1.2270e+01, 3.2000e-01, 5.1640e+00]]), mask=tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(tfms3[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedTensor</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tfms3.decode(tfms3[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold">Masked Df</p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_4236a">
  <thead>
    <tr>
      <th id="T_4236a_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_4236a_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_4236a_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_4236a_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_4236a_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_4236a_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_4236a_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_4236a_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_4236a_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_4236a_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_4236a_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_4236a_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_4236a_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_4236a_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_4236a_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_4236a_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_4236a_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_4236a_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_4236a_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_4236a_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_4236a_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_4236a_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_4236a_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_4236a_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_4236a_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_4236a_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_4236a_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_4236a_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_4236a_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_4236a_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_4236a_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_4236a_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_4236a_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_48bf6">
  <thead>
    <tr>
      <th id="T_48bf6_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_48bf6_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_48bf6_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_48bf6_row0_col0" class="data row0 col0">True</td>
      <td id="T_48bf6_row0_col1" class="data row0 col1">True</td>
      <td id="T_48bf6_row0_col2" class="data row0 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row1_col0" class="data row1 col0">True</td>
      <td id="T_48bf6_row1_col1" class="data row1 col1">True</td>
      <td id="T_48bf6_row1_col2" class="data row1 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row2_col0" class="data row2 col0">True</td>
      <td id="T_48bf6_row2_col1" class="data row2 col1">True</td>
      <td id="T_48bf6_row2_col2" class="data row2 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row3_col0" class="data row3 col0">True</td>
      <td id="T_48bf6_row3_col1" class="data row3 col1">True</td>
      <td id="T_48bf6_row3_col2" class="data row3 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row4_col0" class="data row4 col0">True</td>
      <td id="T_48bf6_row4_col1" class="data row4 col1">True</td>
      <td id="T_48bf6_row4_col2" class="data row4 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row5_col0" class="data row5 col0">True</td>
      <td id="T_48bf6_row5_col1" class="data row5 col1">True</td>
      <td id="T_48bf6_row5_col2" class="data row5 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row6_col0" class="data row6 col0">True</td>
      <td id="T_48bf6_row6_col1" class="data row6 col1">True</td>
      <td id="T_48bf6_row6_col2" class="data row6 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row7_col0" class="data row7 col0">False</td>
      <td id="T_48bf6_row7_col1" class="data row7 col1">False</td>
      <td id="T_48bf6_row7_col2" class="data row7 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row8_col0" class="data row8 col0">False</td>
      <td id="T_48bf6_row8_col1" class="data row8 col1">False</td>
      <td id="T_48bf6_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_48bf6_row9_col0" class="data row9 col0">True</td>
      <td id="T_48bf6_row9_col1" class="data row9 col1">True</td>
      <td id="T_48bf6_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
</section>
<section id="normalize" class="level3">
<h3 class="anchored" data-anchor-id="normalize">4) Normalize</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>collections.namedtuple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;function collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>nt <span class="op">=</span> collections.namedtuple(<span class="st">"nt"</span>, <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">isinstance</span>(nt(<span class="dv">1</span>), <span class="bu">tuple</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L264" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalsparams" class="level3">
<h3 class="anchored" data-anchor-id="normalsparams">NormalsParams</h3>
<blockquote class="blockquote">
<pre><code> NormalsParams (*args)</code></pre>
</blockquote>
<p>Built-in mutable sequence.</p>
<p>If no argument is given, the constructor creates a new empty list. The argument must be an iterable if specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>NormalsParams(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=0, std=1)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L288" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_stats" class="level3">
<h3 class="anchored" data-anchor-id="get_stats">get_stats</h3>
<blockquote class="blockquote">
<pre><code> get_stats (df, device='cpu')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L292" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalizemasked" class="level3">
<h3 class="anchored" data-anchor-id="normalizemasked">NormalizeMasked</h3>
<blockquote class="blockquote">
<pre><code> NormalizeMasked (mean=None, std=None)</code></pre>
</blockquote>
<p>Normalize/denorm MaskedTensor column-wise</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> NormalizeMasked(<span class="op">*</span>get_stats(hai))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>tfms3[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedTensor(data=tensor([[1.4650e+01, 4.6819e+02, 6.4540e+00],
        [1.4220e+01, 2.2480e+02, 5.7990e+00],
        [1.4110e+01, 1.9528e+02, 6.5770e+00],
        [1.4230e+01, 2.4417e+02, 6.9310e+00],
        [1.4400e+01, 2.5392e+02, 7.2860e+00],
        [1.4090e+01, 1.7731e+02, 7.2510e+00],
        [1.3710e+01, 9.7070e+01, 6.6830e+00],
        [1.3080e+01, 3.9710e+01, 5.8510e+00],
        [1.2410e+01, 1.0650e+01, 5.2540e+00],
        [1.2270e+01, 3.2000e-01, 5.1640e+00]]), mask=tensor([[ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>test_close(norm.decode(norm(tfms3[<span class="dv">0</span>]))[<span class="dv">0</span>], tfms3[<span class="dv">0</span>][<span class="dv">0</span>], eps<span class="op">=</span><span class="fl">2e-5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Test that NormalsParams decode actually works</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>Npars <span class="op">=</span> NormalsParams(torch.tensor(<span class="dv">1</span>), torch.tensor(<span class="fl">.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>norm.decode(Npars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=tensor([ 16.2585, 324.9604,   7.7491]), std=tensor([ 0.7925, 20.4003,  0.4368]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>tfms4 <span class="op">=</span> TfmdLists([<span class="dv">800</span>,<span class="dv">801</span>,<span class="dv">803</span>], [BlockDfTransform(hai, <span class="dv">10</span>), </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                           AddGapTransform([<span class="st">'TA'</span>,<span class="st">'SW_IN'</span>], <span class="dv">2</span>),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                           MaskedDf2Tensor(),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                           NormalizeMasked(<span class="op">*</span>get_stats(hai,device<span class="op">=</span><span class="st">'cpu'</span>), ) ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>tfms4[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.MaskedTensor(data=tensor([[ 0.7970,  1.7021,  0.7035],
        [ 0.7428,  0.5090,  0.5536],
        [ 0.7289,  0.3643,  0.7317],
        [ 0.7440,  0.6040,  0.8127],
        [ 0.7655,  0.6518,  0.8940],
        [ 0.7264,  0.2762,  0.8860],
        [ 0.6784, -0.1171,  0.7560],
        [ 0.5989, -0.3983,  0.5655],
        [ 0.5144, -0.5407,  0.4288],
        [ 0.4967, -0.5914,  0.4082]]), mask=tensor([[ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [False, False,  True],
        [False, False,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True],
        [ True,  True,  True]]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>tfms4.decode(tfms4[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold">Masked Df</p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">data</p> <style type="text/css">
</style>
<table id="T_76a86">
  <thead>
    <tr>
      <th id="T_76a86_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_76a86_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_76a86_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_76a86_row0_col0" class="data row0 col0">14.6500</td>
      <td id="T_76a86_row0_col1" class="data row0 col1">468.1900</td>
      <td id="T_76a86_row0_col2" class="data row0 col2">6.4540</td>
    </tr>
    <tr>
      <td id="T_76a86_row1_col0" class="data row1 col0">14.2200</td>
      <td id="T_76a86_row1_col1" class="data row1 col1">224.8000</td>
      <td id="T_76a86_row1_col2" class="data row1 col2">5.7990</td>
    </tr>
    <tr>
      <td id="T_76a86_row2_col0" class="data row2 col0">14.1100</td>
      <td id="T_76a86_row2_col1" class="data row2 col1">195.2800</td>
      <td id="T_76a86_row2_col2" class="data row2 col2">6.5770</td>
    </tr>
    <tr>
      <td id="T_76a86_row3_col0" class="data row3 col0">14.2300</td>
      <td id="T_76a86_row3_col1" class="data row3 col1">244.1700</td>
      <td id="T_76a86_row3_col2" class="data row3 col2">6.9310</td>
    </tr>
    <tr>
      <td id="T_76a86_row4_col0" class="data row4 col0">14.4000</td>
      <td id="T_76a86_row4_col1" class="data row4 col1">253.9200</td>
      <td id="T_76a86_row4_col2" class="data row4 col2">7.2860</td>
    </tr>
    <tr>
      <td id="T_76a86_row5_col0" class="data row5 col0">14.0900</td>
      <td id="T_76a86_row5_col1" class="data row5 col1">177.3100</td>
      <td id="T_76a86_row5_col2" class="data row5 col2">7.2510</td>
    </tr>
    <tr>
      <td id="T_76a86_row6_col0" class="data row6 col0">13.7100</td>
      <td id="T_76a86_row6_col1" class="data row6 col1">97.0700</td>
      <td id="T_76a86_row6_col2" class="data row6 col2">6.6830</td>
    </tr>
    <tr>
      <td id="T_76a86_row7_col0" class="data row7 col0">13.0800</td>
      <td id="T_76a86_row7_col1" class="data row7 col1">39.7100</td>
      <td id="T_76a86_row7_col2" class="data row7 col2">5.8510</td>
    </tr>
    <tr>
      <td id="T_76a86_row8_col0" class="data row8 col0">12.4100</td>
      <td id="T_76a86_row8_col1" class="data row8 col1">10.6500</td>
      <td id="T_76a86_row8_col2" class="data row8 col2">5.2540</td>
    </tr>
    <tr>
      <td id="T_76a86_row9_col0" class="data row9 col0">12.2700</td>
      <td id="T_76a86_row9_col1" class="data row9 col1">0.3200</td>
      <td id="T_76a86_row9_col2" class="data row9 col2">5.1640</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">mask</p> <style type="text/css">
</style>
<table id="T_86646">
  <thead>
    <tr>
      <th id="T_86646_level0_col0" class="col_heading level0 col0">TA</th>
      <th id="T_86646_level0_col1" class="col_heading level0 col1">SW_IN</th>
      <th id="T_86646_level0_col2" class="col_heading level0 col2">VPD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_86646_row0_col0" class="data row0 col0">True</td>
      <td id="T_86646_row0_col1" class="data row0 col1">True</td>
      <td id="T_86646_row0_col2" class="data row0 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row1_col0" class="data row1 col0">True</td>
      <td id="T_86646_row1_col1" class="data row1 col1">True</td>
      <td id="T_86646_row1_col2" class="data row1 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row2_col0" class="data row2 col0">True</td>
      <td id="T_86646_row2_col1" class="data row2 col1">True</td>
      <td id="T_86646_row2_col2" class="data row2 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row3_col0" class="data row3 col0">True</td>
      <td id="T_86646_row3_col1" class="data row3 col1">True</td>
      <td id="T_86646_row3_col2" class="data row3 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row4_col0" class="data row4 col0">True</td>
      <td id="T_86646_row4_col1" class="data row4 col1">True</td>
      <td id="T_86646_row4_col2" class="data row4 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row5_col0" class="data row5 col0">True</td>
      <td id="T_86646_row5_col1" class="data row5 col1">True</td>
      <td id="T_86646_row5_col2" class="data row5 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row6_col0" class="data row6 col0">False</td>
      <td id="T_86646_row6_col1" class="data row6 col1">False</td>
      <td id="T_86646_row6_col2" class="data row6 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row7_col0" class="data row7 col0">False</td>
      <td id="T_86646_row7_col1" class="data row7 col1">False</td>
      <td id="T_86646_row7_col2" class="data row7 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row8_col0" class="data row8 col0">True</td>
      <td id="T_86646_row8_col1" class="data row8 col1">True</td>
      <td id="T_86646_row8_col2" class="data row8 col2">True</td>
    </tr>
    <tr>
      <td id="T_86646_row9_col0" class="data row9 col0">True</td>
      <td id="T_86646_row9_col1" class="data row9 col1">True</td>
      <td id="T_86646_row9_col2" class="data row9 col2">True</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<p>is workinggggggggggggggggg</p>
</section>
<section id="to-tuple" class="level3">
<h3 class="anchored" data-anchor-id="to-tuple">5) To Tuple</h3>
<p>Fastai likes to work with tuples  for now convert to a tuple. Should add a decode step and maybe find a way to mimic a tuple in MaskedTensor</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L314" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="to_tuple" class="level3">
<h3 class="anchored" data-anchor-id="to_tuple">to_tuple</h3>
<blockquote class="blockquote">
<pre><code> to_tuple (x)</code></pre>
</blockquote>
</section>
<section id="pipeline" class="level3">
<h3 class="anchored" data-anchor-id="pipeline">Pipeline</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>block_len <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>block_ids <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, (<span class="bu">len</span>(hai) <span class="op">//</span> block_len) <span class="op">-</span> <span class="dv">1</span>))[:<span class="dv">10</span>]</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>gap_len <span class="op">=</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L321" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="imp_pipeline" class="level3">
<h3 class="anchored" data-anchor-id="imp_pipeline">imp_pipeline</h3>
<blockquote class="blockquote">
<pre><code> imp_pipeline (df, block_len, gap_len)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>pipeline, block_ids <span class="op">=</span> imp_pipeline(hai, block_len, gap_len)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[BlockDfTransform:
 encodes: (int,object) -&gt; encodes
 decodes: ,
 AddGapTransform:
 encodes: (DataFrame,object) -&gt; encodes
 decodes: ,
 __main__.MaskedDf2Tensor,
 NormalizeMasked -- {'mean': tensor([  8.3339, 120.9578,   3.3807]), 'std': tensor([  7.9246, 204.0026,   4.3684])}:
 encodes: (MaskedTensor,object) -&gt; encodes
 decodes: (MaskedTensor,object) -&gt; decodes
 (NormalsParams,object) -&gt; decodes,
 &lt;function __main__.to_tuple(x)&gt;]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>pp <span class="op">=</span> Pipeline(pipeline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Pipeline: BlockDfTransform -&gt; AddGapTransform -&gt; MaskedDf2Tensor -&gt; NormalizeMasked -- {'mean': tensor([  8.3339, 120.9578,   3.3807]), 'std': tensor([  7.9246, 204.0026,   4.3684])} -&gt; to_tuple</code></pre>
</div>
</div>
</section>
<section id="dataloader" class="level3">
<h3 class="anchored" data-anchor-id="dataloader">Dataloader</h3>
<p>random splitter for validation/training set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>reset_seed()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> RandomSplitter()(block_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Repeat twice the pipeline since is the same pipeline both for training data and for labels</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> collections</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_tuple(x):</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">tuple</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="bu">isinstance</span>(tfms4[<span class="dv">0</span>], Sequence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> Datasets(block_ids, [pipeline, pipeline], splits<span class="op">=</span>splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ds.dataloaders(bs<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>dls.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cuda', index=0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((tensor([[[ 0.6809, -0.4015,  0.8095],
           [ 0.6506, -0.4144,  0.7445],
           [ 0.6380, -0.5090,  0.7070],
           [ 0.6077, -0.5796,  0.6046],
           [ 0.5825, -0.5929,  0.5275],
           [ 0.5674, -0.5929,  0.4774],
           [ 0.5295, -0.5929,  0.3698],
           [ 0.5080, -0.5929,  0.2986],
           [ 0.4702, -0.5929,  0.2132],
           [ 0.3970, -0.5929,  0.0195]]], device='cuda:0'),
  tensor([[[False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]]], device='cuda:0')),
 (tensor([[[ 0.6809, -0.4015,  0.8095],
           [ 0.6506, -0.4144,  0.7445],
           [ 0.6380, -0.5090,  0.7070],
           [ 0.6077, -0.5796,  0.6046],
           [ 0.5825, -0.5929,  0.5275],
           [ 0.5674, -0.5929,  0.4774],
           [ 0.5295, -0.5929,  0.3698],
           [ 0.5080, -0.5929,  0.2986],
           [ 0.4702, -0.5929,  0.2132],
           [ 0.3970, -0.5929,  0.0195]]], device='cuda:0'),
  tensor([[[ True,  True,  True],
           [False, False,  True],
           [False, False,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True],
           [ True,  True,  True]]], device='cuda:0')))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="at">@typedispatch</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_batch(x: MaskedDf, y, samples, ctxs<span class="op">=</span><span class="va">None</span>, max_n<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dls.show_batch()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>dls._types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{tuple: [{tuple: [torch.Tensor, torch.Tensor]},
  {tuple: [torch.Tensor, torch.Tensor]}]}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>Datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>fastai.data.core.Datasets</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L334" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="make_dataloader" class="level3">
<h3 class="anchored" data-anchor-id="make_dataloader">make_dataloader</h3>
<blockquote class="blockquote">
<pre><code> make_dataloader (df, block_len, gap_len, bs=10)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> make_dataloader(hai, <span class="dv">200</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()[<span class="dv">0</span>][<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> dls.cpu()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<section id="forward-function" class="level3">
<h3 class="anchored" data-anchor-id="forward-function">Forward Function</h3>
<p>in order to the a pytorch module we need a forward method to the kalman filter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KalmanFilter.init_simple(n_dim <span class="op">=</span> hai.shape[<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>model._predict_filter(<span class="op">*</span>dls.one_batch()[<span class="dv">0</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L360" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="kalmanfilter.forward" class="level3">
<h3 class="anchored" data-anchor-id="kalmanfilter.forward">KalmanFilter.forward</h3>
<blockquote class="blockquote">
<pre><code> KalmanFilter.forward (masked_data:__main__.MaskedTensor)</code></pre>
</blockquote>
<p>Defines the computation performed at every call.</p>
<p>Should be overridden by all subclasses.</p>
<p>.. note:: Although the recipe for forward pass needs to be defined within this function, one should call the :class:<code>Module</code> instance afterwards instead of this since the former takes care of running the registered hooks while the latter silently ignores them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span> <span class="op">=</span> dls.one_batch()[<span class="dv">0</span>]</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> dls.one_batch()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>model.state_dict()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>OrderedDict([('trans_matrix',
              tensor([[1., 0., 0.],
                      [0., 1., 0.],
                      [0., 0., 1.]])),
             ('trans_off', tensor([0., 0., 0.])),
             ('trans_cov_raw',
              tensor([[1., 0., 0.],
                      [0., 1., 0.],
                      [0., 0., 1.]])),
             ('obs_matrix',
              tensor([[1., 0., 0.],
                      [0., 1., 0.],
                      [0., 0., 1.]])),
             ('obs_off', tensor([0., 0., 0.])),
             ('obs_cov_raw',
              tensor([[1., 0., 0.],
                      [0., 1., 0.],
                      [0., 0., 1.]])),
             ('init_state_mean', tensor([0., 0., 0.])),
             ('init_state_cov_raw',
              tensor([[1., 0., 0.],
                      [0., 1., 0.],
                      [0., 0., 1.]]))])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">input</span>[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="bu">input</span>[<span class="dv">1</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>data.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cpu')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>torch.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.device</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>data.shape, mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([200, 3]), torch.Size([200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>model.predict(data.unsqueeze(<span class="dv">0</span>), mask.unsqueeze(<span class="dv">0</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>model.use_smooth <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>pred[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>pred[<span class="dv">1</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>model.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>pred_filt <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>pred_filt[<span class="dv">1</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>__main__.NormalsParams(mean=tensor([[[ 0.4305, -0.3543, -0.3944],
         [ 0.5966, -0.4733, -0.5362],
         [ 0.6621, -0.4939, -0.5718],
         ...,
         [ 0.4990,  0.9915,  0.1832],
         [ 0.5420,  1.3506,  0.2599],
         [ 0.5762,  1.6095,  0.3222]],

        [[ 0.7207, -0.3664,  0.8051],
         [ 0.9751, -0.5064,  1.0454],
         [ 1.0404, -0.5599,  1.0553],
         ...,
         [ 1.4756, -0.5929,  1.4741],
         [ 1.4541, -0.5929,  1.4270],
         [ 1.4486, -0.5929,  1.4121]],

        [[ 0.5692, -0.3595,  1.0573],
         [ 0.7680, -0.5038,  1.4338],
         [ 0.8193, -0.5589,  1.5195],
         ...,
         [ 0.8515, -0.5922, -0.4953],
         [ 0.8453, -0.5926, -0.4927],
         [ 0.8407, -0.5928, -0.4984]],

        ...,

        [[ 0.6929, -0.3371,  0.0250],
         [ 0.9512, -0.4182,  0.0215],
         [ 1.0457, -0.3297,  0.0227],
         ...,
         [ 0.9837,  0.4858,  0.4534],
         [ 1.0299,  0.8196,  0.5178],
         [ 1.0630,  1.0654,  0.5752]],

        [[ 0.7113,  1.2972,  0.3972],
         [ 0.9885,  1.4360,  0.6015],
         [ 1.1002,  1.1955,  0.7029],
         ...,
         [ 0.6692, -0.2670, -0.0200],
         [ 0.6757, -0.2293, -0.0086],
         [ 0.6796, -0.2683, -0.0017]],

        [[-0.6103, -0.3610, -0.1874],
         [-0.8462, -0.5043, -0.2983],
         [-0.9284, -0.5591, -0.3726],
         ...,
         [-0.3146, -0.5928, -0.6407],
         [-0.2702, -0.5929, -0.6281],
         [-0.2407, -0.5929, -0.6207]]], grad_fn=&lt;SqueezeBackward1&gt;), std=tensor([[[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]],

        [[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]],

        [[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]],

        ...,

        [[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]],

        [[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]],

        [[1.1756, 1.1756, 1.1756],
         [1.1990, 1.1990, 1.1990],
         [1.2024, 1.2024, 1.2024],
         ...,
         [1.2045, 1.2045, 1.2045],
         [1.2133, 1.2133, 1.2133],
         [1.2720, 1.2720, 1.2720]]], grad_fn=&lt;SqrtBackward0&gt;))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(pred), <span class="bu">type</span>(pred_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(__main__.NormalsParams, __main__.NormalsParams)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>test_ne(pred, pred_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loss-function" class="level3">
<h3 class="anchored" data-anchor-id="loss-function">Loss Function</h3>
<p>add support for complete loss (also outside gap) and for filter loss (dont run the smooher)</p>
<p>There are two ways to compute the loss, one is to do it for all predictions the other is for doing it for only the gap - only_gap</p>
<p>Play around with flatting + diagonal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> torch.diag(torch.tensor([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]))</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> torch.stack([a, a<span class="op">*</span><span class="dv">10</span>])</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> torch.stack([a.diag(), a.diag()<span class="op">*</span><span class="dv">10</span>])</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[ 1,  0,  0],
         [ 0,  2,  0],
         [ 0,  0,  3]],

        [[10,  0,  0],
         [ 0, 20,  0],
         [ 0,  0, 30]]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>m.flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ 1,  2,  3, 10, 20, 30])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[ 1,  0,  0],
         [ 0,  2,  0],
         [ 0,  0,  3]],

        [[10,  0,  0],
         [ 0, 20,  0],
         [ 0,  0, 30]]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>torch.diagonal(d, dim1<span class="op">=</span><span class="dv">1</span>, dim2<span class="op">=</span><span class="dv">2</span>).flatten()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ 1,  2,  3, 10, 20, 30])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>means, stds <span class="op">=</span> pred</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>data, mask <span class="op">=</span> target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a big matrix with all variables and observations and compute ll</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> mask.flatten() </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>obs <span class="op">=</span> data.flatten()[mask]</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> data.flatten()[mask]</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>stds <span class="op">=</span> stds.flatten()[mask] <span class="co"># need to support batches</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>MultivariateNormal(means, torch.diag(stds)).log_prob(obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-5930.4453, grad_fn=&lt;SubBackward0&gt;)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L370" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="kalmanloss" class="level3">
<h3 class="anchored" data-anchor-id="kalmanloss">KalmanLoss</h3>
<blockquote class="blockquote">
<pre><code> KalmanLoss (only_gap:bool=True, reduction:str='sum')</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>only_gap</td>
<td>bool</td>
<td>True</td>
<td>loss for all predictions or only gap</td>
</tr>
<tr class="even">
<td>reduction</td>
<td>str</td>
<td>sum</td>
<td>one of [sum, mean, none]</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>data, mask <span class="op">=</span> <span class="bu">input</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>data.shape, mask.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([10, 200, 3]), torch.Size([10, 200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>pred.mean.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>means, stds <span class="op">=</span> pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>stds.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>means.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>data.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>mask.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>means.isnan().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(False)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>stds.isnan().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>stds.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>is_posdef_eigv(torch.diag(stds.flatten()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(tensor(True),
 tensor([1.4142, 1.4142, 1.4142,  ..., 3.5522, 3.5522, 3.5522],
        grad_fn=&lt;LinalgEighBackward0&gt;))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">True</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-9803.1621, grad_fn=&lt;SumBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-10169.9268, grad_fn=&lt;SumBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>pred.mean.device, target[<span class="dv">0</span>].device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(device(type='cpu'), device(type='cpu'))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>pred.mean.shape, target[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([10, 200, 3]), torch.Size([10, 200, 3]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>target[<span class="dv">0</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([10, 200, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>, reduction<span class="op">=</span><span class="st">'mean'</span>)(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-1016.9927, grad_fn=&lt;MeanBackward0&gt;)</code></pre>
</div>
</div>
</section>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics">Metrics</h3>
<p>Wrapper around fastai metrics to support masked tensors and normal distributions</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L399" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="to_msk_metric" class="level3">
<h3 class="anchored" data-anchor-id="to_msk_metric">to_msk_metric</h3>
<blockquote class="blockquote">
<pre><code> to_msk_metric (metric, name)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>msk_rmse.<span class="va">__name__</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'rmse'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>msk_rmse(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>TensorBase(0.8943)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>msk_r2(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>-1.0734230220457226</code></pre>
</div>
</div>
</section>
<section id="callback" class="level3">
<h3 class="anchored" data-anchor-id="callback">Callback</h3>
<p>save the model state</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L428" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="saveparams" class="level3">
<h3 class="anchored" data-anchor-id="saveparams">SaveParams</h3>
<blockquote class="blockquote">
<pre><code> SaveParams (param_name)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L428" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="saveparams-1" class="level3">
<h3 class="anchored" data-anchor-id="saveparams-1">SaveParams</h3>
<blockquote class="blockquote">
<pre><code> SaveParams (param_name)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>debug_preds <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DebugPredCallback(Callback):</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> after_validate(<span class="va">self</span>):</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">'gather_preds'</span>):</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>            debug_preds.append(<span class="va">self</span>.gather_preds.preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="learner" class="level3">
<h3 class="anchored" data-anchor-id="learner">Learner</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>obs_cov_history <span class="op">=</span> SaveParams(<span class="st">'obs_cov'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> CollectDataCallback()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> KalmanFilter.init_random(n_dim_obs <span class="op">=</span> hai.shape[<span class="dv">1</span>], n_dim_state <span class="op">=</span> hai.shape[<span class="dv">1</span>]).cuda()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>model.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model._set_constraint('obs_cov', model.obs_cov, train=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>pipeline, block_ids <span class="op">=</span> imp_pipeline(hai[:<span class="dv">20000</span>], block_len, gap_len)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> RandomSplitter()(block_ids)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> Datasets(block_ids, [pipeline, pipeline], splits<span class="op">=</span>splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>dls <span class="op">=</span> ds.dataloaders(bs<span class="op">=</span><span class="dv">10</span>, device<span class="op">=</span><span class="st">'cuda'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>dls.one_batch()[<span class="dv">0</span>][<span class="dv">0</span>].device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>device(type='cuda', index=0)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span>, target <span class="op">=</span> dls.one_batch()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(<span class="bu">input</span>)</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>KalmanLoss()(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-1169.3524, device='cuda:0', grad_fn=&lt;SumBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>learn <span class="op">=</span> Learner(dls, model, loss_func<span class="op">=</span>KalmanLoss(only_gap<span class="op">=</span><span class="va">False</span>), cbs <span class="op">=</span> [DebugPredCallback] , metrics <span class="op">=</span> [msk_rmse, msk_r2])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>learn.fit(<span class="dv">1</span>, <span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>rmse</th>
      <th>r2</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-353099.156250</td>
      <td>-378935.593750</td>
      <td>90.621750</td>
      <td>-11517.867397</td>
      <td>00:08</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<section id="float64" class="level4">
<h4 class="anchored" data-anchor-id="float64">Float64</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>model64 <span class="op">=</span> KalmanFilter.init_random(hai.shape[<span class="dv">1</span>], hai.shape[<span class="dv">1</span>], dtype<span class="op">=</span>torch.float64).cuda()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L447" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="float64callback" class="level3">
<h3 class="anchored" data-anchor-id="float64callback">Float64Callback</h3>
<blockquote class="blockquote">
<pre><code> Float64Callback (after_create=None, before_fit=None, before_epoch=None,
                  before_train=None, before_batch=None, after_pred=None,
                  after_loss=None, before_backward=None,
                  after_cancel_backward=None, after_backward=None,
                  before_step=None, after_cancel_step=None,
                  after_step=None, after_cancel_batch=None,
                  after_batch=None, after_cancel_train=None,
                  after_train=None, before_validate=None,
                  after_cancel_validate=None, after_validate=None,
                  after_cancel_epoch=None, after_epoch=None,
                  after_cancel_fit=None, after_fit=None)</code></pre>
</blockquote>
<p>Basic class handling tweaks of the training loop by changing a <code>Learner</code> in various events</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>dls64 <span class="op">=</span> make_dataloader(hai64, <span class="dv">10</span>, <span class="dv">2</span>, bs<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>input64 <span class="op">=</span> dls64.one_batch()[<span class="dv">0</span>]</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>target64 <span class="op">=</span> dls64.one_batch()[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>data64, mask64 <span class="op">=</span> input64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>data64.device, data64.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(device(type='cuda', index=0), torch.float64)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>model64.predict(data64)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model64(<span class="bu">input</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>KalmanLoss()(pred, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor(-337.5005, device='cuda:0', grad_fn=&lt;SumBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>model64.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>learn64 <span class="op">=</span> Learner(dls64, model64, loss_func<span class="op">=</span>KalmanLoss(), cbs <span class="op">=</span> [Float64Callback] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>learn64.fit(<span class="dv">1</span>, <span class="fl">1e-3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>-475756578.212976</td>
      <td>-503224307.875564</td>
      <td>01:33</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</section>
<section id="predictions" class="level3">
<h3 class="anchored" data-anchor-id="predictions">Predictions</h3>
<p>The transformation pipeline is not working properly (there is a problem in <code>decode_batch</code> as the <code>_types</code> are more nested than the predictions, which results in an error) + the pipeline is anyway not reproducible + the test dataloaders seems that they are actually not deterministic .. soo reimplement everything almost from scratch</p>
<p>see https://github.com/mone27/meteo_imp/blob/0335003405ec9bd3e3bd2641bc6d7924f34a0788/lib_nbs/kalman/10_fastai.ipynb for all details</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L453" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="normalsdf" class="level3">
<h3 class="anchored" data-anchor-id="normalsdf">NormalsDf</h3>
<blockquote class="blockquote">
<pre><code> NormalsDf (mean, std)</code></pre>
</blockquote>
<p>DataFrames of Normal parameters (mean and std)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>pipe0, pipe1 <span class="op">=</span> tfms4.fs[<span class="dv">0</span>,<span class="dv">1</span>], tfms4.fs[<span class="dv">2</span>,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>pipe0, pipe1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((#2) [BlockDfTransform:
encodes: (int,object) -&gt; encodes
decodes: ,AddGapTransform:
encodes: (DataFrame,object) -&gt; encodes
decodes: ],
 (#2) [MaskedDf2Tensor:
encodes: (MaskedDf,object) -&gt; encodes
decodes: (MaskedTensor,object) -&gt; decodes
,NormalizeMasked -- {'mean': tensor([  8.3339, 120.9578,   3.3807]), 'std': tensor([  7.9246, 204.0026,   4.3684])}:
encodes: (MaskedTensor,object) -&gt; encodes
decodes: (MaskedTensor,object) -&gt; decodes
(NormalsParams,object) -&gt; decodes
])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L464" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="preds2df" class="level3">
<h3 class="anchored" data-anchor-id="preds2df">preds2df</h3>
<blockquote class="blockquote">
<pre><code> preds2df (preds, targs)</code></pre>
</blockquote>
<p>Final step to decode preds by getting a dataframe</p>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L476" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="predict_items" class="level3">
<h3 class="anchored" data-anchor-id="predict_items">predict_items</h3>
<blockquote class="blockquote">
<pre><code> predict_items (items, learn, pipe0, pipe1)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>preds, targs, losses <span class="op">=</span> predict_items([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">3</span>], learn, pipe0, pipe1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>this is the same data!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>predict_items([<span class="dv">0</span>], learn, pipe0, pipe1)[<span class="dv">1</span>][<span class="dv">0</span>].data <span class="op">==</span> predict_items([<span class="dv">0</span>], learn, pipe0, pipe1)[<span class="dv">1</span>][<span class="dv">0</span>].data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TA</th>
      <th>SW_IN</th>
      <th>VPD</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01 00:30:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 01:00:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 01:30:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 02:00:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 02:30:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 03:00:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 03:30:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 04:00:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 04:30:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2000-01-01 05:00:00</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="plot-results" class="level4">
<h4 class="anchored" data-anchor-id="plot-results">Plot results</h4>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L493" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="plot_result" class="level3">
<h3 class="anchored" data-anchor-id="plot_result">plot_result</h3>
<blockquote class="blockquote">
<pre><code> plot_result (pred, targ, loss, **kwargs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="st">"mean"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>plot_result(preds[<span class="dv">0</span>], targs[<span class="dv">0</span>], torch.tensor(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mean
mean
mean</code></pre>
</div>
<div class="cell-output cell-output-display">

<div id="altair-viz-0c0e7f4c5f54464ebca75d910372a759"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0c0e7f4c5f54464ebca75d910372a759") {
      outputDiv = document.getElementById("altair-viz-0c0e7f4c5f54464ebca75d910372a759");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_49"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_50"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "data": {"name": "data-e589b2563ad823fbfbc71bba13fc388d"}, "height": 150, "title": "SW_IN", "width": 200}, {"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_51"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "mean", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "data": {"name": "data-421b342817acd21dae4b0f3de3bbb562"}, "height": 150, "title": "VPD", "width": 200}]}], "data": {"name": "data-0b7c18246d66731c1f30e1f648a99378"}, "params": [{"name": "param_81", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_49", "view_50", "view_51"]}], "title": "loss: 1.000000", "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-0b7c18246d66731c1f30e1f648a99378": [{"time": "2000-01-01T00:30:00", "variable": "TA", "value": -0.6000000238418579, "is_present": true, "mean": 20.781414031982422, "std": 9.719761848449707, "err_low": 1.3418903350830078, "err_high": 40.22093963623047}, {"time": "2000-01-01T01:00:00", "variable": "TA", "value": -0.6499999761581421, "is_present": true, "mean": -148.38612365722656, "std": 10.596948623657227, "err_low": -169.58001708984375, "err_high": -127.19223022460938}, {"time": "2000-01-01T01:30:00", "variable": "TA", "value": -0.5799999833106995, "is_present": true, "mean": -273.6077880859375, "std": 9.939826965332031, "err_low": -293.4874267578125, "err_high": -253.72813415527344}, {"time": "2000-01-01T02:00:00", "variable": "TA", "value": -0.5099999904632568, "is_present": true, "mean": -287.93475341796875, "std": 9.94400405883789, "err_low": -307.82275390625, "err_high": -268.0467529296875}, {"time": "2000-01-01T02:30:00", "variable": "TA", "value": -0.49000000953674316, "is_present": true, "mean": -293.3094177246094, "std": 9.937422752380371, "err_low": -313.18426513671875, "err_high": -273.4345703125}, {"time": "2000-01-01T03:00:00", "variable": "TA", "value": -0.4000000059604645, "is_present": true, "mean": -293.699462890625, "std": 9.934409141540527, "err_low": -313.5682678222656, "err_high": -273.8306579589844}, {"time": "2000-01-01T03:30:00", "variable": "TA", "value": -0.36000001430511475, "is_present": false, "mean": -293.31671142578125, "std": 9.939554214477539, "err_low": -313.1958312988281, "err_high": -273.4375915527344}, {"time": "2000-01-01T04:00:00", "variable": "TA", "value": -0.3499999940395355, "is_present": false, "mean": -567.5921630859375, "std": 14.97175121307373, "err_low": -597.53564453125, "err_high": -537.648681640625}, {"time": "2000-01-01T04:30:00", "variable": "TA", "value": -0.2800000011920929, "is_present": true, "mean": -1093.8115234375, "std": 26.180858612060547, "err_low": -1146.1732177734375, "err_high": -1041.4498291015625}, {"time": "2000-01-01T05:00:00", "variable": "TA", "value": -0.27000001072883606, "is_present": true, "mean": -264.1253662109375, "std": 10.60876178741455, "err_low": -285.3428955078125, "err_high": -242.9078369140625}], "data-e589b2563ad823fbfbc71bba13fc388d": [{"time": "2000-01-01T00:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 463.0891418457031, "std": 416.4496154785156, "err_low": -369.8100891113281, "err_high": 1295.9884033203125}, {"time": "2000-01-01T01:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -7233.91650390625, "std": 486.5350646972656, "err_low": -8206.986328125, "err_high": -6260.84619140625}, {"time": "2000-01-01T01:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12224.35546875, "std": 464.7389831542969, "err_low": -13153.8330078125, "err_high": -11294.8779296875}, {"time": "2000-01-01T02:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12870.408203125, "std": 464.8800354003906, "err_low": -13800.16796875, "err_high": -11940.6484375}, {"time": "2000-01-01T02:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13080.51171875, "std": 464.6015625, "err_low": -14009.71484375, "err_high": -12151.30859375}, {"time": "2000-01-01T03:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13101.55859375, "std": 464.5009765625, "err_low": -14030.560546875, "err_high": -12172.556640625}, {"time": "2000-01-01T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -13083.484375, "std": 464.73858642578125, "err_low": -14012.9619140625, "err_high": -12154.0068359375}, {"time": "2000-01-01T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -25189.212890625, "std": 678.0774536132812, "err_low": -26545.3671875, "err_high": -23833.05859375}, {"time": "2000-01-01T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -47789.1015625, "std": 1145.0150146484375, "err_low": -50079.1328125, "err_high": -45499.0703125}, {"time": "2000-01-01T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11873.794921875, "std": 488.07257080078125, "err_low": -12849.9404296875, "err_high": -10897.6494140625}], "data-421b342817acd21dae4b0f3de3bbb562": [{"time": "2000-01-01T00:30:00", "variable": "VPD", "value": 0.22200000286102295, "is_present": true, "mean": 13.352357864379883, "std": 9.839052200317383, "err_low": -6.325746536254883, "err_high": 33.03046417236328}, {"time": "2000-01-01T01:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -168.601318359375, "std": 11.87657642364502, "err_low": -192.35447692871094, "err_high": -144.84815979003906}, {"time": "2000-01-01T01:30:00", "variable": "VPD", "value": 0.09000000357627869, "is_present": true, "mean": -283.6062316894531, "std": 11.407477378845215, "err_low": -306.4211730957031, "err_high": -260.7912902832031}, {"time": "2000-01-01T02:00:00", "variable": "VPD", "value": 0.10999999940395355, "is_present": true, "mean": -298.9312744140625, "std": 11.410417556762695, "err_low": -321.7521057128906, "err_high": -276.1104431152344}, {"time": "2000-01-01T02:30:00", "variable": "VPD", "value": 0.10199999809265137, "is_present": true, "mean": -303.7626037597656, "std": 11.404163360595703, "err_low": -326.5709228515625, "err_high": -280.95428466796875}, {"time": "2000-01-01T03:00:00", "variable": "VPD", "value": 0.11100000143051147, "is_present": true, "mean": -304.2798156738281, "std": 11.401996612548828, "err_low": -327.08380126953125, "err_high": -281.475830078125}, {"time": "2000-01-01T03:30:00", "variable": "VPD", "value": 0.10899999737739563, "is_present": true, "mean": -303.85162353515625, "std": 11.407413482666016, "err_low": -326.66644287109375, "err_high": -281.03680419921875}, {"time": "2000-01-01T04:00:00", "variable": "VPD", "value": 0.10700000077486038, "is_present": true, "mean": -587.7825317382812, "std": 16.254329681396484, "err_low": -620.2911987304688, "err_high": -555.2738647460938}, {"time": "2000-01-01T04:30:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -1115.6263427734375, "std": 26.99294662475586, "err_low": -1169.6121826171875, "err_high": -1061.6405029296875}, {"time": "2000-01-01T05:00:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": -275.7076721191406, "std": 11.916023254394531, "err_low": -299.53973388671875, "err_high": -251.87562561035156}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L499" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_results" class="level3">
<h3 class="anchored" data-anchor-id="plot_results">plot_results</h3>
<blockquote class="blockquote">
<pre><code> plot_results (preds, targs, losses, **kwargs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>plot_results(preds, targs, losses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-4ead3a2ab2314794b5ca2c7e555933b6"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-4ead3a2ab2314794b5ca2c7e555933b6") {
      outputDiv = document.getElementById("altair-viz-4ead3a2ab2314794b5ca2c7e555933b6");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_12"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-e11fe8c7dc4cf48be10fcbc63ccfee83"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_13"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-caad5ec239b52c33a75311f5d3cc9016"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_14"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-5ccf27e1f8aa90cec49f0e620cea071d"}}], "title": "loss: -33192.714844"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_15"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-b65c3c5074e05a1718d48e2e3d5251e2"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_16"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-f039c35dc81af8d86e658157cb3c963c"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_17"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-ab3a1c03f22b2d4832051b4ea25ed2db"}}], "title": "loss: -31364.097656"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_18"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-b66e3de69699c9a588f5026ca11e39ef"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_19"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-0f380efcac7ab6e99b9dd7c0d22e4032"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_20"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-7156d1132522e477dcf3dbb7c1b84b39"}}], "title": "loss: -17224.687500"}], "params": [{"name": "param_20", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_12", "view_13", "view_14"]}, {"name": "param_24", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_15", "view_16", "view_17"]}, {"name": "param_28", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_18", "view_19", "view_20"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-e11fe8c7dc4cf48be10fcbc63ccfee83": [{"time": "2000-01-01T00:30:00", "variable": "TA", "value": -0.6000000238418579, "is_present": true, "mean": 20.781414031982422, "std": 9.719761848449707, "err_low": -20.03952407836914, "err_high": 18.839523315429688}, {"time": "2000-01-01T01:00:00", "variable": "TA", "value": -0.6499999761581421, "is_present": true, "mean": -148.38612365722656, "std": 10.596948623657227, "err_low": -21.843896865844727, "err_high": 20.54389762878418}, {"time": "2000-01-01T01:30:00", "variable": "TA", "value": -0.5799999833106995, "is_present": true, "mean": -273.6077880859375, "std": 9.939826965332031, "err_low": -20.459653854370117, "err_high": 19.299654006958008}, {"time": "2000-01-01T02:00:00", "variable": "TA", "value": -0.5099999904632568, "is_present": true, "mean": -287.93475341796875, "std": 9.94400405883789, "err_low": -20.398008346557617, "err_high": 19.378007888793945}, {"time": "2000-01-01T02:30:00", "variable": "TA", "value": -0.49000000953674316, "is_present": true, "mean": -293.3094177246094, "std": 9.937422752380371, "err_low": -20.364845275878906, "err_high": 19.384845733642578}, {"time": "2000-01-01T03:00:00", "variable": "TA", "value": -0.4000000059604645, "is_present": true, "mean": -293.699462890625, "std": 9.934409141540527, "err_low": -20.268817901611328, "err_high": 19.46881866455078}, {"time": "2000-01-01T03:30:00", "variable": "TA", "value": -0.36000001430511475, "is_present": false, "mean": -293.31671142578125, "std": 9.939554214477539, "err_low": -20.23910903930664, "err_high": 19.519107818603516}, {"time": "2000-01-01T04:00:00", "variable": "TA", "value": -0.3499999940395355, "is_present": false, "mean": -567.5921630859375, "std": 14.97175121307373, "err_low": -30.293502807617188, "err_high": 29.593502044677734}, {"time": "2000-01-01T04:30:00", "variable": "TA", "value": -0.2800000011920929, "is_present": true, "mean": -1093.8115234375, "std": 26.180858612060547, "err_low": -52.64171600341797, "err_high": 52.08171844482422}, {"time": "2000-01-01T05:00:00", "variable": "TA", "value": -0.27000001072883606, "is_present": true, "mean": -264.1253662109375, "std": 10.60876178741455, "err_low": -21.487524032592773, "err_high": 20.94752311706543}], "data-caad5ec239b52c33a75311f5d3cc9016": [{"time": "2000-01-01T00:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 463.0891418457031, "std": 416.4496154785156, "err_low": -832.8992309570312, "err_high": 832.8992309570312}, {"time": "2000-01-01T01:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -7233.91650390625, "std": 486.5350646972656, "err_low": -973.0701293945312, "err_high": 973.0701293945312}, {"time": "2000-01-01T01:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12224.35546875, "std": 464.7389831542969, "err_low": -929.4779663085938, "err_high": 929.4779663085938}, {"time": "2000-01-01T02:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12870.408203125, "std": 464.8800354003906, "err_low": -929.7600708007812, "err_high": 929.7600708007812}, {"time": "2000-01-01T02:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13080.51171875, "std": 464.6015625, "err_low": -929.203125, "err_high": 929.203125}, {"time": "2000-01-01T03:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13101.55859375, "std": 464.5009765625, "err_low": -929.001953125, "err_high": 929.001953125}, {"time": "2000-01-01T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -13083.484375, "std": 464.73858642578125, "err_low": -929.4771728515625, "err_high": 929.4771728515625}, {"time": "2000-01-01T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -25189.212890625, "std": 678.0774536132812, "err_low": -1356.1549072265625, "err_high": 1356.1549072265625}, {"time": "2000-01-01T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -47789.1015625, "std": 1145.0150146484375, "err_low": -2290.030029296875, "err_high": 2290.030029296875}, {"time": "2000-01-01T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11873.794921875, "std": 488.07257080078125, "err_low": -976.1451416015625, "err_high": 976.1451416015625}], "data-5ccf27e1f8aa90cec49f0e620cea071d": [{"time": "2000-01-01T00:30:00", "variable": "VPD", "value": 0.22200000286102295, "is_present": true, "mean": 13.352357864379883, "std": 9.839052200317383, "err_low": -19.456104278564453, "err_high": 19.900104522705078}, {"time": "2000-01-01T01:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -168.601318359375, "std": 11.87657642364502, "err_low": -23.631153106689453, "err_high": 23.875152587890625}, {"time": "2000-01-01T01:30:00", "variable": "VPD", "value": 0.09000000357627869, "is_present": true, "mean": -283.6062316894531, "std": 11.407477378845215, "err_low": -22.72495460510254, "err_high": 22.90495491027832}, {"time": "2000-01-01T02:00:00", "variable": "VPD", "value": 0.10999999940395355, "is_present": true, "mean": -298.9312744140625, "std": 11.410417556762695, "err_low": -22.710834503173828, "err_high": 22.930835723876953}, {"time": "2000-01-01T02:30:00", "variable": "VPD", "value": 0.10199999809265137, "is_present": true, "mean": -303.7626037597656, "std": 11.404163360595703, "err_low": -22.706327438354492, "err_high": 22.91032600402832}, {"time": "2000-01-01T03:00:00", "variable": "VPD", "value": 0.11100000143051147, "is_present": true, "mean": -304.2798156738281, "std": 11.401996612548828, "err_low": -22.6929931640625, "err_high": 22.914993286132812}, {"time": "2000-01-01T03:30:00", "variable": "VPD", "value": 0.10899999737739563, "is_present": true, "mean": -303.85162353515625, "std": 11.407413482666016, "err_low": -22.705827713012695, "err_high": 22.923826217651367}, {"time": "2000-01-01T04:00:00", "variable": "VPD", "value": 0.10700000077486038, "is_present": true, "mean": -587.7825317382812, "std": 16.254329681396484, "err_low": -32.40166091918945, "err_high": 32.615657806396484}, {"time": "2000-01-01T04:30:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -1115.6263427734375, "std": 26.99294662475586, "err_low": -53.8638916015625, "err_high": 54.10789489746094}, {"time": "2000-01-01T05:00:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": -275.7076721191406, "std": 11.916023254394531, "err_low": -23.694046020507812, "err_high": 23.970046997070312}], "data-b65c3c5074e05a1718d48e2e3d5251e2": [{"time": "2000-01-01T05:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": 20.781414031982422, "std": 9.719761848449707, "err_low": -19.669523239135742, "err_high": 19.209524154663086}, {"time": "2000-01-01T06:00:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": -146.904296875, "std": 10.596948623657227, "err_low": -21.42389678955078, "err_high": 20.963897705078125}, {"time": "2000-01-01T06:30:00", "variable": "TA", "value": -0.2199999988079071, "is_present": true, "mean": -268.1272277832031, "std": 9.939826965332031, "err_low": -20.099653244018555, "err_high": 19.65965461730957}, {"time": "2000-01-01T07:00:00", "variable": "TA", "value": -0.23999999463558197, "is_present": false, "mean": -280.949951171875, "std": 9.94400405883789, "err_low": -20.128007888793945, "err_high": 19.648008346557617}, {"time": "2000-01-01T07:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": false, "mean": -544.4052734375, "std": 14.981888771057129, "err_low": -30.193777084350586, "err_high": 29.73377799987793}, {"time": "2000-01-01T08:00:00", "variable": "TA", "value": -0.2199999988079071, "is_present": true, "mean": -1049.3887939453125, "std": 26.20234489440918, "err_low": -52.624691009521484, "err_high": 52.184688568115234}, {"time": "2000-01-01T08:30:00", "variable": "TA", "value": -0.1899999976158142, "is_present": true, "mean": -267.2822265625, "std": 10.613080024719238, "err_low": -21.416160583496094, "err_high": 21.03615951538086}, {"time": "2000-01-01T09:00:00", "variable": "TA", "value": -0.14000000059604645, "is_present": true, "mean": -281.9591979980469, "std": 9.976262092590332, "err_low": -20.0925235748291, "err_high": 19.812524795532227}, {"time": "2000-01-01T09:30:00", "variable": "TA", "value": -0.029999999329447746, "is_present": true, "mean": -291.3287658691406, "std": 9.944252967834473, "err_low": -19.918506622314453, "err_high": 19.858505249023438}, {"time": "2000-01-01T10:00:00", "variable": "TA", "value": 0.03999999910593033, "is_present": true, "mean": -297.40478515625, "std": 9.93850326538086, "err_low": -19.837005615234375, "err_high": 19.917007446289062}], "data-f039c35dc81af8d86e658157cb3c963c": [{"time": "2000-01-01T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 463.0891418457031, "std": 416.4496154785156, "err_low": -832.8992309570312, "err_high": 832.8992309570312}, {"time": "2000-01-01T06:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -7165.994140625, "std": 486.5350646972656, "err_low": -973.0701293945312, "err_high": 973.0701293945312}, {"time": "2000-01-01T06:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11983.4892578125, "std": 464.7389831542969, "err_low": -929.4779663085938, "err_high": 929.4779663085938}, {"time": "2000-01-01T07:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -12571.7646484375, "std": 464.8800354003906, "err_low": -929.7600708007812, "err_high": 929.7600708007812}, {"time": "2000-01-01T07:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -24164.6796875, "std": 678.5303955078125, "err_low": -1357.060791015625, "err_high": 1357.060791015625}, {"time": "2000-01-01T08:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -45879.0234375, "std": 1145.9112548828125, "err_low": -2291.822509765625, "err_high": 2291.822509765625}, {"time": "2000-01-01T08:30:00", "variable": "SW_IN", "value": 0.44999998807907104, "is_present": true, "mean": -12012.423828125, "std": 488.5043640136719, "err_low": -976.5587158203125, "err_high": 977.458740234375}, {"time": "2000-01-01T09:00:00", "variable": "SW_IN", "value": 3.700000047683716, "is_present": true, "mean": -12593.779296875, "std": 465.9860534667969, "err_low": -928.2720947265625, "err_high": 935.672119140625}, {"time": "2000-01-01T09:30:00", "variable": "SW_IN", "value": 7.260000228881836, "is_present": true, "mean": -13009.8515625, "std": 464.9170837402344, "err_low": -922.5741577148438, "err_high": 937.0941772460938}, {"time": "2000-01-01T10:00:00", "variable": "SW_IN", "value": 12.239999771118164, "is_present": true, "mean": -13263.9130859375, "std": 464.6466064453125, "err_low": -917.05322265625, "err_high": 941.533203125}], "data-ab3a1c03f22b2d4832051b4ea25ed2db": [{"time": "2000-01-01T05:30:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 13.352357864379883, "std": 9.839052200317383, "err_low": -19.540103912353516, "err_high": 19.816104888916016}, {"time": "2000-01-01T06:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -166.9966278076172, "std": 11.87657642364502, "err_low": -23.631153106689453, "err_high": 23.875152587890625}, {"time": "2000-01-01T06:30:00", "variable": "VPD", "value": 0.09799999743700027, "is_present": true, "mean": -277.95623779296875, "std": 11.407477378845215, "err_low": -22.716955184936523, "err_high": 22.912954330444336}, {"time": "2000-01-01T07:00:00", "variable": "VPD", "value": 0.06599999964237213, "is_present": true, "mean": -291.95892333984375, "std": 11.410417556762695, "err_low": -22.75483512878418, "err_high": 22.8868350982666}, {"time": "2000-01-01T07:30:00", "variable": "VPD", "value": 0.04399999976158142, "is_present": true, "mean": -563.7301635742188, "std": 16.264806747436523, "err_low": -32.48561477661133, "err_high": 32.573612213134766}, {"time": "2000-01-01T08:00:00", "variable": "VPD", "value": 0.026000000536441803, "is_present": true, "mean": -1071.0050048828125, "std": 27.013643264770508, "err_low": -54.001285552978516, "err_high": 54.053287506103516}, {"time": "2000-01-01T08:30:00", "variable": "VPD", "value": 0.01600000075995922, "is_present": true, "mean": -278.9546203613281, "std": 11.92660140991211, "err_low": -23.837202072143555, "err_high": 23.869203567504883}, {"time": "2000-01-01T09:00:00", "variable": "VPD", "value": 0.009999999776482582, "is_present": true, "mean": -292.3470153808594, "std": 11.4345121383667, "err_low": -22.859024047851562, "err_high": 22.879024505615234}, {"time": "2000-01-01T09:30:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -302.1646728515625, "std": 11.411365509033203, "err_low": -22.816730499267578, "err_high": 22.828731536865234}, {"time": "2000-01-01T10:00:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -308.080322265625, "std": 11.405182838439941, "err_low": -22.804365158081055, "err_high": 22.81636619567871}], "data-b66e3de69699c9a588f5026ca11e39ef": [{"time": "2000-01-01T15:30:00", "variable": "TA", "value": 0.5199999809265137, "is_present": true, "mean": 20.781414031982422, "std": 9.719761848449707, "err_low": -18.919523239135742, "err_high": 19.959524154663086}, {"time": "2000-01-01T16:00:00", "variable": "TA", "value": 0.5699999928474426, "is_present": false, "mean": -149.2494354248047, "std": 10.596948623657227, "err_low": -20.623897552490234, "err_high": 21.763896942138672}, {"time": "2000-01-01T16:30:00", "variable": "TA", "value": 0.7300000190734863, "is_present": false, "mean": -299.0109558105469, "std": 16.452390670776367, "err_low": -32.174781799316406, "err_high": 33.63478088378906}, {"time": "2000-01-01T17:00:00", "variable": "TA", "value": 0.7699999809265137, "is_present": true, "mean": -578.1576538085938, "std": 29.284324645996094, "err_low": -57.798648834228516, "err_high": 59.33864974975586}, {"time": "2000-01-01T17:30:00", "variable": "TA", "value": 0.8399999737739563, "is_present": true, "mean": -269.2680358886719, "std": 10.551128387451172, "err_low": -20.262256622314453, "err_high": 21.942256927490234}, {"time": "2000-01-01T18:00:00", "variable": "TA", "value": 0.9900000095367432, "is_present": true, "mean": -267.1496887207031, "std": 9.928688049316406, "err_low": -18.86737632751465, "err_high": 20.847375869750977}, {"time": "2000-01-01T18:30:00", "variable": "TA", "value": 1.350000023841858, "is_present": true, "mean": -269.79754638671875, "std": 9.939447402954102, "err_low": -18.528894424438477, "err_high": 21.22889518737793}, {"time": "2000-01-01T19:00:00", "variable": "TA", "value": 1.8600000143051147, "is_present": true, "mean": -267.64031982421875, "std": 9.936251640319824, "err_low": -18.012502670288086, "err_high": 21.73250389099121}, {"time": "2000-01-01T19:30:00", "variable": "TA", "value": 2.009999990463257, "is_present": true, "mean": -260.1736145019531, "std": 9.937599182128906, "err_low": -17.865198135375977, "err_high": 21.88519859313965}, {"time": "2000-01-01T20:00:00", "variable": "TA", "value": 2.069999933242798, "is_present": true, "mean": -254.9087371826172, "std": 9.941226959228516, "err_low": -17.812454223632812, "err_high": 21.95245361328125}], "data-0f380efcac7ab6e99b9dd7c0d22e4032": [{"time": "2000-01-01T15:30:00", "variable": "SW_IN", "value": 8.09000015258789, "is_present": true, "mean": 463.0891418457031, "std": 416.4496154785156, "err_low": -824.8092041015625, "err_high": 840.9892578125}, {"time": "2000-01-01T16:00:00", "variable": "SW_IN", "value": 6.369999885559082, "is_present": false, "mean": -7270.88916015625, "std": 486.5350646972656, "err_low": -966.7001342773438, "err_high": 979.4401245117188}, {"time": "2000-01-01T16:30:00", "variable": "SW_IN", "value": 1.7200000286102295, "is_present": false, "mean": -13226.736328125, "std": 743.8946533203125, "err_low": -1486.0693359375, "err_high": 1489.50927734375}, {"time": "2000-01-01T17:00:00", "variable": "SW_IN", "value": 0.05999999865889549, "is_present": true, "mean": -25680.892578125, "std": 1275.10595703125, "err_low": -2550.15185546875, "err_high": 2550.27197265625}, {"time": "2000-01-01T17:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12004.1953125, "std": 485.33740234375, "err_low": -970.6748046875, "err_high": 970.6748046875}, {"time": "2000-01-01T18:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11956.6103515625, "std": 464.4346923828125, "err_low": -928.869384765625, "err_high": 928.869384765625}, {"time": "2000-01-01T18:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12079.1796875, "std": 464.68402099609375, "err_low": -929.3680419921875, "err_high": 929.3680419921875}, {"time": "2000-01-01T19:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11974.041015625, "std": 464.58056640625, "err_low": -929.1611328125, "err_high": 929.1611328125}, {"time": "2000-01-01T19:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11651.689453125, "std": 464.6243896484375, "err_low": -929.248779296875, "err_high": 929.248779296875}, {"time": "2000-01-01T20:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11432.6416015625, "std": 464.79388427734375, "err_low": -929.5877685546875, "err_high": 929.5877685546875}], "data-7156d1132522e477dcf3dbb7c1b84b39": [{"time": "2000-01-01T15:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": 13.352357864379883, "std": 9.839052200317383, "err_low": -19.678104400634766, "err_high": 19.678104400634766}, {"time": "2000-01-01T16:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -169.46365356445312, "std": 11.87657642364502, "err_low": -23.75315284729004, "err_high": 23.75315284729004}, {"time": "2000-01-01T16:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -306.5470886230469, "std": 17.77806282043457, "err_low": -35.55612564086914, "err_high": 35.55612564086914}, {"time": "2000-01-01T17:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -599.4336547851562, "std": 30.001543045043945, "err_low": -60.00308609008789, "err_high": 60.00308609008789}, {"time": "2000-01-01T17:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -278.3432922363281, "std": 11.853055000305176, "err_low": -23.70611000061035, "err_high": 23.70611000061035}, {"time": "2000-01-01T18:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -277.4642028808594, "std": 11.40123462677002, "err_low": -22.80246925354004, "err_high": 22.80246925354004}, {"time": "2000-01-01T18:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -280.4012756347656, "std": 11.406007766723633, "err_low": -22.812015533447266, "err_high": 22.812015533447266}, {"time": "2000-01-01T19:00:00", "variable": "VPD", "value": 0.0020000000949949026, "is_present": true, "mean": -277.8943786621094, "std": 11.403796195983887, "err_low": -22.805591583251953, "err_high": 22.809593200683594}, {"time": "2000-01-01T19:30:00", "variable": "VPD", "value": 0.008999999612569809, "is_present": true, "mean": -270.360107421875, "std": 11.404725074768066, "err_low": -22.80044937133789, "err_high": 22.818450927734375}, {"time": "2000-01-01T20:00:00", "variable": "VPD", "value": 0.014000000432133675, "is_present": true, "mean": -265.2678527832031, "std": 11.408601760864258, "err_low": -22.803203582763672, "err_high": 22.83120346069336}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<section id="show-results" class="level4">
<h4 class="anchored" data-anchor-id="show-results">Show Results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>random.choices(learn.dls.items, k<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[1046, 462, 1143]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L504" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="get_results" class="level3">
<h3 class="anchored" data-anchor-id="get_results">get_results</h3>
<blockquote class="blockquote">
<pre><code> get_results (learn, n=3, items=None)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/mone27/meteo_imp/blob/master/meteo_imp/kalman/fastai.py#L510" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="show_results" class="level3">
<h3 class="anchored" data-anchor-id="show_results">show_results</h3>
<blockquote class="blockquote">
<pre><code> show_results (learn, n=3, items=None, **kwargs)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>learn.model.use_smooth <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>show_results(learn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-f335f76f71d54d9ba620a04fc7c5a0f5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-f335f76f71d54d9ba620a04fc7c5a0f5") {
      outputDiv = document.getElementById("altair-viz-f335f76f71d54d9ba620a04fc7c5a0f5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_21"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-568ed1d825b771e08180502dcfddd830"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_22"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-7d78aa5c5627c5594016bb44117370a1"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_23"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-896e2614373aecf01fd64cc5ca33e8a3"}}], "title": "loss: -22953.242188"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_24"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-4fe3aa6e1c1f686ada08065a15d6b5a4"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_25"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-cb4f986b4d0d84aeee756ff42aa5e8fb"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_26"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-021ff0bcae535a95d81d31401567b82f"}}], "title": "loss: -290.736786"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_27"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-fa7e333732ec3e737958177687cf8bb4"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_28"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-3ef8eb7092ee71ac238c2f9a55cf1d09"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_29"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-a28bfd3607b1e00a5396ec7a34a7fd2d"}}], "title": "loss: -6750.373535"}], "params": [{"name": "param_32", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_21", "view_22", "view_23"]}, {"name": "param_36", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_24", "view_25", "view_26"]}, {"name": "param_40", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_27", "view_28", "view_29"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-568ed1d825b771e08180502dcfddd830": [{"time": "2000-12-19T03:30:00", "variable": "TA", "value": -0.9399999976158142, "is_present": true, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -18.407020568847656, "err_high": 16.527019500732422}, {"time": "2000-12-19T04:00:00", "variable": "TA", "value": -0.9700000286102295, "is_present": false, "mean": -146.65142822265625, "std": 9.521690368652344, "err_low": -20.01338005065918, "err_high": 18.073381423950195}, {"time": "2000-12-19T04:30:00", "variable": "TA", "value": -0.8199999928474426, "is_present": false, "mean": -293.28424072265625, "std": 14.782987594604492, "err_low": -30.385974884033203, "err_high": 28.745975494384766}, {"time": "2000-12-19T05:00:00", "variable": "TA", "value": -0.5899999737739563, "is_present": true, "mean": -566.5355834960938, "std": 26.312881469726562, "err_low": -53.215763092041016, "err_high": 52.035762786865234}, {"time": "2000-12-19T05:30:00", "variable": "TA", "value": -0.75, "is_present": true, "mean": -272.8945617675781, "std": 9.48051929473877, "err_low": -19.71103858947754, "err_high": 18.21103858947754}, {"time": "2000-12-19T06:00:00", "variable": "TA", "value": -1.0199999809265137, "is_present": true, "mean": -274.63104248046875, "std": 8.921236991882324, "err_low": -18.86247444152832, "err_high": 16.822473526000977}, {"time": "2000-12-19T06:30:00", "variable": "TA", "value": -1.0700000524520874, "is_present": true, "mean": -283.3438415527344, "std": 8.930904388427734, "err_low": -18.931808471679688, "err_high": 16.79180908203125}, {"time": "2000-12-19T07:00:00", "variable": "TA", "value": -1.0299999713897705, "is_present": true, "mean": -288.73992919921875, "std": 8.928032875061035, "err_low": -18.886066436767578, "err_high": 16.826065063476562}, {"time": "2000-12-19T07:30:00", "variable": "TA", "value": -1.0099999904632568, "is_present": true, "mean": -289.6515808105469, "std": 8.929244041442871, "err_low": -18.868488311767578, "err_high": 16.848487854003906}, {"time": "2000-12-19T08:00:00", "variable": "TA", "value": -1.0099999904632568, "is_present": true, "mean": -289.97021484375, "std": 8.932503700256348, "err_low": -18.87500762939453, "err_high": 16.85500717163086}], "data-7d78aa5c5627c5594016bb44117370a1": [{"time": "2000-12-19T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -774.0281372070312, "err_high": 774.0281372070312}, {"time": "2000-12-19T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -7370.93701171875, "std": 452.145751953125, "err_low": -904.29150390625, "err_high": 904.29150390625}, {"time": "2000-12-19T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -13396.279296875, "std": 691.3146362304688, "err_low": -1382.6292724609375, "err_high": 1382.6292724609375}, {"time": "2000-12-19T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -26009.107421875, "std": 1184.978759765625, "err_low": -2369.95751953125, "err_high": 2369.95751953125}, {"time": "2000-12-19T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12552.5244140625, "std": 451.0327453613281, "err_low": -902.0654907226562, "err_high": 902.0654907226562}, {"time": "2000-12-19T06:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12674.62890625, "std": 431.60748291015625, "err_low": -863.2149658203125, "err_high": 863.2149658203125}, {"time": "2000-12-19T06:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13074.0859375, "std": 431.83917236328125, "err_low": -863.6783447265625, "err_high": 863.6783447265625}, {"time": "2000-12-19T07:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13300.8544921875, "std": 431.7430419921875, "err_low": -863.486083984375, "err_high": 863.486083984375}, {"time": "2000-12-19T07:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13340.91796875, "std": 431.78375244140625, "err_low": -863.5675048828125, "err_high": 863.5675048828125}, {"time": "2000-12-19T08:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -13355.7685546875, "std": 431.9412841796875, "err_low": -863.882568359375, "err_high": 863.882568359375}], "data-896e2614373aecf01fd64cc5ca33e8a3": [{"time": "2000-12-19T03:30:00", "variable": "VPD", "value": 0.11999999731779099, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -16.25455093383789, "err_high": 16.494552612304688}, {"time": "2000-12-19T04:00:00", "variable": "VPD", "value": 0.11999999731779099, "is_present": true, "mean": -153.85243225097656, "std": 9.882741928100586, "err_low": -19.645483016967773, "err_high": 19.88548469543457}, {"time": "2000-12-19T04:30:00", "variable": "VPD", "value": 0.11500000208616257, "is_present": true, "mean": -278.00555419921875, "std": 14.793489456176758, "err_low": -29.47197914123535, "err_high": 29.70197868347168}, {"time": "2000-12-19T05:00:00", "variable": "VPD", "value": 0.11699999868869781, "is_present": true, "mean": -543.615234375, "std": 24.96489715576172, "err_low": -49.81279373168945, "err_high": 50.04679489135742}, {"time": "2000-12-19T05:30:00", "variable": "VPD", "value": 0.11599999666213989, "is_present": true, "mean": -260.7052307128906, "std": 9.863168716430664, "err_low": -19.61033821105957, "err_high": 19.842336654663086}, {"time": "2000-12-19T06:00:00", "variable": "VPD", "value": 0.10899999737739563, "is_present": true, "mean": -263.47491455078125, "std": 9.487200736999512, "err_low": -18.865402221679688, "err_high": 19.08340072631836}, {"time": "2000-12-19T06:30:00", "variable": "VPD", "value": 0.10199999809265137, "is_present": true, "mean": -271.9096374511719, "std": 9.491171836853027, "err_low": -18.88034439086914, "err_high": 19.08434295654297}, {"time": "2000-12-19T07:00:00", "variable": "VPD", "value": 0.09799999743700027, "is_present": true, "mean": -276.60797119140625, "std": 9.489331245422363, "err_low": -18.88066291809082, "err_high": 19.076662063598633}, {"time": "2000-12-19T07:30:00", "variable": "VPD", "value": 0.09600000083446503, "is_present": true, "mean": -277.4502258300781, "std": 9.490104675292969, "err_low": -18.88420867919922, "err_high": 19.076210021972656}, {"time": "2000-12-19T08:00:00", "variable": "VPD", "value": 0.09600000083446503, "is_present": true, "mean": -277.76434326171875, "std": 9.493330001831055, "err_low": -18.89065933227539, "err_high": 19.082660675048828}], "data-4fe3aa6e1c1f686ada08065a15d6b5a4": [{"time": "2000-09-28T01:30:00", "variable": "TA", "value": 14.010000228881836, "is_present": true, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -3.457019805908203, "err_high": 31.477020263671875}, {"time": "2000-09-28T02:00:00", "variable": "TA", "value": 14.069999694824219, "is_present": true, "mean": 26.21902084350586, "std": 9.521690368652344, "err_low": -4.973381042480469, "err_high": 33.113380432128906}, {"time": "2000-09-28T02:30:00", "variable": "TA", "value": 14.170000076293945, "is_present": true, "mean": 43.09665298461914, "std": 8.931245803833008, "err_low": -3.6924915313720703, "err_high": 32.032493591308594}, {"time": "2000-09-28T03:00:00", "variable": "TA", "value": 14.0, "is_present": true, "mean": 47.5060920715332, "std": 8.934998512268066, "err_low": -3.869997024536133, "err_high": 31.869997024536133}, {"time": "2000-09-28T03:30:00", "variable": "TA", "value": 13.979999542236328, "is_present": true, "mean": 44.116477966308594, "std": 8.929085731506348, "err_low": -3.878171920776367, "err_high": 31.838171005249023}, {"time": "2000-09-28T04:00:00", "variable": "TA", "value": 13.699999809265137, "is_present": true, "mean": 38.45564651489258, "std": 8.926377296447754, "err_low": -4.152754783630371, "err_high": 31.552753448486328}, {"time": "2000-09-28T04:30:00", "variable": "TA", "value": 13.930000305175781, "is_present": true, "mean": 28.13037109375, "std": 8.931000709533691, "err_low": -3.9320011138916016, "err_high": 31.792001724243164}, {"time": "2000-09-28T05:00:00", "variable": "TA", "value": 13.880000114440918, "is_present": false, "mean": 29.362857818603516, "std": 8.931939125061035, "err_low": -3.9838781356811523, "err_high": 31.743877410888672}, {"time": "2000-09-28T05:30:00", "variable": "TA", "value": 14.010000228881836, "is_present": false, "mean": 45.93040466308594, "std": 13.454289436340332, "err_low": -12.898578643798828, "err_high": 40.9185791015625}, {"time": "2000-09-28T06:00:00", "variable": "TA", "value": 14.039999961853027, "is_present": true, "mean": 77.35734558105469, "std": 23.52825355529785, "err_low": -33.01650619506836, "err_high": 61.09650802612305}], "data-cb4f986b4d0d84aeee756ff42aa5e8fb": [{"time": "2000-09-28T01:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -774.0281372070312, "err_high": 774.0281372070312}, {"time": "2000-09-28T02:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 747.6859130859375, "std": 452.145751953125, "err_low": -904.29150390625, "err_high": 904.29150390625}, {"time": "2000-09-28T02:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 1433.2098388671875, "std": 431.8902587890625, "err_low": -863.780517578125, "err_high": 863.780517578125}, {"time": "2000-09-28T03:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 1643.2039794921875, "std": 432.0213317871094, "err_low": -864.0426635742188, "err_high": 864.0426635742188}, {"time": "2000-09-28T03:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 1469.3602294921875, "std": 431.7625732421875, "err_low": -863.525146484375, "err_high": 863.525146484375}, {"time": "2000-09-28T04:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 1230.7412109375, "std": 431.6690979003906, "err_low": -863.3381958007812, "err_high": 863.3381958007812}, {"time": "2000-09-28T04:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 755.3905029296875, "std": 431.889892578125, "err_low": -863.77978515625, "err_high": 863.77978515625}, {"time": "2000-09-28T05:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 845.1849365234375, "std": 431.89666748046875, "err_low": -863.7933349609375, "err_high": 863.7933349609375}, {"time": "2000-09-28T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": 1569.829345703125, "std": 630.25390625, "err_low": -1260.5078125, "err_high": 1260.5078125}, {"time": "2000-09-28T06:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 2987.352294921875, "std": 1064.2335205078125, "err_low": -2128.467041015625, "err_high": 2128.467041015625}], "data-021ff0bcae535a95d81d31401567b82f": [{"time": "2000-09-28T01:30:00", "variable": "VPD", "value": 1.2319999933242798, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -15.14255142211914, "err_high": 17.606552124023438}, {"time": "2000-09-28T02:00:00", "variable": "VPD", "value": 1.194000005722046, "is_present": true, "mean": 17.600616455078125, "std": 9.882741928100586, "err_low": -18.571483612060547, "err_high": 20.959484100341797}, {"time": "2000-09-28T02:30:00", "variable": "VPD", "value": 1.2890000343322754, "is_present": true, "mean": 31.70066261291504, "std": 9.492395401000977, "err_low": -17.695791244506836, "err_high": 20.27379035949707}, {"time": "2000-09-28T03:00:00", "variable": "VPD", "value": 1.1080000400543213, "is_present": true, "mean": 36.15609359741211, "std": 9.494841575622559, "err_low": -17.881683349609375, "err_high": 20.09768295288086}, {"time": "2000-09-28T03:30:00", "variable": "VPD", "value": 1.059000015258789, "is_present": true, "mean": 32.437896728515625, "std": 9.48963737487793, "err_low": -17.92027473449707, "err_high": 20.03827476501465}, {"time": "2000-09-28T04:00:00", "variable": "VPD", "value": 0.8309999704360962, "is_present": true, "mean": 27.495967864990234, "std": 9.487833976745605, "err_low": -18.144668579101562, "err_high": 19.80666732788086}, {"time": "2000-09-28T04:30:00", "variable": "VPD", "value": 1.0390000343322754, "is_present": true, "mean": 17.489639282226562, "std": 9.492341041564941, "err_low": -17.945682525634766, "err_high": 20.023681640625}, {"time": "2000-09-28T05:00:00", "variable": "VPD", "value": 1.1150000095367432, "is_present": true, "mean": 19.48920249938965, "std": 9.492371559143066, "err_low": -17.86974334716797, "err_high": 20.099742889404297}, {"time": "2000-09-28T05:30:00", "variable": "VPD", "value": 1.2369999885559082, "is_present": true, "mean": 34.58951187133789, "std": 13.527811050415039, "err_low": -25.818622589111328, "err_high": 28.292621612548828}, {"time": "2000-09-28T06:00:00", "variable": "VPD", "value": 1.3309999704360962, "is_present": true, "mean": 64.31781005859375, "std": 22.464420318603516, "err_low": -43.59783935546875, "err_high": 46.25984191894531}], "data-fa7e333732ec3e737958177687cf8bb4": [{"time": "2000-10-17T10:30:00", "variable": "TA", "value": 10.460000038146973, "is_present": false, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -7.007019996643066, "err_high": 27.927021026611328}, {"time": "2000-10-17T11:00:00", "variable": "TA", "value": 10.15999984741211, "is_present": false, "mean": 25.490163803100586, "std": 13.456191062927246, "err_low": -16.752382278442383, "err_high": 37.07238006591797}, {"time": "2000-10-17T11:30:00", "variable": "TA", "value": 10.399999618530273, "is_present": true, "mean": 38.70755386352539, "std": 23.377582550048828, "err_low": -36.35516357421875, "err_high": 57.15516662597656}, {"time": "2000-10-17T12:00:00", "variable": "TA", "value": 10.430000305175781, "is_present": true, "mean": -166.9179229736328, "std": 9.636713027954102, "err_low": -8.843425750732422, "err_high": 29.703426361083984}, {"time": "2000-10-17T12:30:00", "variable": "TA", "value": 10.630000114440918, "is_present": true, "mean": -142.69363403320312, "std": 8.919102668762207, "err_low": -7.208205223083496, "err_high": 28.468204498291016}, {"time": "2000-10-17T13:00:00", "variable": "TA", "value": 10.899999618530273, "is_present": true, "mean": -168.9970245361328, "std": 8.929347038269043, "err_low": -6.9586944580078125, "err_high": 28.75869369506836}, {"time": "2000-10-17T13:30:00", "variable": "TA", "value": 11.15999984741211, "is_present": true, "mean": -220.05067443847656, "std": 8.930416107177734, "err_low": -6.700832366943359, "err_high": 29.020832061767578}, {"time": "2000-10-17T14:00:00", "variable": "TA", "value": 10.8100004196167, "is_present": true, "mean": -209.880859375, "std": 8.930230140686035, "err_low": -7.050459861755371, "err_high": 28.670459747314453}, {"time": "2000-10-17T14:30:00", "variable": "TA", "value": 10.430000305175781, "is_present": true, "mean": -99.95895385742188, "std": 8.926085472106934, "err_low": -7.422170639038086, "err_high": 28.28217124938965}, {"time": "2000-10-17T15:00:00", "variable": "TA", "value": 10.050000190734863, "is_present": true, "mean": -45.56036376953125, "std": 8.925995826721191, "err_low": -7.8019914627075195, "err_high": 27.901992797851562}], "data-3ef8eb7092ee71ac238c2f9a55cf1d09": [{"time": "2000-10-17T10:30:00", "variable": "SW_IN", "value": 238.8800048828125, "is_present": false, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -535.1481323242188, "err_high": 1012.9081420898438}, {"time": "2000-10-17T11:00:00", "variable": "SW_IN", "value": 84.69999694824219, "is_present": false, "mean": 679.3577880859375, "std": 619.5482788085938, "err_low": -1154.3966064453125, "err_high": 1323.7965087890625}, {"time": "2000-10-17T11:30:00", "variable": "SW_IN", "value": 160.47999572753906, "is_present": true, "mean": 1238.1650390625, "std": 1066.5347900390625, "err_low": -1972.589599609375, "err_high": 2293.549560546875}, {"time": "2000-10-17T12:00:00", "variable": "SW_IN", "value": 108.86000061035156, "is_present": true, "mean": -7964.52392578125, "std": 456.6365661621094, "err_low": -804.4131469726562, "err_high": 1022.1331176757812}, {"time": "2000-10-17T12:30:00", "variable": "SW_IN", "value": 193.6300048828125, "is_present": true, "mean": -6687.38427734375, "std": 431.5096740722656, "err_low": -669.3893432617188, "err_high": 1056.6494140625}, {"time": "2000-10-17T13:00:00", "variable": "SW_IN", "value": 222.30999755859375, "is_present": true, "mean": -8117.99951171875, "std": 431.7867126464844, "err_low": -641.263427734375, "err_high": 1085.8834228515625}, {"time": "2000-10-17T13:30:00", "variable": "SW_IN", "value": 207.4600067138672, "is_present": true, "mean": -10252.900390625, "std": 431.84722900390625, "err_low": -656.2344360351562, "err_high": 1071.1544189453125}, {"time": "2000-10-17T14:00:00", "variable": "SW_IN", "value": 59.08000183105469, "is_present": true, "mean": -9763.970703125, "std": 431.8232116699219, "err_low": -804.56640625, "err_high": 922.7264404296875}, {"time": "2000-10-17T14:30:00", "variable": "SW_IN", "value": 58.0, "is_present": true, "mean": -4725.552734375, "std": 431.66204833984375, "err_low": -805.3240966796875, "err_high": 921.3240966796875}, {"time": "2000-10-17T15:00:00", "variable": "SW_IN", "value": 76.61000061035156, "is_present": true, "mean": -2546.42138671875, "std": 431.6522216796875, "err_low": -786.6944580078125, "err_high": 939.9144287109375}], "data-a28bfd3607b1e00a5396ec7a34a7fd2d": [{"time": "2000-10-17T10:30:00", "variable": "VPD", "value": 2.009999990463257, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -14.364551544189453, "err_high": 18.384552001953125}, {"time": "2000-10-17T11:00:00", "variable": "VPD", "value": 1.7719999551773071, "is_present": true, "mean": 16.029443740844727, "std": 13.272482872009277, "err_low": -24.772966384887695, "err_high": 28.316965103149414}, {"time": "2000-10-17T11:30:00", "variable": "VPD", "value": 2.055999994277954, "is_present": true, "mean": 27.611797332763672, "std": 22.5463924407959, "err_low": -43.03678512573242, "err_high": 47.14878463745117}, {"time": "2000-10-17T12:00:00", "variable": "VPD", "value": 2.5160000324249268, "is_present": true, "mean": -165.15402221679688, "std": 9.972493171691895, "err_low": -17.428985595703125, "err_high": 22.460987091064453}, {"time": "2000-10-17T12:30:00", "variable": "VPD", "value": 2.7160000801086426, "is_present": true, "mean": -137.71896362304688, "std": 9.485231399536133, "err_low": -16.25446319580078, "err_high": 21.68646240234375}, {"time": "2000-10-17T13:00:00", "variable": "VPD", "value": 2.986999988555908, "is_present": true, "mean": -168.6394500732422, "std": 9.490166664123535, "err_low": -15.99333381652832, "err_high": 21.96733283996582}, {"time": "2000-10-17T13:30:00", "variable": "VPD", "value": 3.260999917984009, "is_present": true, "mean": -212.779541015625, "std": 9.491427421569824, "err_low": -15.721855163574219, "err_high": 22.243854522705078}, {"time": "2000-10-17T14:00:00", "variable": "VPD", "value": 2.9010000228881836, "is_present": true, "mean": -202.47767639160156, "std": 9.490893363952637, "err_low": -16.080787658691406, "err_high": 21.88278579711914}, {"time": "2000-10-17T14:30:00", "variable": "VPD", "value": 2.436000108718872, "is_present": true, "mean": -96.55625915527344, "std": 9.48771858215332, "err_low": -16.53943634033203, "err_high": 21.41143798828125}, {"time": "2000-10-17T15:00:00", "variable": "VPD", "value": 1.8279999494552612, "is_present": true, "mean": -51.79391860961914, "std": 9.487494468688965, "err_low": -17.146989822387695, "err_high": 20.802988052368164}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>show_results(learn, items<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div id="altair-viz-609169872b48425fac3986752f66d079"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-609169872b48425fac3986752f66d079") {
      outputDiv = document.getElementById("altair-viz-609169872b48425fac3986752f66d079");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@5.2.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.2.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_30"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-98f79dc8cbfed0fcb4cb86a92e20c203"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_31"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-d8f701be62ecbaa96ab224c85aa071c4"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_32"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-28d7af5caba716146ecaac5110e9d337"}}], "title": "loss: -36434.675781"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_33"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-d29e32b90fb51418b8452203fb8d8017"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_34"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-ed57f06386ca5ccb5d8a599f91a087c9"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_35"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-dfbaae86c85027022400ba837d30a3f2"}}], "title": "loss: -44768.039062"}, {"vconcat": [{"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_36"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "TA", "type": "quantitative"}}}]}], "height": 150, "title": "TA", "width": 200}], "data": {"name": "data-520068efbcad15bb1da0bd746350ba85"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_37"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "SW_IN", "type": "quantitative"}}}]}], "height": 150, "title": "SW_IN", "width": 200}], "data": {"name": "data-5c228d5f67448c70676cbacf53603d17"}}, {"hconcat": [{"layer": [{"mark": {"type": "point", "color": "black", "fillOpacity": 1, "strokeWidth": 1}, "encoding": {"fill": {"field": "is_present", "legend": {"title": ["Observed data"]}, "scale": {"range": ["black", "#ffffff00"]}, "type": "nominal"}, "shape": {"field": "is_present", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}, {"layer": [{"mark": "errorband", "encoding": {"color": {"field": "variable", "legend": {"title": ["Line: pred. mean", "area: +/- 2 std"]}, "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "err_low", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}, "y2": {"field": "err_high"}}, "name": "view_38"}, {"mark": "line", "encoding": {"color": {"field": "variable", "type": "nominal"}, "x": {"field": "time", "type": "temporal"}, "y": {"field": "value", "scale": {"zero": false}, "title": "VPD", "type": "quantitative"}}}]}], "height": 150, "title": "VPD", "width": 200}], "data": {"name": "data-1854be0da40e5a2c80f84d802417ef36"}}], "title": "loss: -32573.283203"}], "params": [{"name": "param_44", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_30", "view_31", "view_32"]}, {"name": "param_48", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_33", "view_34", "view_35"]}, {"name": "param_52", "select": {"type": "interval", "encodings": ["x"]}, "bind": "scales", "views": ["view_36", "view_37", "view_38"]}], "$schema": "https://vega.github.io/schema/vega-lite/v5.2.0.json", "datasets": {"data-98f79dc8cbfed0fcb4cb86a92e20c203": [{"time": "2000-01-01T05:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -17.697019577026367, "err_high": 17.23702049255371}, {"time": "2000-01-01T06:00:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": -139.36595153808594, "std": 9.521690368652344, "err_low": -19.273380279541016, "err_high": 18.81338119506836}, {"time": "2000-01-01T06:30:00", "variable": "TA", "value": -0.2199999988079071, "is_present": true, "mean": -254.52972412109375, "std": 8.931245803833008, "err_low": -18.082490921020508, "err_high": 17.642492294311523}, {"time": "2000-01-01T07:00:00", "variable": "TA", "value": -0.23999999463558197, "is_present": true, "mean": -266.790771484375, "std": 8.934998512268066, "err_low": -18.109996795654297, "err_high": 17.62999725341797}, {"time": "2000-01-01T07:30:00", "variable": "TA", "value": -0.23000000417232513, "is_present": true, "mean": -274.20208740234375, "std": 8.929085731506348, "err_low": -18.088171005249023, "err_high": 17.628171920776367}, {"time": "2000-01-01T08:00:00", "variable": "TA", "value": -0.2199999988079071, "is_present": false, "mean": -276.491455078125, "std": 8.926377296447754, "err_low": -18.07275390625, "err_high": 17.632755279541016}, {"time": "2000-01-01T08:30:00", "variable": "TA", "value": -0.1899999976158142, "is_present": false, "mean": -534.961669921875, "std": 13.440957069396973, "err_low": -27.071914672851562, "err_high": 26.691913604736328}, {"time": "2000-01-01T09:00:00", "variable": "TA", "value": -0.14000000059604645, "is_present": true, "mean": -1030.7928466796875, "std": 23.500511169433594, "err_low": -47.141021728515625, "err_high": 46.86102294921875}, {"time": "2000-01-01T09:30:00", "variable": "TA", "value": -0.029999999329447746, "is_present": true, "mean": -258.82342529296875, "std": 9.597160339355469, "err_low": -19.224321365356445, "err_high": 19.16431999206543}, {"time": "2000-01-01T10:00:00", "variable": "TA", "value": 0.03999999910593033, "is_present": true, "mean": -273.7153015136719, "std": 8.969844818115234, "err_low": -17.899688720703125, "err_high": 17.979690551757812}], "data-d8f701be62ecbaa96ab224c85aa071c4": [{"time": "2000-01-01T05:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -774.0281372070312, "err_high": 774.0281372070312}, {"time": "2000-01-01T06:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -7028.5673828125, "std": 452.145751953125, "err_low": -904.29150390625, "err_high": 904.29150390625}, {"time": "2000-01-01T06:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -11762.099609375, "std": 431.8902587890625, "err_low": -863.780517578125, "err_high": 863.780517578125}, {"time": "2000-01-01T07:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12343.6953125, "std": 432.0213317871094, "err_low": -864.0426635742188, "err_high": 864.0426635742188}, {"time": "2000-01-01T07:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12654.9111328125, "std": 431.7625732421875, "err_low": -863.525146484375, "err_high": 863.525146484375}, {"time": "2000-01-01T08:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -12757.625, "std": 431.6690979003906, "err_low": -863.3381958007812, "err_high": 863.3381958007812}, {"time": "2000-01-01T08:30:00", "variable": "SW_IN", "value": 0.44999998807907104, "is_present": false, "mean": -24552.271484375, "std": 629.6784057617188, "err_low": -1258.9068603515625, "err_high": 1259.8067626953125}, {"time": "2000-01-01T09:00:00", "variable": "SW_IN", "value": 3.700000047683716, "is_present": true, "mean": -46580.28125, "std": 1063.006103515625, "err_low": -2122.312255859375, "err_high": 2129.712158203125}, {"time": "2000-01-01T09:30:00", "variable": "SW_IN", "value": 7.260000228881836, "is_present": true, "mean": -12019.619140625, "std": 456.4454650878906, "err_low": -905.6309204101562, "err_high": 920.1509399414062}, {"time": "2000-01-01T10:00:00", "variable": "SW_IN", "value": 12.239999771118164, "is_present": true, "mean": -12632.9560546875, "std": 433.2485656738281, "err_low": -854.2571411132812, "err_high": 878.7371215820312}], "data-28d7af5caba716146ecaac5110e9d337": [{"time": "2000-01-01T05:30:00", "variable": "VPD", "value": 0.1379999965429306, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -16.23655128479004, "err_high": 16.51255226135254}, {"time": "2000-01-01T06:00:00", "variable": "VPD", "value": 0.12200000137090683, "is_present": true, "mean": -146.62127685546875, "std": 9.882741928100586, "err_low": -19.643484115600586, "err_high": 19.887483596801758}, {"time": "2000-01-01T06:30:00", "variable": "VPD", "value": 0.09799999743700027, "is_present": true, "mean": -244.24383544921875, "std": 9.492395401000977, "err_low": -18.886791229248047, "err_high": 19.08279037475586}, {"time": "2000-01-01T07:00:00", "variable": "VPD", "value": 0.06599999964237213, "is_present": true, "mean": -256.6382751464844, "std": 9.494841575622559, "err_low": -18.923683166503906, "err_high": 19.055683135986328}, {"time": "2000-01-01T07:30:00", "variable": "VPD", "value": 0.04399999976158142, "is_present": true, "mean": -263.08642578125, "std": 9.48963737487793, "err_low": -18.935274124145508, "err_high": 19.02327537536621}, {"time": "2000-01-01T08:00:00", "variable": "VPD", "value": 0.026000000536441803, "is_present": true, "mean": -265.2464294433594, "std": 9.487833976745605, "err_low": -18.949668884277344, "err_high": 19.001667022705078}, {"time": "2000-01-01T08:30:00", "variable": "VPD", "value": 0.01600000075995922, "is_present": true, "mean": -512.9349365234375, "std": 13.516029357910156, "err_low": -27.01605796813965, "err_high": 27.048059463500977}, {"time": "2000-01-01T09:00:00", "variable": "VPD", "value": 0.009999999776482582, "is_present": true, "mean": -973.6253051757812, "std": 22.438920974731445, "err_low": -44.86784362792969, "err_high": 44.887840270996094}, {"time": "2000-01-01T09:30:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -249.92584228515625, "std": 9.973566055297852, "err_low": -19.941131591796875, "err_high": 19.95313262939453}, {"time": "2000-01-01T10:00:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -262.58770751953125, "std": 9.5187406539917, "err_low": -19.03148078918457, "err_high": 19.043481826782227}], "data-d29e32b90fb51418b8452203fb8d8017": [{"time": "2000-01-01T10:30:00", "variable": "TA", "value": 0.10000000149011612, "is_present": true, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -17.367019653320312, "err_high": 17.567020416259766}, {"time": "2000-01-01T11:00:00", "variable": "TA", "value": 0.18000000715255737, "is_present": true, "mean": -151.82733154296875, "std": 9.521690368652344, "err_low": -18.863380432128906, "err_high": 19.22338104248047}, {"time": "2000-01-01T11:30:00", "variable": "TA", "value": 0.20999999344348907, "is_present": true, "mean": -281.5771484375, "std": 8.931245803833008, "err_low": -17.65249252319336, "err_high": 18.072490692138672}, {"time": "2000-01-01T12:00:00", "variable": "TA", "value": 0.23000000417232513, "is_present": true, "mean": -314.24530029296875, "std": 8.934998512268066, "err_low": -17.639997482299805, "err_high": 18.09999656677246}, {"time": "2000-01-01T12:30:00", "variable": "TA", "value": 0.33000001311302185, "is_present": true, "mean": -313.3352355957031, "std": 8.929085731506348, "err_low": -17.52817153930664, "err_high": 18.18817138671875}, {"time": "2000-01-01T13:00:00", "variable": "TA", "value": 0.4099999964237213, "is_present": true, "mean": -299.6491394042969, "std": 8.926377296447754, "err_low": -17.4427547454834, "err_high": 18.262754440307617}, {"time": "2000-01-01T13:30:00", "variable": "TA", "value": 0.4399999976158142, "is_present": true, "mean": -298.2962341308594, "std": 8.931000709533691, "err_low": -17.422000885009766, "err_high": 18.302001953125}, {"time": "2000-01-01T14:00:00", "variable": "TA", "value": 0.47999998927116394, "is_present": false, "mean": -303.3424377441406, "std": 8.931939125061035, "err_low": -17.383878707885742, "err_high": 18.3438777923584}, {"time": "2000-01-01T14:30:00", "variable": "TA", "value": 0.49000000953674316, "is_present": false, "mean": -586.0726928710938, "std": 13.454289436340332, "err_low": -26.4185791015625, "err_high": 27.398578643798828}, {"time": "2000-01-01T15:00:00", "variable": "TA", "value": 0.5099999904632568, "is_present": true, "mean": -1128.221435546875, "std": 23.52825355529785, "err_low": -46.5465087890625, "err_high": 47.566505432128906}], "data-ed57f06386ca5ccb5d8a599f91a087c9": [{"time": "2000-01-01T10:30:00", "variable": "SW_IN", "value": 16.510000228881836, "is_present": true, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -757.5181274414062, "err_high": 790.5381469726562}, {"time": "2000-01-01T11:00:00", "variable": "SW_IN", "value": 24.729999542236328, "is_present": true, "mean": -7611.8330078125, "std": 452.145751953125, "err_low": -879.5615234375, "err_high": 929.021484375}, {"time": "2000-01-01T11:30:00", "variable": "SW_IN", "value": 47.41999816894531, "is_present": true, "mean": -12971.9140625, "std": 431.8902587890625, "err_low": -816.3605346679688, "err_high": 911.2005004882812}, {"time": "2000-01-01T12:00:00", "variable": "SW_IN", "value": 22.049999237060547, "is_present": true, "mean": -14482.4619140625, "std": 432.0213317871094, "err_low": -841.99267578125, "err_high": 886.0926513671875}, {"time": "2000-01-01T12:30:00", "variable": "SW_IN", "value": 18.860000610351562, "is_present": true, "mean": -14350.1220703125, "std": 431.7625732421875, "err_low": -844.6651611328125, "err_high": 882.3851318359375}, {"time": "2000-01-01T13:00:00", "variable": "SW_IN", "value": 21.100000381469727, "is_present": true, "mean": -13784.1318359375, "std": 431.6690979003906, "err_low": -842.2382202148438, "err_high": 884.4381713867188}, {"time": "2000-01-01T13:30:00", "variable": "SW_IN", "value": 28.8700008392334, "is_present": true, "mean": -13725.15625, "std": 431.889892578125, "err_low": -834.9097900390625, "err_high": 892.6497802734375}, {"time": "2000-01-01T14:00:00", "variable": "SW_IN", "value": 24.219999313354492, "is_present": false, "mean": -13960.57421875, "std": 431.89666748046875, "err_low": -839.5733642578125, "err_high": 888.0133056640625}, {"time": "2000-01-01T14:30:00", "variable": "SW_IN", "value": 24.350000381469727, "is_present": false, "mean": -26844.0390625, "std": 630.25390625, "err_low": -1236.1578369140625, "err_high": 1284.8577880859375}, {"time": "2000-01-01T15:00:00", "variable": "SW_IN", "value": 15.680000305175781, "is_present": true, "mean": -50942.76953125, "std": 1064.2335205078125, "err_low": -2112.787109375, "err_high": 2144.14697265625}], "data-dfbaae86c85027022400ba837d30a3f2": [{"time": "2000-01-01T10:30:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -16.36855125427246, "err_high": 16.380552291870117}, {"time": "2000-01-01T11:00:00", "variable": "VPD", "value": 0.010999999940395355, "is_present": true, "mean": -158.93130493164062, "std": 9.882741928100586, "err_low": -19.754484176635742, "err_high": 19.7764835357666}, {"time": "2000-01-01T11:30:00", "variable": "VPD", "value": 0.01899999938905239, "is_present": true, "mean": -269.5823669433594, "std": 9.492395401000977, "err_low": -18.965791702270508, "err_high": 19.0037899017334}, {"time": "2000-01-01T12:00:00", "variable": "VPD", "value": 0.014000000432133675, "is_present": true, "mean": -301.49151611328125, "std": 9.494841575622559, "err_low": -18.975683212280273, "err_high": 19.00368309020996}, {"time": "2000-01-01T12:30:00", "variable": "VPD", "value": 0.00800000037997961, "is_present": true, "mean": -298.4079284667969, "std": 9.48963737487793, "err_low": -18.971275329589844, "err_high": 18.987274169921875}, {"time": "2000-01-01T13:00:00", "variable": "VPD", "value": 0.006000000052154064, "is_present": true, "mean": -286.73895263671875, "std": 9.487833976745605, "err_low": -18.969667434692383, "err_high": 18.98166847229004}, {"time": "2000-01-01T13:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -285.49462890625, "std": 9.492341041564941, "err_low": -18.984682083129883, "err_high": 18.984682083129883}, {"time": "2000-01-01T14:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -290.45672607421875, "std": 9.492371559143066, "err_low": -18.984743118286133, "err_high": 18.984743118286133}, {"time": "2000-01-01T14:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -560.9456176757812, "std": 13.527811050415039, "err_low": -27.055622100830078, "err_high": 27.055622100830078}, {"time": "2000-01-01T15:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -1064.99267578125, "std": 22.464420318603516, "err_low": -44.92884063720703, "err_high": 44.92884063720703}], "data-520068efbcad15bb1da0bd746350ba85": [{"time": "2000-01-01T15:30:00", "variable": "TA", "value": 0.5199999809265137, "is_present": true, "mean": 19.07571029663086, "std": 8.73351001739502, "err_low": -16.947019577026367, "err_high": 17.98702049255371}, {"time": "2000-01-01T16:00:00", "variable": "TA", "value": 0.5699999928474426, "is_present": true, "mean": -141.77842712402344, "std": 9.521690368652344, "err_low": -18.47338104248047, "err_high": 19.613380432128906}, {"time": "2000-01-01T16:30:00", "variable": "TA", "value": 0.7300000190734863, "is_present": true, "mean": -256.22406005859375, "std": 8.931245803833008, "err_low": -17.132492065429688, "err_high": 18.592491149902344}, {"time": "2000-01-01T17:00:00", "variable": "TA", "value": 0.7699999809265137, "is_present": true, "mean": -261.47576904296875, "std": 8.934998512268066, "err_low": -17.09999656677246, "err_high": 18.639997482299805}, {"time": "2000-01-01T17:30:00", "variable": "TA", "value": 0.8399999737739563, "is_present": true, "mean": -262.18359375, "std": 8.929085731506348, "err_low": -17.018171310424805, "err_high": 18.698171615600586}, {"time": "2000-01-01T18:00:00", "variable": "TA", "value": 0.9900000095367432, "is_present": true, "mean": -260.72357177734375, "std": 8.926377296447754, "err_low": -16.862754821777344, "err_high": 18.842754364013672}, {"time": "2000-01-01T18:30:00", "variable": "TA", "value": 1.350000023841858, "is_present": false, "mean": -259.04852294921875, "std": 8.931000709533691, "err_low": -16.512001037597656, "err_high": 19.21200180053711}, {"time": "2000-01-01T19:00:00", "variable": "TA", "value": 1.8600000143051147, "is_present": false, "mean": -501.78643798828125, "std": 13.452587127685547, "err_low": -25.04517364501953, "err_high": 28.765174865722656}, {"time": "2000-01-01T19:30:00", "variable": "TA", "value": 2.009999990463257, "is_present": true, "mean": -967.532958984375, "std": 23.524320602416992, "err_low": -45.03864288330078, "err_high": 49.05863952636719}, {"time": "2000-01-01T20:00:00", "variable": "TA", "value": 2.069999933242798, "is_present": true, "mean": -218.54214477539062, "std": 9.532303810119629, "err_low": -16.99460792541504, "err_high": 21.134607315063477}], "data-5c228d5f67448c70676cbacf53603d17": [{"time": "2000-01-01T15:30:00", "variable": "SW_IN", "value": 8.09000015258789, "is_present": true, "mean": 426.03997802734375, "std": 387.0140686035156, "err_low": -765.9381103515625, "err_high": 782.1181640625}, {"time": "2000-01-01T16:00:00", "variable": "SW_IN", "value": 6.369999885559082, "is_present": true, "mean": -7140.171875, "std": 452.145751953125, "err_low": -897.9215087890625, "err_high": 910.6614990234375}, {"time": "2000-01-01T16:30:00", "variable": "SW_IN", "value": 1.7200000286102295, "is_present": true, "mean": -11831.4951171875, "std": 431.8902587890625, "err_low": -862.060546875, "err_high": 865.50048828125}, {"time": "2000-01-01T17:00:00", "variable": "SW_IN", "value": 0.05999999865889549, "is_present": true, "mean": -12097.1328125, "std": 432.0213317871094, "err_low": -863.982666015625, "err_high": 864.1026611328125}, {"time": "2000-01-01T17:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12116.1630859375, "std": 431.7625732421875, "err_low": -863.525146484375, "err_high": 863.525146484375}, {"time": "2000-01-01T18:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -12054.4365234375, "std": 431.6690979003906, "err_low": -863.3381958007812, "err_high": 863.3381958007812}, {"time": "2000-01-01T18:30:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -11979.51171875, "std": 431.889892578125, "err_low": -863.77978515625, "err_high": 863.77978515625}, {"time": "2000-01-01T19:00:00", "variable": "SW_IN", "value": 0.0, "is_present": false, "mean": -23062.861328125, "std": 630.1495361328125, "err_low": -1260.299072265625, "err_high": 1260.299072265625}, {"time": "2000-01-01T19:30:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -43748.9921875, "std": 1064.0830078125, "err_low": -2128.166015625, "err_high": 2128.166015625}, {"time": "2000-01-01T20:00:00", "variable": "SW_IN", "value": 0.0, "is_present": true, "mean": -10214.8486328125, "std": 453.5745849609375, "err_low": -907.149169921875, "err_high": 907.149169921875}], "data-1854be0da40e5a2c80f84d802417ef36": [{"time": "2000-01-01T15:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": 11.153300285339355, "std": 8.187275886535645, "err_low": -16.37455177307129, "err_high": 16.37455177307129}, {"time": "2000-01-01T16:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -148.9716339111328, "std": 9.882741928100586, "err_low": -19.765483856201172, "err_high": 19.765483856201172}, {"time": "2000-01-01T16:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -245.67337036132812, "std": 9.492395401000977, "err_low": -18.984790802001953, "err_high": 18.984790802001953}, {"time": "2000-01-01T17:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -251.4462890625, "std": 9.494841575622559, "err_low": -18.989683151245117, "err_high": 18.989683151245117}, {"time": "2000-01-01T17:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -251.80055236816406, "std": 9.48963737487793, "err_low": -18.97927474975586, "err_high": 18.97927474975586}, {"time": "2000-01-01T18:00:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -250.52381896972656, "std": 9.487833976745605, "err_low": -18.97566795349121, "err_high": 18.97566795349121}, {"time": "2000-01-01T18:30:00", "variable": "VPD", "value": 0.0, "is_present": true, "mean": -248.95440673828125, "std": 9.492341041564941, "err_low": -18.984682083129883, "err_high": 18.984682083129883}, {"time": "2000-01-01T19:00:00", "variable": "VPD", "value": 0.0020000000949949026, "is_present": true, "mean": -481.725830078125, "std": 13.525559425354004, "err_low": -27.049118041992188, "err_high": 27.053119659423828}, {"time": "2000-01-01T19:30:00", "variable": "VPD", "value": 0.008999999612569809, "is_present": true, "mean": -914.3319702148438, "std": 22.461381912231445, "err_low": -44.91376495361328, "err_high": 44.9317626953125}, {"time": "2000-01-01T20:00:00", "variable": "VPD", "value": 0.014000000432133675, "is_present": true, "mean": -212.11082458496094, "std": 9.915565490722656, "err_low": -19.81713104248047, "err_high": 19.845130920410156}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>display_as_row(learn.model.get_info())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<p style="font-size: 1.5rem; font-decoration: bold"></p><p></p><div style="display: flex; column-gap: 20px; flex-wrap: wrap;" class="table table-striped table-sm"> <div> <p style="font-size: 1.3rem;">trans_matrix (A)</p> <style type="text/css">
</style>
<table id="T_34f61">
  <thead>
    <tr>
      <th id="T_34f61_level0_col0" class="col_heading level0 col0">latent</th>
      <th id="T_34f61_level0_col1" class="col_heading level0 col1">z_0</th>
      <th id="T_34f61_level0_col2" class="col_heading level0 col2">z_1</th>
      <th id="T_34f61_level0_col3" class="col_heading level0 col3">z_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_34f61_row0_col0" class="data row0 col0">z_0</td>
      <td id="T_34f61_row0_col1" class="data row0 col1">0.9243</td>
      <td id="T_34f61_row0_col2" class="data row0 col2">1.0221</td>
      <td id="T_34f61_row0_col3" class="data row0 col3">0.4038</td>
    </tr>
    <tr>
      <td id="T_34f61_row1_col0" class="data row1 col0">z_1</td>
      <td id="T_34f61_row1_col1" class="data row1 col1">0.9677</td>
      <td id="T_34f61_row1_col2" class="data row1 col2">0.2878</td>
      <td id="T_34f61_row1_col3" class="data row1 col3">0.5475</td>
    </tr>
    <tr>
      <td id="T_34f61_row2_col0" class="data row2 col0">z_2</td>
      <td id="T_34f61_row2_col1" class="data row2 col1">0.2767</td>
      <td id="T_34f61_row2_col2" class="data row2 col2">0.8683</td>
      <td id="T_34f61_row2_col3" class="data row2 col3">-0.0010</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">trans_cov (Q)</p> <style type="text/css">
</style>
<table id="T_4109e">
  <thead>
    <tr>
      <th id="T_4109e_level0_col0" class="col_heading level0 col0">latent</th>
      <th id="T_4109e_level0_col1" class="col_heading level0 col1">z_0</th>
      <th id="T_4109e_level0_col2" class="col_heading level0 col2">z_1</th>
      <th id="T_4109e_level0_col3" class="col_heading level0 col3">z_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_4109e_row0_col0" class="data row0 col0">z_0</td>
      <td id="T_4109e_row0_col1" class="data row0 col1">0.2138</td>
      <td id="T_4109e_row0_col2" class="data row0 col2">0.4934</td>
      <td id="T_4109e_row0_col3" class="data row0 col3">0.5771</td>
    </tr>
    <tr>
      <td id="T_4109e_row1_col0" class="data row1 col0">z_1</td>
      <td id="T_4109e_row1_col1" class="data row1 col1">0.4934</td>
      <td id="T_4109e_row1_col2" class="data row1 col2">1.3030</td>
      <td id="T_4109e_row1_col3" class="data row1 col3">1.4334</td>
    </tr>
    <tr>
      <td id="T_4109e_row2_col0" class="data row2 col0">z_2</td>
      <td id="T_4109e_row2_col1" class="data row2 col1">0.5771</td>
      <td id="T_4109e_row2_col2" class="data row2 col2">1.4334</td>
      <td id="T_4109e_row2_col3" class="data row2 col3">1.6345</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">trans_off</p> <style type="text/css">
</style>
<table id="T_a5211">
  <thead>
    <tr>
      <th id="T_a5211_level0_col0" class="col_heading level0 col0">latent</th>
      <th id="T_a5211_level0_col1" class="col_heading level0 col1">offset</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_a5211_row0_col0" class="data row0 col0">z_0</td>
      <td id="T_a5211_row0_col1" class="data row0 col1">0.7556</td>
    </tr>
    <tr>
      <td id="T_a5211_row1_col0" class="data row1 col0">z_1</td>
      <td id="T_a5211_row1_col1" class="data row1 col1">0.3794</td>
    </tr>
    <tr>
      <td id="T_a5211_row2_col0" class="data row2 col0">z_2</td>
      <td id="T_a5211_row2_col1" class="data row2 col1">0.5790</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">obs_matrix (H)</p> <style type="text/css">
</style>
<table id="T_78baa">
  <thead>
    <tr>
      <th id="T_78baa_level0_col0" class="col_heading level0 col0">variable</th>
      <th id="T_78baa_level0_col1" class="col_heading level0 col1">z_0</th>
      <th id="T_78baa_level0_col2" class="col_heading level0 col2">z_1</th>
      <th id="T_78baa_level0_col3" class="col_heading level0 col3">z_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_78baa_row0_col0" class="data row0 col0">x_0</td>
      <td id="T_78baa_row0_col1" class="data row0 col1">0.3084</td>
      <td id="T_78baa_row0_col2" class="data row0 col2">0.3628</td>
      <td id="T_78baa_row0_col3" class="data row0 col3">0.1764</td>
    </tr>
    <tr>
      <td id="T_78baa_row1_col0" class="data row1 col0">x_1</td>
      <td id="T_78baa_row1_col1" class="data row1 col1">0.2250</td>
      <td id="T_78baa_row1_col2" class="data row1 col2">0.6507</td>
      <td id="T_78baa_row1_col3" class="data row1 col3">0.8294</td>
    </tr>
    <tr>
      <td id="T_78baa_row2_col0" class="data row2 col0">x_2</td>
      <td id="T_78baa_row2_col1" class="data row2 col1">0.1083</td>
      <td id="T_78baa_row2_col2" class="data row2 col2">0.7747</td>
      <td id="T_78baa_row2_col3" class="data row2 col3">1.0856</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">obs_cov (R)</p> <style type="text/css">
</style>
<table id="T_3f180">
  <thead>
    <tr>
      <th id="T_3f180_level0_col0" class="col_heading level0 col0">variable</th>
      <th id="T_3f180_level0_col1" class="col_heading level0 col1">x_0</th>
      <th id="T_3f180_level0_col2" class="col_heading level0 col2">x_1</th>
      <th id="T_3f180_level0_col3" class="col_heading level0 col3">x_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_3f180_row0_col0" class="data row0 col0">x_0</td>
      <td id="T_3f180_row0_col1" class="data row0 col1">0.9237</td>
      <td id="T_3f180_row0_col2" class="data row0 col2">1.0905</td>
      <td id="T_3f180_row0_col3" class="data row0 col3">0.9283</td>
    </tr>
    <tr>
      <td id="T_3f180_row1_col0" class="data row1 col0">x_1</td>
      <td id="T_3f180_row1_col1" class="data row1 col1">1.0905</td>
      <td id="T_3f180_row1_col2" class="data row1 col2">1.4736</td>
      <td id="T_3f180_row1_col3" class="data row1 col3">1.3702</td>
    </tr>
    <tr>
      <td id="T_3f180_row2_col0" class="data row2 col0">x_2</td>
      <td id="T_3f180_row2_col1" class="data row2 col1">0.9283</td>
      <td id="T_3f180_row2_col2" class="data row2 col2">1.3702</td>
      <td id="T_3f180_row2_col3" class="data row2 col3">1.3371</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">obs_off</p> <style type="text/css">
</style>
<table id="T_856d9">
  <thead>
    <tr>
      <th id="T_856d9_level0_col0" class="col_heading level0 col0">variable</th>
      <th id="T_856d9_level0_col1" class="col_heading level0 col1">offset</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_856d9_row0_col0" class="data row0 col0">x_0</td>
      <td id="T_856d9_row0_col1" class="data row0 col1">0.9935</td>
    </tr>
    <tr>
      <td id="T_856d9_row1_col0" class="data row1 col0">x_1</td>
      <td id="T_856d9_row1_col1" class="data row1 col1">0.3561</td>
    </tr>
    <tr>
      <td id="T_856d9_row2_col0" class="data row2 col0">x_2</td>
      <td id="T_856d9_row2_col1" class="data row2 col1">0.6849</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">init_state_mean</p> <style type="text/css">
</style>
<table id="T_d10c0">
  <thead>
    <tr>
      <th id="T_d10c0_level0_col0" class="col_heading level0 col0">latent</th>
      <th id="T_d10c0_level0_col1" class="col_heading level0 col1">mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_d10c0_row0_col0" class="data row0 col0">z_0</td>
      <td id="T_d10c0_row0_col1" class="data row0 col1">0.3058</td>
    </tr>
    <tr>
      <td id="T_d10c0_row1_col0" class="data row1 col0">z_1</td>
      <td id="T_d10c0_row1_col1" class="data row1 col1">0.9651</td>
    </tr>
    <tr>
      <td id="T_d10c0_row2_col0" class="data row2 col0">z_2</td>
      <td id="T_d10c0_row2_col1" class="data row2 col1">0.7525</td>
    </tr>
  </tbody>
</table>
 </div><div> <p style="font-size: 1.3rem;">init_state_cov</p> <style type="text/css">
</style>
<table id="T_9cbf6">
  <thead>
    <tr>
      <th id="T_9cbf6_level0_col0" class="col_heading level0 col0">latent</th>
      <th id="T_9cbf6_level0_col1" class="col_heading level0 col1">z_0</th>
      <th id="T_9cbf6_level0_col2" class="col_heading level0 col2">z_1</th>
      <th id="T_9cbf6_level0_col3" class="col_heading level0 col3">z_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td id="T_9cbf6_row0_col0" class="data row0 col0">z_0</td>
      <td id="T_9cbf6_row0_col1" class="data row0 col1">0.9615</td>
      <td id="T_9cbf6_row0_col2" class="data row0 col2">0.6602</td>
      <td id="T_9cbf6_row0_col3" class="data row0 col3">0.8786</td>
    </tr>
    <tr>
      <td id="T_9cbf6_row1_col0" class="data row1 col0">z_1</td>
      <td id="T_9cbf6_row1_col1" class="data row1 col1">0.6602</td>
      <td id="T_9cbf6_row1_col2" class="data row1 col2">0.7610</td>
      <td id="T_9cbf6_row1_col3" class="data row1 col3">0.8122</td>
    </tr>
    <tr>
      <td id="T_9cbf6_row2_col0" class="data row2 col0">z_2</td>
      <td id="T_9cbf6_row2_col1" class="data row2 col1">0.8786</td>
      <td id="T_9cbf6_row2_col2" class="data row2 col2">0.8122</td>
      <td id="T_9cbf6_row2_col3" class="data row2 col3">1.3442</td>
    </tr>
  </tbody>
</table>
 </div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> IntSlider, interactive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interact_result(learn,):</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="export" class="level2">
<h2 class="anchored" data-anchor-id="export">Export</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>